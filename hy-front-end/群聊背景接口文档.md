# 群聊背景接口文档

## 接口概述
本接口用于根据用户ID和群聊ID获取该用户在指定群聊下设置的聊天背景图片URL。

## 接口信息

### 1. 获取群聊背景

#### 接口描述
获取用户在特定群聊下的聊天背景图片URL。每个用户可以为不同的群聊设置不同的背景图片。

#### 请求信息

- **接口地址**: `/api/group/{groupId}/settings/background`
- **请求方式**: `GET`
- **接口说明**: 根据用户ID和群聊ID返回该用户在该群聊下的背景图片URL

#### 请求参数

##### 路径参数 (Path Variables)

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| groupId | Long | 是 | 群聊ID |

##### 查询参数 (Query Parameters)

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| userId | Long | 是 | 用户ID |

#### 请求示例

```http
GET /api/group/123/settings/background?userId=456
```

#### 响应参数

##### 成功响应 (200 OK)

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "groupId": 123,
    "userId": 456,
    "chatBackground": "https://example.com/images/background.jpg"
  }
}
```

##### 响应字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| code | Integer | 状态码，200表示成功 |
| message | String | 响应消息 |
| data | Object | 响应数据对象 |
| data.groupId | Long | 群聊ID |
| data.userId | Long | 用户ID |
| data.chatBackground | String | 聊天背景URL，如果为null表示使用默认背景 |

##### 失败响应

**场景1：群聊不存在**
```json
{
  "code": 500,
  "message": "群聊不存在",
  "data": null
}
```

**场景2：用户不是群成员**
```json
{
  "code": 500,
  "message": "您不是该群成员",
  "data": null
}
```

**场景3：系统错误**
```json
{
  "code": 500,
  "message": "获取聊天背景失败",
  "data": null
}
```

## 使用说明

### 1. 业务场景

- **场景A**: 用户A有两个群聊（群1和群2）
  - 调用接口：`GET /api/group/1/settings/background?userId=A的ID`
  - 返回：用户A在群1下的背景图片URL
  
  - 调用接口：`GET /api/group/2/settings/background?userId=A的ID`
  - 返回：用户A在群2下的背景图片URL

### 2. 前端调用示例

```javascript
// JavaScript/TypeScript 示例
async function getChatBackground(groupId, userId) {
  try {
    const response = await fetch(
      `/api/group/${groupId}/settings/background?userId=${userId}`,
      {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          // 添加认证token等其他必要的headers
        }
      }
    );
    
    const result = await response.json();
    
    if (result.code === 200) {
      const backgroundUrl = result.data.chatBackground;
      if (backgroundUrl) {
        // 使用背景URL设置聊天背景
        console.log('背景URL:', backgroundUrl);
      } else {
        // 使用默认背景
        console.log('使用默认背景');
      }
    } else {
      console.error('获取背景失败:', result.message);
    }
  } catch (error) {
    console.error('请求失败:', error);
  }
}

// 调用示例
getChatBackground(123, 456);
```

### 3. 配套接口

本接口与以下接口配套使用：

#### 设置群聊背景
- **接口地址**: `POST /api/group/{groupId}/settings/background`
- **功能**: 设置或更新用户在该群聊下的背景图片

```json
{
  "userId": 456,
  "backgroundUrl": "https://example.com/images/new-background.jpg"
}
```

#### 清除群聊背景（恢复默认）
- **接口地址**: `POST /api/group/{groupId}/settings/background`
- **功能**: 传入null值清除背景

```json
{
  "userId": 456,
  "backgroundUrl": null
}
```

## 数据库设计

### 相关表结构

```sql
-- group_members 表
CREATE TABLE `group_members` (
  ...
  `chat_background` VARCHAR(500) NULL DEFAULT NULL 
    COMMENT '群聊背景图片URL（用户自定义）',
  ...
);
```

### 查询逻辑

```sql
SELECT chat_background 
FROM group_members 
WHERE group_id = ? 
  AND user_id = ? 
  AND member_status = 'active';
```

## 注意事项

1. **权限验证**: 
   - 接口会验证用户是否为该群聊的活跃成员
   - 只有活跃成员才能获取背景信息

2. **空值处理**:
   - 如果用户未设置背景，`chatBackground` 字段返回 `null`
   - 前端应处理 `null` 值，使用默认背景

3. **URL格式**:
   - 背景URL支持任意图片URL（图床、CDN等）
   - 建议使用HTTPS协议的URL
   - 前端应验证图片可访问性

4. **性能优化**:
   - 建议前端缓存背景URL
   - 避免频繁调用接口

5. **安全性**:
   - 确保传入的userId与当前登录用户一致
   - 建议在Controller层添加身份验证

## 测试用例

### 测试案例1：正常获取背景

**请求**:
```
GET /api/group/1/settings/background?userId=100
```

**预期结果**:
- 状态码: 200
- 返回用户在群1的背景URL或null

### 测试案例2：群聊不存在

**请求**:
```
GET /api/group/999999/settings/background?userId=100
```

**预期结果**:
- 状态码: 500
- 错误信息: "群聊不存在"

### 测试案例3：非群成员访问

**请求**:
```
GET /api/group/1/settings/background?userId=999
```

**预期结果**:
- 状态码: 500
- 错误信息: "您不是该群成员"

## 更新日志

- **2025-12-11**: 初始版本，实现获取群聊背景功能
