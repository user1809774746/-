# ç®¡ç†å‘˜ç™»å½•é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ” é—®é¢˜ç°è±¡

ç®¡ç†å‘˜ä½¿ç”¨æ‰‹æœºå· `18888888888` å’Œå¯†ç  `123123` ç™»å½•æ—¶ï¼Œæç¤ºï¼š
```
æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯
```

## ğŸ“Š å½“å‰æƒ…å†µ

### å‰ç«¯
- âœ… å·²æ·»åŠ ç”¨æˆ·ç±»å‹é€‰æ‹©ï¼ˆæ™®é€šç”¨æˆ·/ç®¡ç†å‘˜ï¼‰
- âœ… ç™»å½•æ—¶æ­£ç¡®ä¼ å…¥ `userType: 'admin'`
- âœ… å‰ç«¯ä»£ç é€»è¾‘æ­£ç¡®

### æ•°æ®åº“
```sql
-- administrator_info è¡¨æ•°æ®
adminid: 1
admin_name: 156156
phone: 18888888888
password: 123123
```

### é—®é¢˜åˆ†æ
åç«¯è¿”å›"æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯"ï¼Œè¯´æ˜ï¼š
1. åç«¯æ”¶åˆ°äº†è¯·æ±‚
2. åç«¯åœ¨ `administrator_info` è¡¨ä¸­æŸ¥è¯¢äº†æ•°æ®
3. **å¯†ç éªŒè¯å¤±è´¥äº†**

---

## ğŸ¯ å¯èƒ½çš„åŸå› 

### åŸå› 1ï¼šå¯†ç åŠ å¯†é—®é¢˜ï¼ˆæœ€å¯èƒ½ï¼‰â­

**é—®é¢˜**ï¼šæ•°æ®åº“ä¸­å­˜å‚¨çš„å¯èƒ½ä¸æ˜¯æ˜æ–‡å¯†ç  `123123`

**æ£€æŸ¥æ–¹æ³•**ï¼š
1. æŸ¥çœ‹åç«¯ä»£ç ä¸­çš„å¯†ç åŠ å¯†æ–¹å¼
2. æŸ¥çœ‹åç«¯æ˜¯å¦ä½¿ç”¨äº† BCryptPasswordEncoder æˆ– MD5

**ç¤ºä¾‹**ï¼š
```java
// åç«¯å¯èƒ½ä½¿ç”¨äº†å¯†ç åŠ å¯†
BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
String encryptedPassword = encoder.encode("123123");
// åŠ å¯†åçš„ç»“æœç±»ä¼¼ï¼š$2a$10$xxxxxxxxxxxxxxxxxxxxx
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ–¹æ¡ˆAï¼šä½¿ç”¨åŠ å¯†åçš„å¯†ç æ’å…¥æ•°æ®åº“
- æ–¹æ¡ˆBï¼šä¸´æ—¶ä¿®æ”¹åç«¯ä»£ç ï¼Œè·³è¿‡å¯†ç åŠ å¯†éªŒè¯ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰

---

### åŸå› 2ï¼šåç«¯ç™»å½•é€»è¾‘æœªå®ç°ç®¡ç†å‘˜ç™»å½•

**é—®é¢˜**ï¼šåç«¯çš„ `AuthController` å¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç† `userType='admin'` çš„æƒ…å†µ

**éœ€è¦æ£€æŸ¥çš„åç«¯ä»£ç **ï¼š
```java
// AuthController.java
@PostMapping("/login")
public ResponseEntity<?> login(@RequestBody LoginRequest request) {
    String userType = request.getUserType(); // æ˜¯å¦è·å–äº† userTypeï¼Ÿ
    
    if ("admin".equals(userType)) {
        // æ˜¯å¦æœ‰ç®¡ç†å‘˜ç™»å½•çš„å¤„ç†é€»è¾‘ï¼Ÿ
        // æ˜¯å¦æŸ¥è¯¢ administrator_info è¡¨ï¼Ÿ
    } else {
        // æ™®é€šç”¨æˆ·ç™»å½•é€»è¾‘
    }
}
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
ä¿®æ”¹åç«¯ä»£ç ï¼Œæ·»åŠ ç®¡ç†å‘˜ç™»å½•é€»è¾‘

---

### åŸå› 3ï¼šå­—æ®µåŒ¹é…é—®é¢˜

**é—®é¢˜**ï¼šåç«¯å¯èƒ½ä½¿ç”¨ `admin_name` è€Œä¸æ˜¯ `phone` æ¥éªŒè¯

æ•°æ®åº“å­—æ®µï¼š
- `admin_name`: 156156
- `phone`: 18888888888

**å¯èƒ½çš„é”™è¯¯é€»è¾‘**ï¼š
```java
// é”™è¯¯ï¼šä½¿ç”¨ admin_name æŸ¥è¯¢ï¼Œä½†å‰ç«¯ä¼ çš„æ˜¯ phone
Admin admin = adminRepository.findByAdminName(phone);
```

**æ­£ç¡®é€»è¾‘**ï¼š
```java
// æ­£ç¡®ï¼šä½¿ç”¨ phone æŸ¥è¯¢
Admin admin = adminRepository.findByPhone(phone);
```

---

## ğŸ› ï¸ è§£å†³æ­¥éª¤

### æ­¥éª¤1ï¼šä½¿ç”¨æµ‹è¯•å·¥å…·

å·²åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼š`test-admin-login.html`

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
test-admin-login.html

# ç‚¹å‡»"æµ‹è¯•ç™»å½•"æŒ‰é’®
# æŸ¥çœ‹è¯¦ç»†çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯
```

### æ­¥éª¤2ï¼šæŸ¥çœ‹åç«¯æ—¥å¿—

**å¯åŠ¨åç«¯æ—¶æ·»åŠ æ—¥å¿—è¾“å‡º**ï¼š
```java
// åœ¨ AuthController çš„ login æ–¹æ³•ä¸­æ·»åŠ 
@PostMapping("/login")
public ResponseEntity<?> login(@RequestBody LoginRequest request) {
    System.out.println("==================== ç™»å½•è¯·æ±‚ ====================");
    System.out.println("æ‰‹æœºå·: " + request.getPhone());
    System.out.println("å¯†ç : " + request.getPassword());
    System.out.println("ç”¨æˆ·ç±»å‹: " + request.getUserType());
    System.out.println("===============================================");
    
    // åŸæœ‰é€»è¾‘...
}
```

### æ­¥éª¤3ï¼šæ£€æŸ¥å¯†ç åŠ å¯†

**æ£€æŸ¥åç«¯æ˜¯å¦ä½¿ç”¨äº†å¯†ç åŠ å¯†**ï¼š

#### æŸ¥æ‰¾ BCryptPasswordEncoder
```bash
# åœ¨åç«¯é¡¹ç›®ä¸­æœç´¢
grep -r "BCryptPasswordEncoder" .
grep -r "PasswordEncoder" .
```

#### æŸ¥æ‰¾ MD5
```bash
grep -r "MD5" .
grep -r "MessageDigest" .
```

### æ­¥éª¤4ï¼šç”Ÿæˆæ­£ç¡®çš„åŠ å¯†å¯†ç 

å¦‚æœåç«¯ä½¿ç”¨äº† BCryptï¼š

```java
// åœ¨åç«¯åˆ›å»ºæµ‹è¯•æ–¹æ³•
public static void main(String[] args) {
    BCryptPasswordEncoder encoder = new BCryptPasswordEncoder();
    String rawPassword = "123123";
    String encodedPassword = encoder.encode(rawPassword);
    System.out.println("åŸå§‹å¯†ç : " + rawPassword);
    System.out.println("åŠ å¯†å¯†ç : " + encodedPassword);
}
```

è¿è¡Œåå¾—åˆ°åŠ å¯†å¯†ç ï¼Œä¾‹å¦‚ï¼š
```
$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

ç„¶åæ›´æ–°æ•°æ®åº“ï¼š
```sql
UPDATE administrator_info 
SET password = '$2a$10$xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
WHERE phone = '18888888888';
```

---

## ğŸ“ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šä¿®æ”¹åç«¯ä»£ç ï¼ˆæ¨èç”¨äºæµ‹è¯•ï¼‰

åœ¨åç«¯ AuthService ä¸­ä¸´æ—¶è·³è¿‡å¯†ç åŠ å¯†ï¼š

```java
// ä¸´æ—¶ä»£ç ï¼Œä»…ç”¨äºæµ‹è¯•
public boolean verifyAdminPassword(String inputPassword, String dbPassword) {
    // ä¸´æ—¶ï¼šç›´æ¥æ¯”è¾ƒæ˜æ–‡å¯†ç 
    if (inputPassword.equals(dbPassword)) {
        return true;
    }
    
    // æ­£å¸¸ï¼šä½¿ç”¨åŠ å¯†éªŒè¯
    // return passwordEncoder.matches(inputPassword, dbPassword);
}
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨ admin_name ç™»å½•

å¦‚æœåç«¯ä½¿ç”¨ `admin_name` è€Œä¸æ˜¯ `phone`ï¼š

ä¿®æ”¹å‰ç«¯æµ‹è¯•ï¼š
```javascript
// å°è¯•ä½¿ç”¨ admin_name ç™»å½•
phone: "156156"  // è€Œä¸æ˜¯ 18888888888
password: "123123"
```

---

## ğŸ” æ­£ç¡®çš„å®ç°æ–¹å¼

### åç«¯å®ç°ç¤ºä¾‹

```java
@PostMapping("/login")
public ResponseEntity<?> login(@RequestBody LoginRequest request) {
    String phone = request.getPhone();
    String password = request.getPassword();
    String userType = request.getUserType();
    
    if ("admin".equals(userType)) {
        // ç®¡ç†å‘˜ç™»å½•
        Administrator admin = adminRepository.findByPhone(phone)
            .orElseThrow(() -> new RuntimeException("æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯"));
        
        // éªŒè¯å¯†ç 
        if (!passwordEncoder.matches(password, admin.getPassword())) {
            throw new RuntimeException("æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯");
        }
        
        // ç”Ÿæˆ token
        String token = jwtUtil.generateToken(phone, "admin");
        
        return ResponseEntity.ok(new LoginResponse(token, phone, "admin"));
    } else {
        // æ™®é€šç”¨æˆ·ç™»å½•é€»è¾‘
        // ...
    }
}
```

### æ•°æ®åº“æ­£ç¡®çš„å¯†ç æ ¼å¼

ä½¿ç”¨ BCrypt åŠ å¯†åï¼š
```sql
INSERT INTO administrator_info 
(admin_name, phone, password, creation_date)
VALUES 
('156156', '18888888888', '$2a$10$åŠ å¯†åçš„å¯†ç å­—ç¬¦ä¸²', NOW());
```

---

## âœ… æ£€æŸ¥æ¸…å•

è¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š

- [ ] 1. åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼Ÿ
- [ ] 2. åç«¯æ˜¯å¦æ”¶åˆ°äº†ç™»å½•è¯·æ±‚ï¼Ÿï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰
- [ ] 3. åç«¯æ˜¯å¦æ­£ç¡®è§£æäº† `userType='admin'`ï¼Ÿ
- [ ] 4. åç«¯æ˜¯å¦æŸ¥è¯¢äº† `administrator_info` è¡¨ï¼Ÿ
- [ ] 5. åç«¯ä½¿ç”¨ä»€ä¹ˆå­—æ®µæŸ¥è¯¢ï¼Ÿï¼ˆphone è¿˜æ˜¯ admin_nameï¼Ÿï¼‰
- [ ] 6. æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨è¯¥ç®¡ç†å‘˜è®°å½•ï¼Ÿ
- [ ] 7. æ•°æ®åº“ä¸­çš„å¯†ç æ˜¯æ˜æ–‡è¿˜æ˜¯åŠ å¯†ï¼Ÿ
- [ ] 8. åç«¯ä½¿ç”¨ä»€ä¹ˆåŠ å¯†æ–¹å¼ï¼Ÿï¼ˆBCryptã€MD5 ç­‰ï¼‰
- [ ] 9. è¾“å…¥çš„å¯†ç æ˜¯å¦ä¸æ•°æ®åº“ä¸­çš„å¯†ç åŒ¹é…ï¼Ÿ
- [ ] 10. åç«¯æ˜¯å¦è¿”å›äº†æ­£ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼Ÿ

---

## ğŸ¯ å»ºè®®çš„è°ƒè¯•æ­¥éª¤

### 1. æœ€ç®€å•çš„éªŒè¯
```sql
-- ç›´æ¥åœ¨æ•°æ®åº“æ‰§è¡ŒæŸ¥è¯¢
SELECT * FROM administrator_info WHERE phone = '18888888888';

-- æŸ¥çœ‹å®é™…çš„å¯†ç å­—æ®µå†…å®¹
```

### 2. ä½¿ç”¨ Postman æµ‹è¯•
```json
POST http://localhost:8081/api/auth/login
Content-Type: application/json

{
  "phone": "18888888888",
  "password": "123123",
  "userType": "admin"
}
```

### 3. æŸ¥çœ‹å®Œæ•´çš„åç«¯æ—¥å¿—
```bash
# å¯åŠ¨åç«¯æ—¶æŸ¥çœ‹å®Œæ•´æ—¥å¿—
# ç‰¹åˆ«æ³¨æ„ SQL æŸ¥è¯¢è¯­å¥
```

### 4. æ·»åŠ åç«¯æ–­ç‚¹è°ƒè¯•
åœ¨åç«¯ AuthService çš„ç™»å½•æ–¹æ³•ä¸­æ‰“æ–­ç‚¹ï¼Œé€æ­¥è°ƒè¯•ï¼š
- æ˜¯å¦è¿›å…¥äº†ç®¡ç†å‘˜ç™»å½•åˆ†æ”¯ï¼Ÿ
- æŸ¥è¯¢æ•°æ®åº“è¿”å›äº†ä»€ä¹ˆï¼Ÿ
- å¯†ç æ¯”å¯¹çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

---

## ğŸ’¡ å¿«é€Ÿè§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœæ€¥éœ€ä½¿ç”¨ï¼‰

### ä¸´æ—¶æ–¹æ¡ˆï¼šä½¿ç”¨æ™®é€šç”¨æˆ·æƒé™æ¨¡æ‹Ÿ

1. åˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·è´¦å·
2. ç™»å½•åæ‰‹åŠ¨åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¿®æ”¹èº«ä»½ï¼š
```javascript
localStorage.setItem('user_type', 'admin');
location.reload();
```

3. è¿™æ ·å¯ä»¥ä¸´æ—¶è®¿é—®ç®¡ç†å‘˜ç•Œé¢ï¼ˆä½†APIè°ƒç”¨å¯èƒ½ä¼šå¤±è´¥ï¼‰

### æ°¸ä¹…æ–¹æ¡ˆï¼šä¿®å¤åç«¯

è”ç³»åç«¯å¼€å‘äººå‘˜ï¼Œæä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- å‰ç«¯ä¼ å…¥çš„å‚æ•°ï¼š`{ phone, password, userType: 'admin' }`
- æœŸæœ›çš„è¡Œä¸ºï¼šæŸ¥è¯¢ `administrator_info` è¡¨å¹¶éªŒè¯å¯†ç 
- å½“å‰é”™è¯¯ï¼šå¯†ç éªŒè¯å¤±è´¥

---

## ğŸ“ éœ€è¦åç«¯æä¾›çš„ä¿¡æ¯

è¯·åç«¯å¼€å‘äººå‘˜æä¾›ï¼š

1. **å¯†ç åŠ å¯†æ–¹å¼**
   - ä½¿ç”¨ BCryptï¼ŸMD5ï¼ŸSHA256ï¼Ÿ
   - è¿˜æ˜¯æ˜æ–‡å­˜å‚¨ï¼Ÿ

2. **ç®¡ç†å‘˜ç™»å½•é€»è¾‘**
   - æ˜¯å¦å®ç°äº† `userType='admin'` çš„å¤„ç†ï¼Ÿ
   - æŸ¥è¯¢å“ªä¸ªè¡¨ï¼Ÿä½¿ç”¨ä»€ä¹ˆå­—æ®µæŸ¥è¯¢ï¼Ÿ

3. **æ­£ç¡®çš„ç®¡ç†å‘˜å¯†ç **
   - å¦‚æœä½¿ç”¨åŠ å¯†ï¼Œæä¾›åŠ å¯†åçš„å¯†ç 
   - æˆ–æä¾›ç”Ÿæˆå¯†ç çš„æ–¹æ³•

4. **åç«¯æ—¥å¿—**
   - ç™»å½•å¤±è´¥æ—¶çš„å®Œæ•´æ—¥å¿—
   - SQL æŸ¥è¯¢è¯­å¥
   - å¯†ç éªŒè¯è¿‡ç¨‹

---

## ğŸ‰ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯åº”è¯¥èƒ½æˆåŠŸç™»å½•ï¼š
- **æ‰‹æœºå·**ï¼š18888888888
- **å¯†ç **ï¼š123123ï¼ˆæˆ–åŠ å¯†åçš„å¯†ç ï¼‰
- **ç”¨æˆ·ç±»å‹**ï¼šadmin
- **ç™»å½•å**ï¼šè‡ªåŠ¨è·³è½¬åˆ°å¸–å­å®¡æ ¸ç®¡ç†ç³»ç»Ÿ

---

**å»ºè®®å…ˆä½¿ç”¨ `test-admin-login.html` æµ‹è¯•ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œç„¶åæ ¹æ®é”™è¯¯æç¤ºè¿›è¡Œæ’æŸ¥ï¼** ğŸ”

