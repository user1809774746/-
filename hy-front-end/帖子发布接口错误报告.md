# 帖子发布接口错误报告

## 错误概述

前端帖子发布功能已开发完成，但在测试过程中发现后端 `/api/post/create` 接口返回错误，导致无法正常创建和发布帖子。

## 错误详情

### 错误信息
```
API请求失败: /api/post/create Error: 请求失败
```

### 错误分析
1. **网络连接正常** - 能够到达后端服务器
2. **HTTP状态码正常** - 不是404或500错误
3. **后端返回业务错误** - `data.code !== 200`

### 调用的接口
- **接口地址**: `POST /api/post/create`
- **请求头**: `Authorization: Bearer <JWT Token>`
- **Content-Type**: `application/json`

## 前端发送的数据格式

根据API文档，前端发送的数据结构如下：

```json
{
  "title": "帖子标题",
  "summary": "帖子摘要",
  "content": "帖子内容",
  "contentType": "richtext",
  "postType": "travel_note",
  "category": "domestic",
  "coverImage": "",
  "images": [],
  "videos": [],
  "destinationName": "目的地名称",
  "destinationCity": "目的地城市",
  "destinationProvince": "目的地省份",
  "destinationCountry": "China",
  "travelDays": 3,
  "travelBudget": 1500.00,
  "actualCost": 1350.00,
  "travelSeason": "spring",
  "travelStyle": "solo",
  "tags": "标签1,标签2",
  "keywords": "关键词1,关键词2",
  "isPublic": true,
  "allowComments": true,
  "allowShares": true
}
```

## 需要后端检查的问题

### 1. 接口实现状态
- [ ] `/api/post/create` 接口是否已实现？
- [ ] 接口路由是否正确配置？
- [ ] 接口是否返回正确的响应格式？

### 2. 数据库表结构
根据API文档，需要以下数据库表：

```sql
CREATE TABLE posts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    publisher_id BIGINT NOT NULL,
    publisher_nickname VARCHAR(100),
    title VARCHAR(200) NOT NULL,
    summary TEXT,
    content LONGTEXT NOT NULL,
    content_type VARCHAR(50) DEFAULT 'richtext',
    post_type VARCHAR(50),
    category VARCHAR(50),
    cover_image VARCHAR(500),
    images JSON,
    videos JSON,
    destination_name VARCHAR(100),
    destination_city VARCHAR(100),
    destination_province VARCHAR(100),
    destination_country VARCHAR(100) DEFAULT 'China',
    travel_days INT,
    travel_budget DECIMAL(10,2),
    actual_cost DECIMAL(10,2),
    travel_season VARCHAR(20),
    travel_style VARCHAR(50),
    tags VARCHAR(500),
    keywords VARCHAR(500),
    view_count INT DEFAULT 0,
    like_count INT DEFAULT 0,
    comment_count INT DEFAULT 0,
    share_count INT DEFAULT 0,
    favorite_count INT DEFAULT 0,
    rating DECIMAL(3,2) DEFAULT 0.0,
    rating_count INT DEFAULT 0,
    status VARCHAR(20) DEFAULT 'draft',
    audit_status VARCHAR(20) DEFAULT 'pending',
    is_public BOOLEAN DEFAULT true,
    allow_comments BOOLEAN DEFAULT true,
    allow_shares BOOLEAN DEFAULT true,
    created_time DATETIME NOT NULL,
    updated_time DATETIME NOT NULL,
    published_time DATETIME,
    deleted_time DATETIME,
    INDEX idx_publisher_id (publisher_id),
    INDEX idx_status (status),
    INDEX idx_post_type (post_type),
    INDEX idx_created_time (created_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 3. 请求参数验证
- [ ] 必填字段验证：`title`, `content`
- [ ] 数据类型验证：数字字段、布尔字段
- [ ] 字符串长度限制检查
- [ ] JSON字段格式验证（images, videos）

### 4. 认证和权限
- [ ] JWT Token验证是否正常？
- [ ] 用户权限检查是否通过？
- [ ] 用户ID获取是否正确？

### 5. 响应格式
后端应该返回以下格式的响应：

**成功响应 (200)**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "publisherId": 10001,
    "publisherNickname": "用户昵称",
    "title": "帖子标题",
    "summary": "帖子摘要",
    "content": "帖子内容",
    "status": "draft",
    "auditStatus": "pending",
    "createdTime": "2024-10-28T15:30:00",
    "updatedTime": "2024-10-28T15:30:00"
  }
}
```

**错误响应**:
```json
{
  "code": 400,
  "message": "具体的错误信息",
  "data": null
}
```

## 调试建议

### 1. 后端日志检查
请检查后端日志，查看：
- 是否收到了POST请求到 `/api/post/create`
- 请求参数是否正确解析
- 数据库操作是否成功
- 具体的错误信息

### 2. 接口测试
可以使用以下curl命令测试接口：

```bash
curl -X POST http://localhost:8081/api/post/create \
  -H "Authorization: Bearer <JWT_TOKEN>" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试帖子",
    "content": "测试内容",
    "postType": "travel_note",
    "isPublic": true,
    "allowComments": true,
    "allowShares": true
  }'
```

### 3. 数据库检查
- 确认数据库连接正常
- 确认posts表已创建
- 确认表结构与API文档一致
- 检查数据库用户权限

### 4. 前端调试
我已经在前端添加了更详细的错误日志，重新测试时会输出：
- 完整的错误信息
- 发送的数据内容
- 后端返回的详细错误

## 临时解决方案

在后端接口修复之前，前端已经实现了：
- ✅ 完整的表单界面
- ✅ 数据验证逻辑
- ✅ API调用封装
- ✅ 错误处理机制

一旦后端接口修复，前端功能即可正常使用。

## 联系方式

如需进一步协助调试，请提供：
1. 后端服务器日志
2. 数据库错误日志
3. 接口返回的完整响应内容

## 优先级

**高优先级** - 这是核心功能，建议优先修复：
1. `/api/post/create` - 创建帖子接口
2. `/api/post/{postId}/publish` - 发布帖子接口
3. `/api/post/draft/save` - 保存草稿接口

