# 帖子发布表单功能说明

## 功能概述

基于用户发布帖子API接口文档，我设计并实现了一个完整的帖子发布表单页面，用户可以创建、编辑和发布旅游帖子，支持丰富的内容类型和旅行信息。

## 页面结构设计

### 1. 访问路径
- **新建帖子**: 我的页面 → 我发布的 → 写帖子按钮
- **编辑帖子**: 我的页面 → 我发布的 → 选择帖子 → 编辑按钮

### 2. 表单布局

#### 顶部操作栏
- **返回按钮**: 返回到"我发布的"页面
- **标题显示**: "写帖子" 或 "编辑帖子"
- **自动保存提示**: 显示最后保存时间
- **保存草稿按钮**: 手动保存草稿
- **发布按钮**: 创建并发布帖子

#### 表单分区
1. **基本信息**: 标题、摘要、帖子类型、分类
2. **内容编辑**: 正文内容、图片上传
3. **旅行信息**: 目的地、天数、预算、季节、风格
4. **标签和设置**: 标签、关键词、发布设置

## 表单字段详情

### 基本信息区域
- **标题** (必填): 帖子标题，最多200字符
- **摘要** (可选): 帖子简介，用于列表展示
- **帖子类型**: 游记、攻略、照片分享、视频分享、问答
- **分类**: 国内旅游、国际旅游、城市漫步、探险户外

### 内容编辑区域
- **正文内容** (必填): 帖子主要内容，支持长文本
- **图片上传**: 支持多图片上传，可预览和删除
- **内容类型**: 默认为富文本格式

### 旅行信息区域
- **目的地**: 旅行目的地名称
- **城市**: 具体城市信息
- **旅行天数**: 数字输入，必须大于0
- **预算**: 旅行预算金额
- **实际花费**: 实际花费金额
- **旅行季节**: 春季、夏季、秋季、冬季
- **旅行风格**: 独自旅行、情侣出行、家庭旅游、背包客、奢华旅游

### 标签和设置区域
- **标签**: 用逗号分隔的标签，用于分类
- **关键词**: 用于搜索的关键词
- **发布设置**: 
  - 是否公开发布
  - 是否允许评论
  - 是否允许分享

## API接口集成

### 核心接口调用
1. **创建帖子**: `POST /api/post/create`
2. **发布帖子**: `POST /api/post/{postId}/publish`
3. **更新帖子**: `PUT /api/post/{postId}`
4. **保存草稿**: `POST /api/post/draft/save`

### 发布流程
```javascript
// 发布帖子的完整流程
const handlePublish = async () => {
  // 1. 表单验证
  if (!validateForm()) return;
  
  // 2. 创建或更新帖子
  let postId;
  if (editingPost) {
    // 编辑模式：更新现有帖子
    const updateResponse = await updatePost(editingPost.id, formData);
    postId = editingPost.id;
  } else {
    // 新建模式：创建新帖子
    const createResponse = await createPost(formData);
    postId = createResponse.data.id;
  }
  
  // 3. 发布帖子
  const publishResponse = await publishPost(postId);
  
  // 4. 处理结果
  if (publishResponse.code === 200) {
    alert('发布成功！');
    onBack(); // 返回列表页面
  }
};
```

## 功能特性

### 1. 表单验证
- **必填字段验证**: 标题和内容不能为空
- **数字字段验证**: 天数、预算、花费必须是有效数字
- **实时验证**: 输入时清除错误提示
- **提交前验证**: 发布前进行完整验证

### 2. 自动保存
- **定时保存**: 每30秒自动保存草稿
- **条件保存**: 只有在有标题或内容时才保存
- **静默保存**: 自动保存不显示提示
- **保存时间**: 显示最后保存时间

### 3. 图片管理
- **多图上传**: 支持一次选择多个图片
- **图片预览**: 上传后显示缩略图
- **删除功能**: 可以删除已上传的图片
- **格式限制**: 只允许图片格式文件

### 4. 编辑模式
- **数据回填**: 编辑时自动填充现有数据
- **更新逻辑**: 编辑模式调用更新接口
- **状态区分**: 页面标题显示"编辑帖子"

## 用户体验设计

### 1. 视觉设计
- **分区布局**: 清晰的功能分区，便于填写
- **响应式设计**: 支持桌面和移动端
- **状态反馈**: 加载、保存、发布状态提示
- **错误提示**: 红色边框和文字提示错误

### 2. 交互设计
- **渐进式填写**: 从基本信息到详细信息
- **智能提示**: 占位符文本提供填写示例
- **操作确认**: 重要操作有明确的状态反馈
- **快捷操作**: 键盘快捷键支持（未来扩展）

### 3. 数据持久化
- **草稿保存**: 防止数据丢失
- **本地缓存**: 临时保存用户输入（未来扩展）
- **恢复机制**: 意外关闭后可恢复内容

## 技术实现要点

### 1. 状态管理
```javascript
// 表单数据状态
const [formData, setFormData] = useState({
  title: '',
  summary: '',
  content: '',
  // ... 其他字段
});

// 错误状态
const [errors, setErrors] = useState({});

// 操作状态
const [loading, setLoading] = useState(false);
const [saving, setSaving] = useState(false);
const [publishing, setPublishing] = useState(false);
```

### 2. 表单处理
```javascript
// 统一的字段更新处理
const handleInputChange = (field, value) => {
  setFormData(prev => ({
    ...prev,
    [field]: value
  }));
  
  // 清除错误提示
  if (errors[field]) {
    setErrors(prev => ({
      ...prev,
      [field]: ''
    }));
  }
};
```

### 3. 自动保存机制
```javascript
// 定时自动保存
useEffect(() => {
  const autoSaveInterval = setInterval(() => {
    if (formData.title.trim() || formData.content.trim()) {
      handleSaveDraft(true); // 自动保存
    }
  }, 30000);

  return () => clearInterval(autoSaveInterval);
}, [formData]);
```

## 路由集成

### App.jsx中的路由配置
```javascript
// 编辑器页面路由
{currentPage === 'post-editor' && isAuthenticated && (
  <PostEditorPage
    onBack={() => {
      setEditingPost(null)
      setCurrentPage('my-posts')
    }}
    editingPost={editingPost}
  />
)}
```

### 导航流程
1. **新建帖子**: MyPostsPage → "写帖子"按钮 → PostEditorPage
2. **编辑帖子**: MyPostsPage → 帖子列表 → "编辑"按钮 → PostEditorPage
3. **返回列表**: PostEditorPage → "返回"按钮 → MyPostsPage

## 扩展功能建议

### 1. 富文本编辑器
- **Markdown支持**: 支持Markdown语法
- **工具栏**: 加粗、斜体、链接等格式化工具
- **实时预览**: 编辑和预览模式切换
- **代码高亮**: 支持代码块语法高亮

### 2. 媒体管理
- **视频上传**: 支持视频文件上传
- **文件管理**: 统一的媒体文件管理
- **云存储**: 集成云存储服务
- **压缩优化**: 自动压缩图片和视频

### 3. 协作功能
- **草稿分享**: 分享草稿给其他用户
- **协同编辑**: 多人协作编辑
- **版本控制**: 保存编辑历史版本
- **评论系统**: 编辑过程中的内部评论

### 4. 智能辅助
- **内容建议**: AI辅助内容创作
- **标签推荐**: 自动推荐相关标签
- **SEO优化**: 关键词密度分析
- **可读性检查**: 内容可读性评分

## 使用流程

### 新建帖子流程
1. 在"我发布的"页面点击"写帖子"
2. 填写帖子标题（必填）
3. 选择帖子类型和分类
4. 编写帖子内容（必填）
5. 上传相关图片（可选）
6. 填写旅行信息（可选）
7. 设置标签和发布选项
8. 点击"发布"按钮完成发布

### 编辑帖子流程
1. 在"我发布的"页面找到要编辑的帖子
2. 点击"编辑"按钮进入编辑模式
3. 修改需要更新的内容
4. 系统自动保存草稿
5. 点击"发布"按钮更新帖子

### 草稿管理流程
1. 编辑过程中系统自动保存草稿
2. 可手动点击"保存草稿"按钮
3. 草稿会显示在"草稿"标签页中
4. 可以从草稿继续编辑或直接发布

这个帖子发布表单充分利用了API接口的所有功能，提供了完整的内容创作和发布体验，支持从简单的文字分享到复杂的旅行攻略等各种类型的内容创作！
