# ç”¨æˆ·é€šçŸ¥ç³»ç»Ÿ - å‰ç«¯æ¥å£æ–‡æ¡£

## ğŸ“Œ æ¥å£æ¦‚è§ˆ

| åŠŸèƒ½ | æ–¹æ³• | æ¥å£åœ°å€ | è¯´æ˜ |
|------|------|----------|------|
| è·å–é€šçŸ¥åˆ—è¡¨ | GET | `/api/notifications/list` | è·å–æ‰€æœ‰é€šçŸ¥ |
| è·å–æœªè¯»é€šçŸ¥ | GET | `/api/notifications/unread` | ä»…è·å–æœªè¯»é€šçŸ¥ |
| æŒ‰ç±»å‹ç­›é€‰ | GET | `/api/notifications/type/{type}` | è·å–æŒ‡å®šç±»å‹é€šçŸ¥ |
| è·å–ç»Ÿè®¡ä¿¡æ¯ | GET | `/api/notifications/stats` | è·å–é€šçŸ¥ç»Ÿè®¡æ•°æ® |
| è·å–æœªè¯»æ•°é‡ | GET | `/api/notifications/unread-count` | è·å–æœªè¯»æ•°é‡ï¼ˆè§’æ ‡ç”¨ï¼‰ |
| æ ‡è®°å·²è¯» | PUT | `/api/notifications/{id}/read` | æ ‡è®°å•æ¡é€šçŸ¥ä¸ºå·²è¯» |
| å…¨éƒ¨å·²è¯» | PUT | `/api/notifications/read-all` | æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯» |
| åˆ é™¤é€šçŸ¥ | DELETE | `/api/notifications/{id}` | åˆ é™¤å•æ¡é€šçŸ¥ |
| åˆ é™¤å·²è¯» | DELETE | `/api/notifications/read-all` | åˆ é™¤æ‰€æœ‰å·²è¯»é€šçŸ¥ |

## ğŸ” è®¤è¯æ–¹å¼

æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦JWT Tokenï¼š

```javascript
headers: {
  'Authorization': 'Bearer ' + token
}
```

## ğŸ“‹ æ¥å£è¯¦æƒ…

### 1. è·å–é€šçŸ¥åˆ—è¡¨

**æ¥å£åœ°å€**ï¼š`GET /api/notifications/list`

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
fetch('http://localhost:8080/api/notifications/list', {
  method: 'GET',
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('token')
  }
})
.then(res => res.json())
.then(data => {
  console.log(data);
});
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "receiverId": 1,
      "senderId": 5,
      "senderUsername": "å¼ ä¸‰",
      "senderAvatarBase64": "iVBORw0KGgoAAAANSUhEUgAA...",
      "notificationType": "COMMENT",
      "notificationTypeDesc": "è¯„è®ºäº†ä½ çš„å¸–å­",
      "postId": 2,
      "postTitle": "ç¾ä¸½çš„æ¡‚æ—ä¹‹æ—…",
      "postCoverImage": "http://example.com/image.jpg",
      "commentId": 10,
      "commentContent": "è¿™ä¸ªåœ°æ–¹å¤ªç¾äº†ï¼",
      "isRead": false,
      "readTime": null,
      "status": "active",
      "createdTime": "2025-11-03T10:30:00",
      "updatedTime": "2025-11-03T10:30:00",
      "timeDesc": "2å°æ—¶å‰"
    }
  ]
}
```

**æ•°æ®å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | number | é€šçŸ¥ID |
| receiverId | number | æ¥æ”¶è€…ç”¨æˆ·ID |
| senderId | number | å‘é€è€…ç”¨æˆ·ID |
| senderUsername | string | å‘é€è€…ç”¨æˆ·å |
| senderAvatarBase64 | string | å‘é€è€…å¤´åƒï¼ˆBase64ç¼–ç ï¼Œå¯ç›´æ¥æ˜¾ç¤ºï¼‰ |
| notificationType | string | é€šçŸ¥ç±»å‹ï¼šCOMMENT/FAVORITE/VIEW |
| notificationTypeDesc | string | é€šçŸ¥æè¿°ï¼šå¦‚"è¯„è®ºäº†ä½ çš„å¸–å­" |
| postId | number | å¸–å­ID |
| postTitle | string | å¸–å­æ ‡é¢˜ |
| postCoverImage | string | å¸–å­å°é¢å›¾URL |
| commentId | number | è¯„è®ºIDï¼ˆä»…è¯„è®ºé€šçŸ¥æœ‰å€¼ï¼‰ |
| commentContent | string | è¯„è®ºå†…å®¹ï¼ˆä»…è¯„è®ºé€šçŸ¥æœ‰å€¼ï¼‰ |
| isRead | boolean | æ˜¯å¦å·²è¯» |
| readTime | string | é˜…è¯»æ—¶é—´ |
| status | string | çŠ¶æ€ |
| createdTime | string | åˆ›å»ºæ—¶é—´ |
| updatedTime | string | æ›´æ–°æ—¶é—´ |
| timeDesc | string | å‹å¥½æ—¶é—´æè¿° |

---

### 2. è·å–æœªè¯»é€šçŸ¥

**æ¥å£åœ°å€**ï¼š`GET /api/notifications/unread`

**ç”¨é€”**ï¼šç”¨äºé€šçŸ¥ä¸­å¿ƒé¡µé¢ï¼Œåªæ˜¾ç¤ºæœªè¯»é€šçŸ¥

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function getUnreadNotifications() {
  const response = await fetch('http://localhost:8080/api/notifications/unread', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    return data.data; // è¿”å›æœªè¯»é€šçŸ¥åˆ—è¡¨
  }
}
```

**å“åº”æ ¼å¼**ï¼šåŒ"è·å–é€šçŸ¥åˆ—è¡¨"

---

### 3. æŒ‰ç±»å‹ç­›é€‰é€šçŸ¥

**æ¥å£åœ°å€**ï¼š`GET /api/notifications/type/{type}`

**è·¯å¾„å‚æ•°**ï¼š
- `type`: é€šçŸ¥ç±»å‹
  - `COMMENT` - è¯„è®ºé€šçŸ¥
  - `FAVORITE` - æ”¶è—é€šçŸ¥
  - `VIEW` - æµè§ˆé€šçŸ¥

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
// è·å–è¯„è®ºé€šçŸ¥
async function getCommentNotifications() {
  const response = await fetch('http://localhost:8080/api/notifications/type/COMMENT', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  return data.data;
}

// è·å–æ”¶è—é€šçŸ¥
async function getFavoriteNotifications() {
  const response = await fetch('http://localhost:8080/api/notifications/type/FAVORITE', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  return data.data;
}
```

**åº”ç”¨åœºæ™¯**ï¼šé€šçŸ¥ä¸­å¿ƒçš„Tabåˆ‡æ¢ï¼ˆå…¨éƒ¨/è¯„è®º/æ”¶è—/æµè§ˆï¼‰

---

### 4. è·å–é€šçŸ¥ç»Ÿè®¡

**æ¥å£åœ°å€**ï¼š`GET /api/notifications/stats`

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function getNotificationStats() {
  const response = await fetch('http://localhost:8080/api/notifications/stats', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  return data.data;
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalCount": 25,
    "unreadCount": 5,
    "commentCount": 15,
    "favoriteCount": 8,
    "viewCount": 2
  }
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `totalCount`: æ€»é€šçŸ¥æ•°
- `unreadCount`: æœªè¯»é€šçŸ¥æ•°
- `commentCount`: è¯„è®ºé€šçŸ¥æ•°
- `favoriteCount`: æ”¶è—é€šçŸ¥æ•°
- `viewCount`: æµè§ˆé€šçŸ¥æ•°

**åº”ç”¨åœºæ™¯**ï¼šé€šçŸ¥ä¸­å¿ƒé¡¶éƒ¨æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯

---

### 5. è·å–æœªè¯»æ•°é‡ â­ï¸ é‡è¦

**æ¥å£åœ°å€**ï¼š`GET /api/notifications/unread-count`

**ç”¨é€”**ï¼šè·å–æœªè¯»é€šçŸ¥æ•°é‡ï¼Œç”¨äºæ˜¾ç¤ºè§’æ ‡

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function updateNotificationBadge() {
  const response = await fetch('http://localhost:8080/api/notifications/unread-count', {
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    const count = data.data.unreadCount;
    // æ›´æ–°è§’æ ‡
    updateBadge(count);
  }
}

// æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
setInterval(updateNotificationBadge, 30000);
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "unreadCount": 5
  }
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- å¯¼èˆªæ é€šçŸ¥å›¾æ ‡è§’æ ‡
- å®šæ—¶è½®è¯¢è·å–æœªè¯»æ•°é‡

---

### 6. æ ‡è®°å•æ¡é€šçŸ¥ä¸ºå·²è¯»

**æ¥å£åœ°å€**ï¼š`PUT /api/notifications/{id}/read`

**è·¯å¾„å‚æ•°**ï¼š
- `id`: é€šçŸ¥ID

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function markAsRead(notificationId) {
  const response = await fetch(`http://localhost:8080/api/notifications/${notificationId}/read`, {
    method: 'PUT',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    console.log('æ ‡è®°æˆåŠŸ');
    // åˆ·æ–°é€šçŸ¥åˆ—è¡¨
    refreshNotifications();
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": "æ ‡è®°æˆåŠŸ"
}
```

**åº”ç”¨åœºæ™¯**ï¼šç”¨æˆ·ç‚¹å‡»é€šçŸ¥æ—¶æ ‡è®°ä¸ºå·²è¯»

---

### 7. æ ‡è®°æ‰€æœ‰é€šçŸ¥ä¸ºå·²è¯»

**æ¥å£åœ°å€**ï¼š`PUT /api/notifications/read-all`

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function markAllAsRead() {
  const response = await fetch('http://localhost:8080/api/notifications/read-all', {
    method: 'PUT',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    console.log(data.data.message); // "å·²æ ‡è®° 5 æ¡é€šçŸ¥ä¸ºå·²è¯»"
    // åˆ·æ–°é€šçŸ¥åˆ—è¡¨
    refreshNotifications();
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "count": 5,
    "message": "å·²æ ‡è®° 5 æ¡é€šçŸ¥ä¸ºå·²è¯»"
  }
}
```

**åº”ç”¨åœºæ™¯**ï¼šé€šçŸ¥ä¸­å¿ƒçš„"å…¨éƒ¨å·²è¯»"æŒ‰é’®

---

### 8. åˆ é™¤å•æ¡é€šçŸ¥

**æ¥å£åœ°å€**ï¼š`DELETE /api/notifications/{id}`

**è·¯å¾„å‚æ•°**ï¼š
- `id`: é€šçŸ¥ID

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function deleteNotification(notificationId) {
  if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡é€šçŸ¥å—ï¼Ÿ')) return;
  
  const response = await fetch(`http://localhost:8080/api/notifications/${notificationId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    console.log('åˆ é™¤æˆåŠŸ');
    // åˆ·æ–°é€šçŸ¥åˆ—è¡¨
    refreshNotifications();
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": "åˆ é™¤æˆåŠŸ"
}
```

---

### 9. åˆ é™¤æ‰€æœ‰å·²è¯»é€šçŸ¥

**æ¥å£åœ°å€**ï¼š`DELETE /api/notifications/read-all`

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
async function deleteAllReadNotifications() {
  if (!confirm('ç¡®å®šè¦åˆ é™¤æ‰€æœ‰å·²è¯»é€šçŸ¥å—ï¼Ÿ')) return;
  
  const response = await fetch('http://localhost:8080/api/notifications/read-all', {
    method: 'DELETE',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('token')
    }
  });
  const data = await response.json();
  
  if (data.code === 200) {
    console.log(data.data.message); // "å·²åˆ é™¤ 10 æ¡å·²è¯»é€šçŸ¥"
    refreshNotifications();
  }
}
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "count": 10,
    "message": "å·²åˆ é™¤ 10 æ¡å·²è¯»é€šçŸ¥"
  }
}
```

---

## ğŸ¨ å‰ç«¯ç»„ä»¶å®ç°ç¤ºä¾‹

### 1. é€šçŸ¥è§’æ ‡ç»„ä»¶

```vue
<template>
  <div class="notification-badge" @click="goToNotificationCenter">
    <i class="icon-bell"></i>
    <span v-if="unreadCount > 0" class="badge">{{ displayCount }}</span>
  </div>
</template>

<script>
export default {
  data() {
    return {
      unreadCount: 0,
      timer: null
    };
  },
  computed: {
    displayCount() {
      return this.unreadCount > 99 ? '99+' : this.unreadCount;
    }
  },
  mounted() {
    this.loadUnreadCount();
    // æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
    this.timer = setInterval(() => {
      this.loadUnreadCount();
    }, 30000);
  },
  beforeDestroy() {
    if (this.timer) {
      clearInterval(this.timer);
    }
  },
  methods: {
    async loadUnreadCount() {
      try {
        const response = await fetch('http://localhost:8080/api/notifications/unread-count', {
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.unreadCount = data.data.unreadCount;
        }
      } catch (error) {
        console.error('è·å–æœªè¯»æ•°é‡å¤±è´¥:', error);
      }
    },
    goToNotificationCenter() {
      this.$router.push('/notifications');
    }
  }
};
</script>

<style scoped>
.notification-badge {
  position: relative;
  cursor: pointer;
}
.badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: #ff4d4f;
  color: white;
  border-radius: 10px;
  padding: 2px 6px;
  font-size: 12px;
  min-width: 20px;
  text-align: center;
}
</style>
```

### 2. é€šçŸ¥åˆ—è¡¨ç»„ä»¶

```vue
<template>
  <div class="notification-list">
    <!-- é¡¶éƒ¨æ“ä½œæ  -->
    <div class="notification-header">
      <h2>é€šçŸ¥ä¸­å¿ƒ</h2>
      <div class="actions">
        <button @click="markAllAsRead">å…¨éƒ¨å·²è¯»</button>
        <button @click="deleteAllRead">æ¸…ç©ºå·²è¯»</button>
      </div>
    </div>

    <!-- Tabåˆ‡æ¢ -->
    <div class="tabs">
      <div 
        :class="['tab', { active: currentTab === 'all' }]" 
        @click="currentTab = 'all'">
        å…¨éƒ¨ ({{ stats.totalCount }})
      </div>
      <div 
        :class="['tab', { active: currentTab === 'COMMENT' }]" 
        @click="currentTab = 'COMMENT'">
        è¯„è®º ({{ stats.commentCount }})
      </div>
      <div 
        :class="['tab', { active: currentTab === 'FAVORITE' }]" 
        @click="currentTab = 'FAVORITE'">
        æ”¶è— ({{ stats.favoriteCount }})
      </div>
    </div>

    <!-- é€šçŸ¥åˆ—è¡¨ -->
    <div class="notifications">
      <div 
        v-for="notification in notifications" 
        :key="notification.id"
        :class="['notification-item', { unread: !notification.isRead }]"
        @click="handleNotificationClick(notification)">
        
        <!-- ç”¨æˆ·å¤´åƒ -->
        <img 
          v-if="notification.senderAvatarBase64"
          :src="'data:image/jpeg;base64,' + notification.senderAvatarBase64" 
          class="avatar"
          alt="å¤´åƒ">
        <div v-else class="avatar-placeholder">
          {{ notification.senderUsername.charAt(0) }}
        </div>

        <!-- é€šçŸ¥å†…å®¹ -->
        <div class="content">
          <div class="message">
            <strong>{{ notification.senderUsername }}</strong>
            {{ notification.notificationTypeDesc }}
            <span class="post-title">ã€Š{{ notification.postTitle }}ã€‹</span>
          </div>
          
          <!-- è¯„è®ºå†…å®¹ -->
          <div v-if="notification.commentContent" class="comment">
            {{ notification.commentContent }}
          </div>

          <div class="time">{{ notification.timeDesc }}</div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="actions">
          <button 
            v-if="!notification.isRead" 
            @click.stop="markAsRead(notification.id)"
            class="btn-read">
            æ ‡è®°å·²è¯»
          </button>
          <button 
            @click.stop="deleteNotification(notification.id)"
            class="btn-delete">
            åˆ é™¤
          </button>
        </div>
      </div>

      <!-- ç©ºçŠ¶æ€ -->
      <div v-if="notifications.length === 0" class="empty">
        <p>æš‚æ— é€šçŸ¥</p>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      currentTab: 'all',
      notifications: [],
      stats: {
        totalCount: 0,
        unreadCount: 0,
        commentCount: 0,
        favoriteCount: 0,
        viewCount: 0
      }
    };
  },
  watch: {
    currentTab() {
      this.loadNotifications();
    }
  },
  mounted() {
    this.loadStats();
    this.loadNotifications();
  },
  methods: {
    async loadStats() {
      try {
        const response = await fetch('http://localhost:8080/api/notifications/stats', {
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.stats = data.data;
        }
      } catch (error) {
        console.error('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
      }
    },

    async loadNotifications() {
      let url = 'http://localhost:8080/api/notifications/';
      
      if (this.currentTab === 'all') {
        url += 'list';
      } else {
        url += 'type/' + this.currentTab;
      }

      try {
        const response = await fetch(url, {
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.notifications = data.data;
        }
      } catch (error) {
        console.error('è·å–é€šçŸ¥åˆ—è¡¨å¤±è´¥:', error);
      }
    },

    async markAsRead(notificationId) {
      try {
        const response = await fetch(`http://localhost:8080/api/notifications/${notificationId}/read`, {
          method: 'PUT',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.$message.success('å·²æ ‡è®°ä¸ºå·²è¯»');
          this.loadNotifications();
          this.loadStats();
        }
      } catch (error) {
        console.error('æ ‡è®°å·²è¯»å¤±è´¥:', error);
      }
    },

    async markAllAsRead() {
      try {
        const response = await fetch('http://localhost:8080/api/notifications/read-all', {
          method: 'PUT',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.$message.success(data.data.message);
          this.loadNotifications();
          this.loadStats();
        }
      } catch (error) {
        console.error('å…¨éƒ¨å·²è¯»å¤±è´¥:', error);
      }
    },

    async deleteNotification(notificationId) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡é€šçŸ¥å—ï¼Ÿ')) return;

      try {
        const response = await fetch(`http://localhost:8080/api/notifications/${notificationId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.$message.success('åˆ é™¤æˆåŠŸ');
          this.loadNotifications();
          this.loadStats();
        }
      } catch (error) {
        console.error('åˆ é™¤å¤±è´¥:', error);
      }
    },

    async deleteAllRead() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å·²è¯»é€šçŸ¥å—ï¼Ÿ')) return;

      try {
        const response = await fetch('http://localhost:8080/api/notifications/read-all', {
          method: 'DELETE',
          headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('token')
          }
        });
        const data = await response.json();
        if (data.code === 200) {
          this.$message.success(data.data.message);
          this.loadNotifications();
          this.loadStats();
        }
      } catch (error) {
        console.error('æ¸…ç©ºå¤±è´¥:', error);
      }
    },

    handleNotificationClick(notification) {
      // æ ‡è®°ä¸ºå·²è¯»
      if (!notification.isRead) {
        this.markAsRead(notification.id);
      }
      
      // è·³è½¬åˆ°å¸–å­è¯¦æƒ…
      this.$router.push(`/post/${notification.postId}`);
    }
  }
};
</script>

<style scoped>
.notification-list {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.notification-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.tabs {
  display: flex;
  border-bottom: 1px solid #e8e8e8;
  margin-bottom: 20px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  border-bottom: 2px solid transparent;
}

.tab.active {
  color: #1890ff;
  border-bottom-color: #1890ff;
}

.notification-item {
  display: flex;
  padding: 16px;
  border-bottom: 1px solid #f0f0f0;
  cursor: pointer;
  transition: background 0.3s;
}

.notification-item:hover {
  background: #fafafa;
}

.notification-item.unread {
  background: #e6f7ff;
}

.avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  margin-right: 12px;
}

.avatar-placeholder {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: #ccc;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
  margin-right: 12px;
}

.content {
  flex: 1;
}

.message {
  margin-bottom: 8px;
}

.post-title {
  color: #1890ff;
}

.comment {
  color: #666;
  font-size: 14px;
  margin-bottom: 8px;
  padding: 8px;
  background: #f5f5f5;
  border-radius: 4px;
}

.time {
  color: #999;
  font-size: 12px;
}

.actions button {
  margin-left: 8px;
  padding: 4px 12px;
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.empty {
  text-align: center;
  padding: 40px;
  color: #999;
}
</style>
```

### 3. Reactç‰ˆæœ¬ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';

function NotificationBadge() {
  const [unreadCount, setUnreadCount] = useState(0);

  useEffect(() => {
    loadUnreadCount();
    const timer = setInterval(loadUnreadCount, 30000);
    return () => clearInterval(timer);
  }, []);

  const loadUnreadCount = async () => {
    try {
      const response = await fetch('http://localhost:8080/api/notifications/unread-count', {
        headers: {
          'Authorization': 'Bearer ' + localStorage.getItem('token')
        }
      });
      const data = await response.json();
      if (data.code === 200) {
        setUnreadCount(data.data.unreadCount);
      }
    } catch (error) {
      console.error('è·å–æœªè¯»æ•°é‡å¤±è´¥:', error);
    }
  };

  return (
    <div className="notification-badge">
      <i className="icon-bell"></i>
      {unreadCount > 0 && (
        <span className="badge">
          {unreadCount > 99 ? '99+' : unreadCount}
        </span>
      )}
    </div>
  );
}

export default NotificationBadge;
```

---

## ğŸ’¡ å¸¸è§ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå¯¼èˆªæ é€šçŸ¥è§’æ ‡

```javascript
// 1. é¡µé¢åŠ è½½æ—¶è·å–æœªè¯»æ•°é‡
// 2. æ¯30ç§’åˆ·æ–°ä¸€æ¬¡
// 3. ç‚¹å‡»è·³è½¬åˆ°é€šçŸ¥ä¸­å¿ƒ
```

### åœºæ™¯2ï¼šé€šçŸ¥ä¸­å¿ƒé¡µé¢

```javascript
// 1. æ˜¾ç¤ºTabåˆ‡æ¢ï¼ˆå…¨éƒ¨/è¯„è®º/æ”¶è—ï¼‰
// 2. æ˜¾ç¤ºé€šçŸ¥åˆ—è¡¨
// 3. æ”¯æŒæ ‡è®°å·²è¯»ã€åˆ é™¤æ“ä½œ
// 4. ç‚¹å‡»é€šçŸ¥è·³è½¬åˆ°å¯¹åº”å¸–å­
```

### åœºæ™¯3ï¼šå®æ—¶æç¤º

```javascript
// å¯é€‰ï¼šä½¿ç”¨WebSocketå®ç°å®æ—¶æ¨é€
// æ”¶åˆ°æ–°é€šçŸ¥æ—¶å¼¹å‡ºæç¤º
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Tokenè¿‡æœŸå¤„ç†

```javascript
async function apiRequest(url, options = {}) {
  const response = await fetch(url, options);
  const data = await response.json();
  
  if (data.code === 401) {
    // Tokenè¿‡æœŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
    localStorage.removeItem('token');
    window.location.href = '/login';
    return;
  }
  
  return data;
}
```

### 2. å¤´åƒæ˜¾ç¤º

```javascript
// å¦‚æœæœ‰Base64å¤´åƒ
<img src={`data:image/jpeg;base64,${notification.senderAvatarBase64}`} />

// å¦‚æœæ²¡æœ‰å¤´åƒï¼Œæ˜¾ç¤ºç”¨æˆ·åé¦–å­—æ¯
<div className="avatar-placeholder">
  {notification.senderUsername.charAt(0)}
</div>
```

### 3. æ—¶é—´æè¿°

åç«¯å·²ç»å¤„ç†å¥½äº†å‹å¥½çš„æ—¶é—´æè¿°ï¼ˆ`timeDesc`ï¼‰ï¼Œå‰ç«¯ç›´æ¥ä½¿ç”¨å³å¯ï¼š
- "åˆšåˆš"
- "5åˆ†é’Ÿå‰"
- "2å°æ—¶å‰"
- "3å¤©å‰"
- "2025-11-03"ï¼ˆè¶…è¿‡7å¤©æ˜¾ç¤ºæ—¥æœŸï¼‰

### 4. é˜²æŠ–å¤„ç†

```javascript
// é¿å…é¢‘ç¹ç‚¹å‡»
let isRequesting = false;

async function markAsRead(id) {
  if (isRequesting) return;
  isRequesting = true;
  
  try {
    await fetch(`/api/notifications/${id}/read`, {
      method: 'PUT',
      headers: { 'Authorization': 'Bearer ' + token }
    });
  } finally {
    isRequesting = false;
  }
}
```

---

## ğŸ”§ é”™è¯¯å¤„ç†

### é”™è¯¯ç è¯´æ˜

| é”™è¯¯ç  | è¯´æ˜ | å¤„ç†æ–¹å¼ |
|--------|------|----------|
| 200 | æˆåŠŸ | æ­£å¸¸å¤„ç† |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æç¤ºç”¨æˆ·ï¼Œæ£€æŸ¥å‚æ•° |
| 401 | æœªç™»å½•/Tokenæ— æ•ˆ | è·³è½¬åˆ°ç™»å½•é¡µ |
| 403 | æƒé™ä¸è¶³ | æç¤ºç”¨æˆ· |
| 404 | èµ„æºä¸å­˜åœ¨ | æç¤ºç”¨æˆ· |
| 500 | æœåŠ¡å™¨é”™è¯¯ | æç¤ºç”¨æˆ·ç¨åé‡è¯• |

### ç»Ÿä¸€é”™è¯¯å¤„ç†

```javascript
async function handleApiResponse(response) {
  const data = await response.json();
  
  switch(data.code) {
    case 200:
      return data.data;
    case 401:
      localStorage.removeItem('token');
      window.location.href = '/login';
      throw new Error('è¯·å…ˆç™»å½•');
    case 400:
    case 403:
    case 404:
      throw new Error(data.message);
    case 500:
      throw new Error('æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
    default:
      throw new Error('æœªçŸ¥é”™è¯¯');
  }
}
```

---

## ğŸ“± ç§»åŠ¨ç«¯é€‚é…å»ºè®®

### 1. ä¸‹æ‹‰åˆ·æ–°

```javascript
// ä½¿ç”¨better-scrollæˆ–å…¶ä»–åº“å®ç°ä¸‹æ‹‰åˆ·æ–°
onPullDownRefresh() {
  this.loadNotifications().then(() => {
    // åœæ­¢åˆ·æ–°åŠ¨ç”»
  });
}
```

### 2. ä¸Šæ‹‰åŠ è½½æ›´å¤š

```javascript
// å¦‚æœé€šçŸ¥å¾ˆå¤šï¼Œå»ºè®®å®ç°åˆ†é¡µåŠ è½½
// åç«¯æš‚æ—¶è¿”å›æ‰€æœ‰æ•°æ®ï¼Œå‰ç«¯å¯ä»¥åšè™šæ‹Ÿæ»šåŠ¨æˆ–åˆ†é¡µ
```

### 3. è§¦æ‘¸æ‰‹åŠ¿

```javascript
// å·¦æ»‘åˆ é™¤é€šçŸ¥
// å¯ä»¥ä½¿ç”¨Hammer.jsç­‰æ‰‹åŠ¿åº“
```

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯•æ­¥éª¤

1. **åˆ›å»ºæµ‹è¯•æ•°æ®**ï¼š
   - ç”¨æˆ·Aç™»å½•ï¼Œåˆ›å»ºå¸–å­
   - ç”¨æˆ·Bç™»å½•ï¼Œè¯„è®º/æ”¶è—ç”¨æˆ·Açš„å¸–å­

2. **æµ‹è¯•æ¥å£**ï¼š
   ```javascript
   // 1. è·å–æœªè¯»æ•°é‡
   GET /api/notifications/unread-count
   
   // 2. è·å–é€šçŸ¥åˆ—è¡¨
   GET /api/notifications/list
   
   // 3. æ ‡è®°å·²è¯»
   PUT /api/notifications/1/read
   ```

3. **éªŒè¯ç»“æœ**ï¼š
   - æ£€æŸ¥æœªè¯»æ•°é‡æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥é€šçŸ¥å†…å®¹æ˜¯å¦å®Œæ•´
   - æ£€æŸ¥å·²è¯»çŠ¶æ€æ˜¯å¦æ›´æ–°

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- å®Œæ•´APIæ–‡æ¡£ï¼š`USER_NOTIFICATION_API_DOCUMENTATION.md`
- å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼š`ç”¨æˆ·é€šçŸ¥ç³»ç»Ÿ-å¿«é€Ÿå¼€å§‹.md`
- Postmanæµ‹è¯•é›†åˆï¼š`notification_api_test.json`

---

## âœ… å¼€å‘æ¸…å•

å‰ç«¯å¼€å‘æ—¶å¯ä»¥æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œï¼š

- [ ] 1. å®ç°é€šçŸ¥è§’æ ‡ç»„ä»¶ï¼ˆè·å–æœªè¯»æ•°é‡ï¼‰
- [ ] 2. å®ç°é€šçŸ¥åˆ—è¡¨é¡µé¢ï¼ˆè·å–é€šçŸ¥åˆ—è¡¨ï¼‰
- [ ] 3. å®ç°Tabåˆ‡æ¢åŠŸèƒ½ï¼ˆæŒ‰ç±»å‹ç­›é€‰ï¼‰
- [ ] 4. å®ç°æ ‡è®°å·²è¯»åŠŸèƒ½
- [ ] 5. å®ç°åˆ é™¤é€šçŸ¥åŠŸèƒ½
- [ ] 6. å®ç°å…¨éƒ¨å·²è¯»åŠŸèƒ½
- [ ] 7. å®ç°æ¸…ç©ºå·²è¯»åŠŸèƒ½
- [ ] 8. å®ç°ç‚¹å‡»é€šçŸ¥è·³è½¬åˆ°å¸–å­è¯¦æƒ…
- [ ] 9. ä¼˜åŒ–æ ·å¼å’Œäº¤äº’
- [ ] 10. æµ‹è¯•å„ç§åœºæ™¯

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸ‰

