# ğŸ”§ åç«¯è¿æ¥é—®é¢˜ä¿®å¤æŒ‡å—

## ğŸ“Š è¯Šæ–­ç»“æœåˆ†æ

æ ¹æ® `websocket-diagnostic.html` çš„æµ‹è¯•ç»“æœï¼š

```
âŒ åç«¯HTTPæœåŠ¡ä¸å¯ç”¨: Failed to fetch
âš ï¸ ç›´è¿åç«¯æœåŠ¡å¼‚å¸¸: 403
```

### é—®é¢˜è§£è¯»

1. **Failed to fetch** - é€šè¿‡ä»£ç†è®¿é—®å¤±è´¥
   - å¯èƒ½æ˜¯å‰ç«¯å¼€å‘æœåŠ¡å™¨æœªå¯åŠ¨
   - æˆ–è€…æœªé€šè¿‡æ­£ç¡®çš„URLè®¿é—®å‰ç«¯

2. **403 Forbidden** - ç›´è¿åç«¯è¢«æ‹’ç»
   - åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆç«¯å£8082å¯è®¿é—®ï¼‰
   - ä½†ç¼ºå°‘CORSé…ç½®ï¼Œæ‹’ç»è·¨åŸŸè¯·æ±‚

---

## ğŸ¯ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨Viteä»£ç†ï¼ˆæ¨èï¼Œé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼‰

#### âœ… ä¼˜ç‚¹
- æ— éœ€ä¿®æ”¹åç«¯ä»£ç 
- è‡ªåŠ¨å¤„ç†è·¨åŸŸé—®é¢˜
- é…ç½®å·²å®Œæˆ

#### ğŸ“ ä½¿ç”¨æ­¥éª¤

1. **å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨**
   ```bash
   npm run dev
   ```

2. **é€šè¿‡å¼€å‘æœåŠ¡å™¨è®¿é—®**
   ```
   âœ… æ­£ç¡®: http://localhost:3000
   âŒ é”™è¯¯: ç›´æ¥æ‰“å¼€ websocket-diagnostic.html æ–‡ä»¶
   ```

3. **éªŒè¯ä»£ç†å·¥ä½œ**
   - æ‰“å¼€æµè§ˆå™¨ï¼š`http://localhost:3000/websocket-diagnostic.html`
   - ç‚¹å‡»"æ£€æŸ¥åç«¯æœåŠ¡"
   - åº”è¯¥çœ‹åˆ°"âœ… åç«¯HTTPæœåŠ¡æ­£å¸¸"

#### ğŸ” å·¥ä½œåŸç†

```
æµè§ˆå™¨ â†’ http://localhost:3000/api/xxx
         â†“ (Viteä»£ç†è½¬å‘)
åç«¯ â† http://localhost:8082/api/xxx
```

---

### æ–¹æ¡ˆäºŒï¼šé…ç½®åç«¯CORSï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœéœ€è¦åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–ç›´æ¥è®¿é—®åç«¯ï¼Œéœ€è¦åœ¨åç«¯æ·»åŠ CORSé…ç½®ã€‚

#### Spring Boot é…ç½®ç¤ºä¾‹

**é€‰é¡¹1ï¼šå…¨å±€é…ç½®ç±»ï¼ˆæ¨èï¼‰**

åˆ›å»ºæ–‡ä»¶ `CorsConfig.java`:

```java
package com.yourpackage.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class CorsConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(true)
                .maxAge(3600);
    }
}
```

**é€‰é¡¹2ï¼šæ§åˆ¶å™¨æ³¨è§£**

åœ¨æ§åˆ¶å™¨ç±»ä¸Šæ·»åŠ ï¼š

```java
@RestController
@CrossOrigin(origins = "*", allowedHeaders = "*")
public class YourController {
    // ...
}
```

**é€‰é¡¹3ï¼šè¿‡æ»¤å™¨é…ç½®**

åˆ›å»º `CorsFilter.java`:

```java
@Component
@Order(Ordered.HIGHEST_PRECEDENCE)
public class CorsFilter implements Filter {
    
    @Override
    public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain)
            throws IOException, ServletException {
        
        HttpServletResponse response = (HttpServletResponse) res;
        HttpServletRequest request = (HttpServletRequest) req;
        
        response.setHeader("Access-Control-Allow-Origin", "*");
        response.setHeader("Access-Control-Allow-Methods", "POST, GET, PUT, OPTIONS, DELETE");
        response.setHeader("Access-Control-Max-Age", "3600");
        response.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization");
        
        if ("OPTIONS".equalsIgnoreCase(request.getMethod())) {
            response.setStatus(HttpServletResponse.SC_OK);
        } else {
            chain.doFilter(req, res);
        }
    }
}
```

---

## ğŸ§ª è¯Šæ–­å·¥å…·ä½¿ç”¨

### 1. è¿è¡ŒNode.jsè¯Šæ–­è„šæœ¬

```bash
node backend-diagnostic.js
```

**æ£€æŸ¥é¡¹ç›®ï¼š**
- âœ… ç«¯å£è¿é€šæ€§
- âœ… HTTPç«¯ç‚¹å“åº”
- âœ… CORSé…ç½®çŠ¶æ€
- âœ… WebSocketæ”¯æŒ

### 2. ä½¿ç”¨æµè§ˆå™¨è¯Šæ–­é¡µé¢

**æ­£ç¡®æ–¹å¼ï¼š**
```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 2. åœ¨æµè§ˆå™¨æ‰“å¼€
http://localhost:3000/websocket-diagnostic.html
```

**é”™è¯¯æ–¹å¼ï¼š**
```
âŒ ç›´æ¥åŒå‡» websocket-diagnostic.html æ–‡ä»¶
   (file:// åè®®æ— æ³•ä½¿ç”¨ä»£ç†)
```

---

## ğŸ“‹ é—®é¢˜æ’æŸ¥æ¸…å•

### âœ… å‰ç«¯æ£€æŸ¥

- [ ] å¼€å‘æœåŠ¡å™¨å·²å¯åŠ¨ (`npm run dev`)
- [ ] é€šè¿‡ `http://localhost:3000` è®¿é—®
- [ ] `vite.config.js` åŒ…å«ä»£ç†é…ç½®
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— CORSé”™è¯¯

### âœ… åç«¯æ£€æŸ¥

- [ ] åç«¯æœåŠ¡è¿è¡Œåœ¨ç«¯å£ 8082
- [ ] å¯ä»¥è®¿é—® `http://localhost:8082`
- [ ] CORSé…ç½®å·²æ·»åŠ ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] WebSocketç«¯ç‚¹å·²é…ç½®

### âœ… ç½‘ç»œæ£€æŸ¥

- [ ] é˜²ç«å¢™å…è®¸ç«¯å£è®¿é—®
- [ ] localhost è§£ææ­£å¸¸
- [ ] ç«¯å£æœªè¢«å ç”¨

---

## ğŸ” å¸¸è§é”™è¯¯åŠè§£å†³

### é”™è¯¯1: Failed to fetch

**åŸå› ï¼š**
- å‰ç«¯æœªé€šè¿‡å¼€å‘æœåŠ¡å™¨è®¿é—®
- å¼€å‘æœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³ï¼š**
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# è®¿é—®
http://localhost:3000
```

### é”™è¯¯2: 403 Forbidden

**åŸå› ï¼š**
- åç«¯æœªé…ç½®CORS
- ç›´æ¥è®¿é—®éœ€è¦è®¤è¯çš„ç«¯ç‚¹

**è§£å†³ï¼š**
- å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨Viteä»£ç†
- ç”Ÿäº§ç¯å¢ƒï¼šé…ç½®åç«¯CORS

### é”™è¯¯3: WebSocketè¿æ¥å¤±è´¥

**åŸå› ï¼š**
- åç«¯WebSocketç«¯ç‚¹æœªé…ç½®
- CORSé—®é¢˜å½±å“WebSocketå‡çº§

**è§£å†³ï¼š**
1. å…ˆè§£å†³HTTPè¿æ¥é—®é¢˜
2. ç¡®è®¤WebSocketç«¯ç‚¹è·¯å¾„
3. æ£€æŸ¥åç«¯WebSocketé…ç½®

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æµç¨‹

### æ­¥éª¤1: å¯åŠ¨æœåŠ¡

```bash
# ç»ˆç«¯1: å¯åŠ¨åç«¯ï¼ˆå‡è®¾ï¼‰
cd backend
./mvnw spring-boot:run

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯
cd hy-front-end
npm run dev
```

### æ­¥éª¤2: è¿è¡Œè¯Šæ–­

```bash
# ç»ˆç«¯3: è¿è¡Œè¯Šæ–­è„šæœ¬
node backend-diagnostic.js
```

### æ­¥éª¤3: æµè§ˆå™¨æµ‹è¯•

1. æ‰“å¼€ï¼š`http://localhost:3000/websocket-diagnostic.html`
2. ç‚¹å‡»æ‰€æœ‰æµ‹è¯•æŒ‰é’®
3. æŸ¥çœ‹ç»“æœ

### é¢„æœŸç»“æœ

**å¼€å‘ç¯å¢ƒï¼ˆé€šè¿‡ä»£ç†ï¼‰ï¼š**
```
âœ… åç«¯HTTPæœåŠ¡æ­£å¸¸
âœ… ä»£ç†WebSocketè¿æ¥æˆåŠŸ
```

**ç›´è¿ï¼ˆé…ç½®CORSåï¼‰ï¼š**
```
âœ… ç›´è¿åç«¯æœåŠ¡æ­£å¸¸
âœ… ç›´è¿WebSocketè¿æ¥æˆåŠŸ
```

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### å¼€å‘ç¯å¢ƒ
1. âœ… ä½¿ç”¨ `npm run dev` å¯åŠ¨
2. âœ… é€šè¿‡ `http://localhost:3000` è®¿é—®
3. âœ… ä¾èµ–Viteä»£ç†å¤„ç†è·¨åŸŸ
4. âœ… ä¸éœ€è¦ä¿®æ”¹åç«¯CORS

### ç”Ÿäº§ç¯å¢ƒ
1. ğŸ”§ åç«¯é…ç½®CORS
2. ğŸ”§ æˆ–ä½¿ç”¨Nginxåå‘ä»£ç†
3. ğŸ”§ ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†APIåœ°å€
4. ğŸ”§ å¯ç”¨HTTPS

### æµ‹è¯•ç¯å¢ƒ
1. ğŸ§ª ä½¿ç”¨è¯Šæ–­å·¥å…·éªŒè¯
2. ğŸ§ª æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
3. ğŸ§ª æŸ¥çœ‹åç«¯æ—¥å¿—
4. ğŸ§ª æµ‹è¯•æ‰€æœ‰å…³é”®ç«¯ç‚¹

---

## ğŸ“ ä»ç„¶æœ‰é—®é¢˜ï¼Ÿ

### æ”¶é›†ä¿¡æ¯

è¿è¡Œä»¥ä¸‹å‘½ä»¤æ”¶é›†è¯Šæ–­ä¿¡æ¯ï¼š

```bash
# 1. è¿è¡Œè¯Šæ–­è„šæœ¬
node backend-diagnostic.js > diagnostic-report.txt

# 2. æ£€æŸ¥ç«¯å£
netstat -ano | findstr :8082
netstat -ano | findstr :3000

# 3. æµ‹è¯•è¿æ¥
curl http://localhost:8082/api/auth/profile
```

### æä¾›ä»¥ä¸‹ä¿¡æ¯

1. `diagnostic-report.txt` å†…å®¹
2. æµè§ˆå™¨æ§åˆ¶å°æˆªå›¾
3. åç«¯å¯åŠ¨æ—¥å¿—
4. è®¿é—®æ–¹å¼ï¼ˆæ˜¯å¦é€šè¿‡å¼€å‘æœåŠ¡å™¨ï¼‰

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- `CORS_TROUBLESHOOTING_GUIDE.md` - CORSè¯¦ç»†é…ç½®
- `websocket-diagnostic.html` - æµè§ˆå™¨è¯Šæ–­å·¥å…·
- `backend-diagnostic.js` - Node.jsè¯Šæ–­è„šæœ¬
- `vite.config.js` - ä»£ç†é…ç½®æ–‡ä»¶

---

**ç°åœ¨è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤æµ‹è¯•ï¼** ğŸš€
