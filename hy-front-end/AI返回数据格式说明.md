# AI 接口返回数据格式说明

## 🎯 目标
让 AI 接口返回路线规划数据，包含经纬度坐标，以便在地图上显示路线。

## 📋 AI 应该返回的 JSON 格式

```json
{
  "fastest": {
    "time": "时间：20分钟",
    "description": "路径：经过3个红绿灯",
    "cost": "费用：停车费约￥10.00"
  },
  "cheapest": {
    "time": "时间：30分钟",
    "description": "路径：避开收费路段,经过4个红绿灯",
    "cost": "费用：停车费约￥8.00"
  },
  "coordinates": {
    "start": {
      "lng": 116.379028,
      "lat": 39.865042,
      "address": "北京长城"
    },
    "end": {
      "lng": 116.427281,
      "lat": 39.903719,
      "address": "北京天安门"
    }
  }
}
```

## 📝 字段说明

### 1. fastest（最快路线方案）
- `time`: 预计时间
- `description`: 路线描述
- `cost`: 费用估算

### 2. cheapest（最省钱路线方案）
- `time`: 预计时间
- `description`: 路线描述
- `cost`: 费用估算

### 3. coordinates（经纬度坐标）⭐ 新增
- `start`: 起点坐标
  - `lng`: 经度
  - `lat`: 纬度
  - `address`: 地址名称
- `end`: 终点坐标
  - `lng`: 经度
  - `lat`: 纬度
  - `address`: 地址名称

## 🔧 在 Dify 中配置

### 方式1：让 AI 直接生成坐标（推荐使用方式2）
在 Dify 工作流中，让 LLM 节点输出上述 JSON 格式。但 LLM 生成的坐标可能不准确。

### 方式2：使用地理编码 API（推荐）
在 Dify 工作流中添加以下步骤：

1. **LLM 节点**：生成路线方案（fastest 和 cheapest）
2. **HTTP 请求节点**（起点地理编码）：
   - 调用高德地图地理编码 API
   - 输入：起点地址
   - 输出：起点经纬度
3. **HTTP 请求节点**（终点地理编码）：
   - 调用高德地图地理编码 API
   - 输入：终点地址
   - 输出：终点经纬度
4. **代码节点**：组合所有数据为最终 JSON 格式

### 高德地图地理编码 API 示例
```
GET https://restapi.amap.com/v3/geocode/geo?address=北京天安门&key=YOUR_KEY
```

返回示例：
```json
{
  "geocodes": [{
    "location": "116.397428,39.90923"
  }]
}
```

## 💡 如果无法获取真实坐标
前端会使用默认坐标或根据城市名称匹配坐标库。但为了最佳体验，建议 AI 返回真实坐标。

## 📌 注意事项
1. 经纬度格式：高德地图使用 GCJ-02 坐标系（火星坐标）
2. 经度范围：-180 到 180
3. 纬度范围：-90 到 90
4. 中国地区经度大约：73-135
5. 中国地区纬度大约：18-54

