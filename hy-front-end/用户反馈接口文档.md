# ç”¨æˆ·åé¦ˆæ¥å£æ–‡æ¡£

## ğŸ“‹ æ¥å£è¯´æ˜

### 1. æäº¤åé¦ˆ â­ï¸ ä¸»æ¥å£

**æ¥å£åœ°å€**ï¼š`POST /api/feedback/submit`

**è¯´æ˜**ï¼šç”¨æˆ·æäº¤åé¦ˆè¡¨å•ï¼Œæ”¯æŒåŒ¿åæäº¤å’Œç™»å½•ç”¨æˆ·æäº¤

**è¯·æ±‚å¤´**ï¼š
```
Content-Type: application/json
Authorization: Bearer <token>  (å¯é€‰ï¼Œå¦‚æœç”¨æˆ·å·²ç™»å½•)
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```javascript
// å‰ç«¯HTMLå·²æœ‰çš„ä»£ç ï¼ˆéœ€è¦ä¿®æ”¹URLï¼‰
const response = await fetch('http://localhost:8080/api/feedback/submit', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        type: "å»ºè®®",          // åé¦ˆç±»å‹ï¼šå»ºè®®/é—®é¢˜/ä½“éªŒ/å…¶ä»–
        score: 5,             // è¯„åˆ†ï¼š1-5ï¼ˆå¯é€‰ï¼‰
        title: "ç•Œé¢å¾ˆç¾è§‚",   // æ ‡é¢˜ï¼ˆå¿…å¡«ï¼Œæœ€å¤š100å­—ç¬¦ï¼‰
        detail: "å¸Œæœ›å¢åŠ æ›´å¤šåŠŸèƒ½", // è¯¦ç»†æè¿°ï¼ˆå¿…å¡«ï¼‰
        email: "user@example.com", // é‚®ç®±ï¼ˆå¯é€‰ï¼‰
        module: "ä¸ªäººä¸­å¿ƒ"     // æ‰€å±æ¨¡å—ï¼ˆå¯é€‰ï¼‰
    })
});
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "feedbackId": 1,
    "message": "åé¦ˆæäº¤æˆåŠŸï¼Œæ„Ÿè°¢æ‚¨çš„å®è´µæ„è§ï¼",
    "status": "pending"
  }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 400,
  "message": "æ ‡é¢˜ä¸èƒ½ä¸ºç©º",
  "data": null
}
```

---

## ğŸ”§ å‰ç«¯é›†æˆ

### ä¿®æ”¹HTMLè¡¨å•æäº¤ä»£ç 

åœ¨ `feedback(1).html` ä¸­ï¼Œæ‰¾åˆ°ç¬¬371è¡Œçš„fetchè¯·æ±‚ï¼Œä¿®æ”¹ä¸ºï¼š

```javascript
// åŸä»£ç ï¼ˆç¬¬371è¡Œï¼‰
const response = await fetch('http://localhost:8081/api/feedback/submit', {

// ä¿®æ”¹ä¸º
const response = await fetch('http://localhost:8080/api/feedback/submit', {
```

**å®Œæ•´ä¿®æ”¹åçš„ä»£ç **ï¼š
```javascript
document.getElementById('btn-submit').addEventListener('click', async () => {
    const type = typeChips.querySelector('.chip.active')?.dataset.value || 'å»ºè®®';
    const payload = {
        type,
        score: score > 0 ? score : null,
        title: titleInput.value.trim(),
        detail: detail.value.trim(),
        email: emailInput.value.trim() || null,
        module: moduleSelect.value || null
    };
    
    // éªŒè¯å¿…å¡«å­—æ®µ
    if (!payload.title || !payload.detail) {
        statusEl.textContent = 'è¯·å¡«å†™æ ‡é¢˜ä¸è¯¦ç»†æè¿°';
        statusEl.classList.remove('success');
        return;
    }
    
    // ç¦ç”¨æäº¤æŒ‰é’®
    const submitBtn = document.getElementById('btn-submit');
    submitBtn.disabled = true;
    submitBtn.textContent = 'æäº¤ä¸­...';
    statusEl.textContent = '';
    
    try {
        // è°ƒç”¨åç«¯API - ä¿®æ”¹è¿™é‡Œçš„URL
        const response = await fetch('http://localhost:8080/api/feedback/submit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        
        if (result.code === 200) {
            statusEl.textContent = 'åé¦ˆæäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„å»ºè®® ğŸ™';
            statusEl.classList.add('success');
            
            // 3ç§’åé‡ç½®è¡¨å•
            setTimeout(() => {
                document.getElementById('btn-reset').click();
            }, 3000);
        } else {
            statusEl.textContent = result.message || 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•';
            statusEl.classList.remove('success');
        }
    } catch (error) {
        console.error('æäº¤åé¦ˆæ—¶å‘ç”Ÿé”™è¯¯:', error);
        statusEl.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨';
        statusEl.classList.remove('success');
    } finally {
        // æ¢å¤æäº¤æŒ‰é’®
        submitBtn.disabled = false;
        submitBtn.textContent = 'æäº¤åé¦ˆ';
    }
});
```

---

## ğŸ¯ ç®¡ç†å‘˜æ¥å£ï¼ˆå¯é€‰ï¼‰

### 2. è·å–æ‰€æœ‰åé¦ˆ

**æ¥å£åœ°å€**ï¼š`GET /api/feedback/list`

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 10,
    "list": [
      {
        "id": 1,
        "feedbackType": "å»ºè®®",
        "title": "ç•Œé¢å¾ˆç¾è§‚",
        "detail": "å¸Œæœ›å¢åŠ æ›´å¤šåŠŸèƒ½",
        "score": 5,
        "email": "user@example.com",
        "module": "ä¸ªäººä¸­å¿ƒ",
        "userId": 1,
        "userIp": "192.168.1.100",
        "status": "pending",
        "statusDesc": "å¾…å¤„ç†",
        "priority": "normal",
        "priorityDesc": "æ™®é€š",
        "createdTime": "2025-11-03T10:00:00"
      }
    ]
  }
}
```

### 3. æŒ‰çŠ¶æ€è·å–åé¦ˆ

**æ¥å£åœ°å€**ï¼š`GET /api/feedback/status/{status}`

**çŠ¶æ€å€¼**ï¼š
- `pending` - å¾…å¤„ç†
- `processing` - å¤„ç†ä¸­
- `resolved` - å·²è§£å†³
- `closed` - å·²å…³é—­

**ç¤ºä¾‹**ï¼š`GET /api/feedback/status/pending`

### 4. æŒ‰ç±»å‹è·å–åé¦ˆ

**æ¥å£åœ°å€**ï¼š`GET /api/feedback/type/{type}`

**ç±»å‹å€¼**ï¼š
- `å»ºè®®`
- `é—®é¢˜`
- `ä½“éªŒ`
- `å…¶ä»–`

**ç¤ºä¾‹**ï¼š`GET /api/feedback/type/é—®é¢˜`

### 5. æ›´æ–°åé¦ˆçŠ¶æ€

**æ¥å£åœ°å€**ï¼š`PUT /api/feedback/{id}/status`

**è¯·æ±‚å‚æ•°**ï¼š
```
status: çŠ¶æ€ï¼ˆpending/processing/resolved/closedï¼‰
handlerNotes: å¤„ç†å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰
```

### 6. åˆ é™¤åé¦ˆ

**æ¥å£åœ°å€**ï¼š`DELETE /api/feedback/{id}`

---

## ğŸ“ æ•°æ®åº“è¡¨ç»“æ„

å·²åˆ›å»ºçš„è¡¨ï¼š`user_feedback`

**æ ¸å¿ƒå­—æ®µ**ï¼š
- `feedback_type` - åé¦ˆç±»å‹
- `title` - æ ‡é¢˜
- `detail` - è¯¦ç»†æè¿°
- `score` - è¯„åˆ†ï¼ˆ1-5ï¼‰
- `email` - è”ç³»é‚®ç®±
- `module` - æ‰€å±æ¨¡å—
- `user_id` - ç”¨æˆ·IDï¼ˆå¦‚æœå·²ç™»å½•ï¼‰
- `user_ip` - æäº¤è€…IP
- `status` - å¤„ç†çŠ¶æ€
- `priority` - ä¼˜å…ˆçº§

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆå§‹åŒ–æ•°æ®åº“

```bash
mysql -u root -p gd_mcp < user_feedback.sql
```

### 2. é‡å¯åç«¯æœåŠ¡

```bash
mvn spring-boot:run
```

### 3. ä¿®æ”¹å‰ç«¯HTML

å°† `feedback(1).html` ç¬¬371è¡Œçš„URLæ”¹ä¸ºï¼š
```
http://localhost:8080/api/feedback/submit
```

### 4. æµ‹è¯•

æ‰“å¼€ `feedback(1).html`ï¼Œå¡«å†™è¡¨å•å¹¶æäº¤ã€‚

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

- [x] æäº¤åé¦ˆï¼ˆæ”¯æŒåŒ¿åå’Œç™»å½•ç”¨æˆ·ï¼‰
- [x] è‡ªåŠ¨è®°å½•ç”¨æˆ·IDï¼ˆå¦‚æœå·²ç™»å½•ï¼‰
- [x] è‡ªåŠ¨è®°å½•ç”¨æˆ·IP
- [x] æ•°æ®éªŒè¯ï¼ˆæ ‡é¢˜ã€æè¿°å¿…å¡«ï¼Œé•¿åº¦é™åˆ¶ï¼‰
- [x] è¯„åˆ†èŒƒå›´éªŒè¯ï¼ˆ1-5ï¼‰
- [x] è‡ªåŠ¨ç¡®å®šä¼˜å…ˆçº§ï¼ˆé—®é¢˜+ä½åˆ†=é«˜ä¼˜å…ˆçº§ï¼‰
- [x] è·å–åé¦ˆåˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
- [x] æŒ‰çŠ¶æ€ç­›é€‰
- [x] æŒ‰ç±»å‹ç­›é€‰
- [x] æ›´æ–°åé¦ˆçŠ¶æ€
- [x] åˆ é™¤åé¦ˆï¼ˆè½¯åˆ é™¤ï¼‰

---

## ğŸ¨ å­—æ®µè¯´æ˜

### åé¦ˆç±»å‹ï¼ˆfeedbackTypeï¼‰
- `å»ºè®®` - åŠŸèƒ½å»ºè®®
- `é—®é¢˜` - é‡åˆ°çš„é—®é¢˜
- `ä½“éªŒ` - ç”¨æˆ·ä½“éªŒåé¦ˆ
- `å…¶ä»–` - å…¶ä»–ç±»å‹

### å¤„ç†çŠ¶æ€ï¼ˆstatusï¼‰
- `pending` - å¾…å¤„ç†ï¼ˆé»˜è®¤ï¼‰
- `processing` - å¤„ç†ä¸­
- `resolved` - å·²è§£å†³
- `closed` - å·²å…³é—­

### ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰
- `low` - ä½
- `normal` - æ™®é€šï¼ˆé»˜è®¤ï¼‰
- `high` - é«˜
- `urgent` - ç´§æ€¥

---

## ğŸ” æµ‹è¯•å»ºè®®

### æµ‹è¯•åœºæ™¯1ï¼šåŒ¿åç”¨æˆ·æäº¤åé¦ˆ
1. ç›´æ¥æ‰“å¼€HTMLé¡µé¢ï¼ˆä¸ç™»å½•ï¼‰
2. å¡«å†™åé¦ˆè¡¨å•
3. æäº¤ï¼Œåº”è¯¥æˆåŠŸ

### æµ‹è¯•åœºæ™¯2ï¼šç™»å½•ç”¨æˆ·æäº¤åé¦ˆ
1. å…ˆç™»å½•ç³»ç»Ÿ
2. æ‰“å¼€åé¦ˆé¡µé¢ï¼ˆå¸¦Tokenï¼‰
3. æäº¤åé¦ˆï¼Œä¼šè‡ªåŠ¨è®°å½•userId

### æµ‹è¯•åœºæ™¯3ï¼šéªŒè¯å¤±è´¥
1. ä¸å¡«æ ‡é¢˜ï¼Œç‚¹æäº¤ â†’ åº”æç¤º"æ ‡é¢˜ä¸èƒ½ä¸ºç©º"
2. ä¸å¡«æè¿°ï¼Œç‚¹æäº¤ â†’ åº”æç¤º"è¯¦ç»†æè¿°ä¸èƒ½ä¸ºç©º"

---

## ğŸ“Š æ•°æ®æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥çœ‹æ‰€æœ‰åé¦ˆ
SELECT * FROM user_feedback ORDER BY created_time DESC;

-- æŸ¥çœ‹å¾…å¤„ç†çš„åé¦ˆ
SELECT * FROM user_feedback WHERE status = 'pending' AND is_deleted = 0;

-- æŸ¥çœ‹æŸä¸ªç”¨æˆ·çš„åé¦ˆ
SELECT * FROM user_feedback WHERE user_id = 1 AND is_deleted = 0;

-- æŒ‰ç±»å‹ç»Ÿè®¡
SELECT feedback_type, COUNT(*) as count 
FROM user_feedback 
WHERE is_deleted = 0 
GROUP BY feedback_type;

-- æŒ‰çŠ¶æ€ç»Ÿè®¡
SELECT status, COUNT(*) as count 
FROM user_feedback 
WHERE is_deleted = 0 
GROUP BY status;
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å·**ï¼šå‰ç«¯HTMLä¸­çš„APIåœ°å€ç«¯å£ä¸º `8080`ï¼ˆä¸æ˜¯8081ï¼‰
2. **è·¨åŸŸ**ï¼šControllerå·²é…ç½® `@CrossOrigin`ï¼Œæ”¯æŒè·¨åŸŸè¯·æ±‚
3. **åŒ¿åæäº¤**ï¼šä¸éœ€è¦ç™»å½•ä¹Ÿå¯ä»¥æäº¤åé¦ˆ
4. **ç™»å½•æäº¤**ï¼šå¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œä¼šè‡ªåŠ¨è®°å½•userId
5. **IPè®°å½•**ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•æäº¤è€…çš„IPåœ°å€
6. **è½¯åˆ é™¤**ï¼šåˆ é™¤æ“ä½œä¸ä¼šçœŸæ­£åˆ é™¤æ•°æ®ï¼Œåªæ˜¯æ ‡è®°ä¸ºå·²åˆ é™¤

---

## ğŸ‰ å®Œæˆ

æ¥å£å·²å…¨éƒ¨å¼€å‘å®Œæˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼

**æ–‡ä»¶æ¸…å•**ï¼š
- âœ… `user_feedback.sql` - æ•°æ®åº“è¡¨
- âœ… `UserFeedback.java` - å®ä½“ç±»
- âœ… `UserFeedbackRepository.java` - æ•°æ®è®¿é—®å±‚
- âœ… `FeedbackSubmitRequest.java` - è¯·æ±‚DTO
- âœ… `FeedbackResponse.java` - å“åº”DTO
- âœ… `FeedbackService.java` - ä¸šåŠ¡é€»è¾‘å±‚
- âœ… `FeedbackController.java` - æ§åˆ¶å™¨

åªéœ€ä¿®æ”¹HTMLä¸­çš„ä¸€è¡Œä»£ç ï¼ˆç¬¬371è¡ŒURLï¼‰ï¼Œå³å¯å®Œæˆå‰åç«¯å¯¹æ¥ï¼

