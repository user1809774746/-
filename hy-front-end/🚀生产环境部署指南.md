# ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ“‹ æœåŠ¡å™¨ä¿¡æ¯

- **æœåŠ¡å™¨IP**: `39.102.62.100`
- **åŸŸå**: `www.amapmcpserver.xyz`
- **åç«¯APIåœ°å€**: `http://www.amapmcpserver.xyz:8081`

---

## âœ… å·²å®Œæˆé…ç½®è°ƒæ•´

### 1. APIé…ç½® (`src/api/config.js`)
- âœ… å·²å°†ç”Ÿäº§ç¯å¢ƒBASE_URLä»æœ¬åœ°IPæ”¹ä¸ºçº¿ä¸ŠåŸŸå
- âœ… å¼€å‘ç¯å¢ƒç»§ç»­ä½¿ç”¨ä»£ç†æ¨¡å¼
- âœ… ç”Ÿäº§ç¯å¢ƒç›´æ¥è®¿é—®: `http://www.amapmcpserver.xyz:8081`

### 2. Viteæ„å»ºé…ç½® (`vite.config.js`)
- âœ… æ·»åŠ ç”Ÿäº§ç¯å¢ƒæ„å»ºä¼˜åŒ–é…ç½®
- âœ… å¯ç”¨ä»£ç åˆ†å‰²ï¼ˆvendorå’Œamapå•ç‹¬æ‰“åŒ…ï¼‰
- âœ… å…³é—­sourcemapä»¥å‡å°ä½“ç§¯
- âœ… ä½¿ç”¨terserå‹ç¼©ä»£ç 

---

## ğŸ› ï¸ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ„å»ºç”Ÿäº§ç‰ˆæœ¬

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

```bash
npm run build
```

æ„å»ºå®Œæˆåä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `dist` æ–‡ä»¶å¤¹ã€‚

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

å°† `dist` æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ï¼š

#### æ–¹å¼1: ä½¿ç”¨SCP
```bash
scp -r dist/* root@39.102.62.100:/var/www/html/
```

#### æ–¹å¼2: ä½¿ç”¨FTP/SFTPå·¥å…·
- FileZilla
- WinSCPï¼ˆWindowsï¼‰
- Cyberduckï¼ˆMacï¼‰

ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„Webç›®å½•ï¼ˆé€šå¸¸æ˜¯ `/var/www/html/` æˆ– `/usr/share/nginx/html/`ï¼‰

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®Nginx

åœ¨æœåŠ¡å™¨ä¸Šé…ç½®Nginxï¼Œæ¨èé…ç½®å¦‚ä¸‹ï¼š

```nginx
server {
    listen 80;
    server_name www.amapmcpserver.xyz amapmcpserver.xyz;

    root /var/www/html;
    index index.html;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†ï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦ç»Ÿä¸€åŸŸåè®¿é—®ï¼‰
    location /api/ {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
}
```

é‡å¯Nginxï¼š
```bash
sudo nginx -t  # æµ‹è¯•é…ç½®
sudo systemctl restart nginx
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡è¯´æ˜

### å¼€å‘ç¯å¢ƒ
- `NODE_ENV=development`
- APIè¯·æ±‚é€šè¿‡Viteä»£ç†è½¬å‘
- ä½¿ç”¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ `http://localhost:3000`

### ç”Ÿäº§ç¯å¢ƒ
- `NODE_ENV=production`
- APIç›´æ¥è¯·æ±‚ `http://www.amapmcpserver.xyz:8081`
- éƒ¨ç½²åˆ°æœåŠ¡å™¨åé€šè¿‡åŸŸåè®¿é—®

---

## ğŸ“¦ æ„å»ºäº§ç‰©è¯´æ˜

æ„å»ºåçš„ `dist` ç›®å½•ç»“æ„ï¼š
```
dist/
â”œâ”€â”€ index.html          # å…¥å£HTMLæ–‡ä»¶
â”œâ”€â”€ assets/             # é™æ€èµ„æº
â”‚   â”œâ”€â”€ index-*.js     # ä¸»è¦JSæ–‡ä»¶
â”‚   â”œâ”€â”€ vendor-*.js    # Reactç­‰ç¬¬ä¸‰æ–¹åº“
â”‚   â”œâ”€â”€ amap-*.js      # é«˜å¾·åœ°å›¾ç›¸å…³
â”‚   â””â”€â”€ *.css          # æ ·å¼æ–‡ä»¶
â””â”€â”€ public/            # å…¬å…±èµ„æºï¼ˆå¦‚logoã€å›¾æ ‡ç­‰ï¼‰
```

---

## ğŸ”’ HTTPSé…ç½®ï¼ˆæ¨èï¼‰

### ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦

1. å®‰è£…Certbot:
```bash
sudo apt install certbot python3-certbot-nginx
```

2. ç”³è¯·è¯ä¹¦:
```bash
sudo certbot --nginx -d www.amapmcpserver.xyz -d amapmcpserver.xyz
```

3. Certbotä¼šè‡ªåŠ¨ä¿®æ”¹Nginxé…ç½®ï¼Œå¯ç”¨HTTPS

4. è®¾ç½®è‡ªåŠ¨ç»­æœŸ:
```bash
sudo certbot renew --dry-run
```

### ä¿®æ”¹APIé…ç½®ä½¿ç”¨HTTPS

å¦‚æœåç«¯ä¹Ÿé…ç½®äº†HTTPSï¼Œéœ€è¦ä¿®æ”¹ `src/api/config.js`:

```javascript
BASE_URL: process.env.NODE_ENV === 'development' 
  ? '' 
  : 'https://www.amapmcpserver.xyz/api',  // ä½¿ç”¨HTTPSå’Œè·¯å¾„å‰ç¼€
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨CDNï¼ˆå¯é€‰ï¼‰
- å°†é™æ€èµ„æºä¸Šä¼ åˆ°CDN
- ä¿®æ”¹ `vite.config.js` ä¸­çš„ `base` é…ç½®

### 2. å¯ç”¨HTTP/2
Nginxé…ç½®ä¸­æ·»åŠ :
```nginx
listen 443 ssl http2;
```

### 3. æµè§ˆå™¨ç¼“å­˜ç­–ç•¥
```nginx
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: APIè¯·æ±‚404
**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹
**è§£å†³**: 
```bash
# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
sudo systemctl status your-backend-service
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8081
```

### é—®é¢˜2: é¡µé¢åˆ·æ–°404
**åŸå› **: Nginxæœªé…ç½®æ­£ç¡®çš„fallback
**è§£å†³**: ç¡®ä¿Nginxé…ç½®ä¸­æœ‰ `try_files $uri $uri/ /index.html;`

### é—®é¢˜3: è·¨åŸŸé—®é¢˜
**åŸå› **: åç«¯æœªé…ç½®CORS
**è§£å†³**: 
- æ–¹æ¡ˆ1: åç«¯æ·»åŠ CORSå¤´
- æ–¹æ¡ˆ2: ä½¿ç”¨Nginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰

### é—®é¢˜4: ç™½å±æˆ–èµ„æºåŠ è½½å¤±è´¥
**åŸå› **: èµ„æºè·¯å¾„ä¸å¯¹
**è§£å†³**: 
```bash
# æ£€æŸ¥distç›®å½•æƒé™
sudo chmod -R 755 /var/www/html/dist
# æ£€æŸ¥æ–‡ä»¶æ‰€æœ‰è€…
sudo chown -R www-data:www-data /var/www/html/dist
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ `39.102.62.100:8081`
- [ ] åŸŸå `www.amapmcpserver.xyz` å·²æ­£ç¡®è§£æåˆ° `39.102.62.100`
- [ ] æ‰§è¡Œ `npm run build` æˆåŠŸç”Ÿæˆ `dist` ç›®å½•
- [ ] `dist` ç›®å½•å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] Nginxé…ç½®æ–‡ä»¶å·²æ›´æ–°
- [ ] Nginxå·²é‡å¯ (`sudo systemctl restart nginx`)
- [ ] é˜²ç«å¢™å·²å¼€æ”¾80ç«¯å£ï¼ˆå’Œ443ç«¯å£å¦‚ä½¿ç”¨HTTPSï¼‰
- [ ] æµè§ˆå™¨è®¿é—® `http://www.amapmcpserver.xyz` èƒ½æ­£å¸¸æ‰“å¼€
- [ ] æ‰€æœ‰APIæ¥å£è°ƒç”¨æ­£å¸¸

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

éƒ¨ç½²å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ï¼š

```bash
# æµ‹è¯•é¦–é¡µè®¿é—®
curl -I http://www.amapmcpserver.xyz

# æµ‹è¯•APIè¿é€šæ€§
curl http://www.amapmcpserver.xyz:8081/api/auth/profile -H "Authorization: Bearer YOUR_TOKEN"

# æ£€æŸ¥DNSè§£æ
nslookup www.amapmcpserver.xyz
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
2. æœåŠ¡å™¨Nginxé”™è¯¯æ—¥å¿—: `/var/log/nginx/error.log`
3. åç«¯æœåŠ¡æ—¥å¿—

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-11-05
**ç‰ˆæœ¬**: 1.0

