# 管理员登录功能说明

## ✅ 已完成的修改

### 问题
之前的登录系统只支持普通用户登录（`userType: 'user'`），管理员无法登录。

### 解决方案
在登录页面添加了**登录身份选择**功能，支持普通用户和管理员两种登录方式。

---

## 🔧 修改内容

### 1. API层修改（`src/api/config.js`）

#### 修改 `loginWithPassword` 函数
```javascript
// 修改前
export const loginWithPassword = async (phone, password) => {
  return await apiRequest(API_CONFIG.ENDPOINTS.LOGIN, {
    method: 'POST',
    body: JSON.stringify({
      phone,
      password,
      userType: 'user' // 固定为普通用户
    })
  })
}

// 修改后
export const loginWithPassword = async (phone, password, userType = 'user') => {
  return await apiRequest(API_CONFIG.ENDPOINTS.LOGIN, {
    method: 'POST',
    body: JSON.stringify({
      phone,
      password,
      userType // 支持传入 userType 参数
    })
  })
}
```

#### 修改 `loginWithCode` 函数
```javascript
// 修改前
export const loginWithCode = async (phone, verificationCode) => {
  return await apiRequest(API_CONFIG.ENDPOINTS.LOGIN_BY_CODE, {
    method: 'POST', 
    body: JSON.stringify({
      phone,
      verificationCode,
      userType: 'user' // 固定为普通用户
    })
  })
}

// 修改后
export const loginWithCode = async (phone, verificationCode, userType = 'user') => {
  return await apiRequest(API_CONFIG.ENDPOINTS.LOGIN_BY_CODE, {
    method: 'POST', 
    body: JSON.stringify({
      phone,
      verificationCode,
      userType // 支持传入 userType 参数
    })
  })
}
```

### 2. 登录页面修改（`src/components/LoginPage.jsx`）

#### 添加用户类型状态
```javascript
const [userType, setUserType] = useState('user') // 'user' 或 'admin'
```

#### 添加登录身份选择器
```html
<!-- 在表单顶部添加 -->
<div className="form-group">
  <label htmlFor="userType">登录身份</label>
  <select
    id="userType"
    value={userType}
    onChange={(e) => setUserType(e.target.value)}
  >
    <option value="user">普通用户</option>
    <option value="admin">管理员</option>
  </select>
</div>
```

#### 登录时传入 userType
```javascript
// 密码登录
response = await loginWithPassword(p, password, userType)

// 验证码登录
response = await loginWithCode(p, c, userType)
```

#### 隐藏管理员不需要的功能
- **七天免密登录**：仅普通用户可见
- **注册按钮**：仅普通用户可见

---

## 📝 管理员账号信息

根据数据库表 `administrator_info` 中的数据：

| 字段 | 值 |
|------|------|
| 管理员名称 | 156156 |
| 手机号 | 18888888888 |
| 密码 | 123123 |

---

## 🎯 使用方法

### 普通用户登录
1. 在登录页面，"登录身份"选择 **普通用户**
2. 输入手机号和密码
3. 点击登录
4. 登录成功后进入主系统

### 管理员登录
1. 在登录页面，"登录身份"选择 **管理员**
2. 输入管理员手机号：`18888888888`
3. 输入密码：`123123`
4. 点击登录
5. 登录成功后**自动跳转到帖子审核管理系统**

---

## 🔐 认证逻辑

### 后端认证流程
```
1. 前端发送登录请求
   - phone: 手机号
   - password: 密码
   - userType: 'user' 或 'admin'

2. 后端根据 userType 查询对应的表
   - userType = 'user' → 查询 user_info 表
   - userType = 'admin' → 查询 administrator_info 表

3. 验证手机号和密码
   - 匹配成功 → 生成 JWT token
   - 匹配失败 → 返回 401 错误

4. 返回 token 和用户信息
   - token: JWT令牌
   - phone: 手机号
   - userType: 用户类型
```

### 前端身份识别流程
```
1. 登录成功后保存 token
2. 调用 /api/auth/user-info 获取详细身份
3. 根据 isAdmin 字段判断：
   - isAdmin = true → 跳转到审核系统
   - isAdmin = false → 跳转到主系统
```

---

## 🎨 界面变化

### 登录页面新增内容
```
┌─────────────────────────────────┐
│            登录                  │
├─────────────────────────────────┤
│ [密码登录] [验证码登录]          │
│                                  │
│ 登录身份                         │
│ [普通用户 ▼]  或  [管理员 ▼]     │ ← 新增
│                                  │
│ 手机号                           │
│ [___________]                    │
│                                  │
│ 密码                             │
│ [___________] 👁                 │
│                                  │
│ [登录]                           │
│                                  │
│ 注册 (管理员登录时隐藏)          │ ← 修改
└─────────────────────────────────┘
```

---

## ⚠️ 注意事项

### 1. 管理员功能限制
- ❌ 不支持注册（需要在数据库手动添加）
- ❌ 不支持七天免密登录
- ❌ 不支持验证码登录（可选支持）
- ✅ 只支持密码登录

### 2. 安全建议
- 管理员密码应使用强密码
- 建议定期更换管理员密码
- 管理员账号应妥善保管，不要泄露

### 3. 数据库管理
添加新管理员需要在数据库中手动插入：
```sql
INSERT INTO administrator_info (admin_name, password, phone, creation_date)
VALUES ('管理员名称', '加密后的密码', '手机号', NOW());
```

---

## 🧪 测试步骤

### 测试管理员登录
```
1. 打开登录页面
2. 点击"登录身份"下拉框，选择"管理员"
3. 输入手机号：18888888888
4. 输入密码：123123
5. 点击"登录"按钮
6. 验证：
   ✓ 是否显示"登录成功"提示
   ✓ 是否自动跳转到"帖子审核管理系统"
   ✓ 是否能看到待审核帖子
```

### 测试普通用户登录
```
1. 打开登录页面
2. 确认"登录身份"为"普通用户"（默认）
3. 输入普通用户手机号和密码
4. 点击"登录"按钮
5. 验证：
   ✓ 是否显示"登录成功"提示
   ✓ 是否跳转到主系统（首页）
   ✓ 是否能看到主系统功能
```

---

## 📊 功能对比

| 功能 | 普通用户 | 管理员 |
|------|---------|--------|
| 密码登录 | ✅ | ✅ |
| 验证码登录 | ✅ | ❌ |
| 七天免密登录 | ✅ | ❌ |
| 注册功能 | ✅ | ❌ |
| 登录后跳转 | 主系统 | 审核系统 |
| 发布帖子 | ✅ | ❌ |
| 审核帖子 | ❌ | ✅ |
| 管理帖子 | ❌ | ✅ |

---

## 🎉 总结

现在系统支持两种登录方式：

1. **普通用户登录**
   - 使用 `userType: 'user'`
   - 查询 `user_info` 表
   - 登录后进入主系统

2. **管理员登录**
   - 使用 `userType: 'admin'`
   - 查询 `administrator_info` 表
   - 登录后进入审核系统

管理员只需在登录页面选择"管理员"身份，输入管理员账号和密码即可登录！✨

