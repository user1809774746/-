# ç¾¤èŠæ¶ˆæ¯è®°å½•æ¥å£æ–‡æ¡£

> **ç‰ˆæœ¬**ï¼šv1.0  
> **æ›´æ–°æ—¶é—´**ï¼š2025-12-10  
> **åŸºç¡€URL**ï¼š`http://localhost:8082/api/group`

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“è¡¨ç»“æ„](#æ•°æ®åº“è¡¨ç»“æ„)
2. [è·å–ç¾¤èŠæ¶ˆæ¯è®°å½•](#1-è·å–ç¾¤èŠæ¶ˆæ¯è®°å½•)
3. [æœç´¢ç¾¤èŠæ¶ˆæ¯](#2-æœç´¢ç¾¤èŠæ¶ˆæ¯)
4. [å‘é€ç¾¤æ¶ˆæ¯ï¼ˆå·²æ›´æ–°ï¼‰](#3-å‘é€ç¾¤æ¶ˆæ¯)
5. [æ•°æ®ç»“æ„è¯´æ˜](#æ•°æ®ç»“æ„è¯´æ˜)
6. [å‰ç«¯é›†æˆç¤ºä¾‹](#å‰ç«¯é›†æˆç¤ºä¾‹)

---

## æ•°æ®åº“è¡¨ç»“æ„

### group_messages è¡¨

å·²åˆ›å»ºä¸“é—¨çš„ç¾¤èŠæ¶ˆæ¯è¡¨ï¼ŒSQLæ–‡ä»¶ï¼š`group_messages_table.sql`

**ä¸»è¦å­—æ®µ**ï¼š

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| message_id | BIGINT | æ¶ˆæ¯IDï¼ˆä¸»é”®ï¼Œè‡ªå¢ï¼‰ |
| group_id | BIGINT | ç¾¤èŠID |
| sender_id | BIGINT | å‘é€è€…ç”¨æˆ·ID |
| message_type | ENUM | æ¶ˆæ¯ç±»å‹ï¼štext/image/voice/video/file/location/link/system |
| content | TEXT | æ¶ˆæ¯å†…å®¹ |
| media_url | VARCHAR(500) | åª’ä½“æ–‡ä»¶URL |
| file_name | VARCHAR(255) | æ–‡ä»¶å |
| media_size | BIGINT | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| reply_to_message_id | BIGINT | å›å¤çš„æ¶ˆæ¯ID |
| is_recalled | TINYINT(1) | æ˜¯å¦å·²æ’¤å› |
| sent_time | DATETIME | å‘é€æ—¶é—´ |

**ç´¢å¼•**ï¼š
- ä¸»é”®ç´¢å¼•ï¼šmessage_id
- å¤åˆç´¢å¼•ï¼šgroup_id + sent_timeï¼ˆç”¨äºåˆ†é¡µæŸ¥è¯¢ï¼‰
- å…¨æ–‡ç´¢å¼•ï¼šcontentï¼ˆç”¨äºæ¶ˆæ¯æœç´¢ï¼‰

---

## 1. è·å–ç¾¤èŠæ¶ˆæ¯è®°å½•

### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`GET /api/group/{groupId}/messages`
- **åŠŸèƒ½è¯´æ˜**ï¼šåˆ†é¡µè·å–ç¾¤èŠçš„æ¶ˆæ¯è®°å½•ï¼ŒæŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
- **æƒé™è¦æ±‚**ï¼šéœ€è¦æ˜¯ç¾¤æˆå‘˜

### è¯·æ±‚å‚æ•°

#### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| groupId | Long | âœ… | ç¾¤ID |

#### æŸ¥è¯¢å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| userId | Long | âœ… | - | å½“å‰ç”¨æˆ·ID |
| page | Integer | âŒ | 1 | é¡µç ï¼ˆä»1å¼€å§‹ï¼‰ |
| size | Integer | âŒ | 20 | æ¯é¡µå¤§å°ï¼ˆæœ€å¤§100ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```http
GET /api/group/1/messages?userId=1&page=1&size=20
Authorization: Bearer <your_token>
```

```javascript
// å‰ç«¯è°ƒç”¨ç¤ºä¾‹
const response = await axios.get('/api/group/1/messages', {
  params: {
    userId: 1,
    page: 1,
    size: 20
  },
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### å“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "messageId": 1001,
      "senderId": 2,
      "senderName": null,
      "senderAvatar": null,
      "groupId": 1,
      "messageType": "text",
      "content": "å¤§å®¶å¥½ï¼",
      "mediaUrl": null,
      "fileName": null,
      "fileSize": null,
      "duration": null,
      "sentTime": "2025-12-10 15:30:00",
      "isRead": false
    },
    {
      "messageId": 1000,
      "senderId": 1,
      "groupId": 1,
      "messageType": "image",
      "content": "[å›¾ç‰‡]",
      "mediaUrl": "http://example.com/images/photo.jpg",
      "fileName": null,
      "fileSize": null,
      "duration": null,
      "sentTime": "2025-12-10 15:25:00",
      "isRead": false
    },
    {
      "messageId": 999,
      "senderId": 3,
      "groupId": 1,
      "messageType": "file",
      "content": "[æ–‡ä»¶]",
      "mediaUrl": "http://example.com/files/document.pdf",
      "fileName": "æŠ€æœ¯æ–‡æ¡£.pdf",
      "fileSize": 2048000,
      "duration": null,
      "sentTime": "2025-12-10 15:20:00",
      "isRead": false
    }
  ]
}
```

#### å¤±è´¥å“åº”

```json
{
  "code": 500,
  "message": "æ‚¨ä¸æ˜¯è¯¥ç¾¤æˆå‘˜",
  "data": null
}
```

### ç‰¹æ®Šè¯´æ˜

1. **æ¶ˆæ¯é¡ºåº**ï¼šè¿”å›çš„æ¶ˆæ¯æŒ‰ `sent_time` å€’åºæ’åˆ—ï¼Œæœ€æ–°çš„æ¶ˆæ¯åœ¨å‰
2. **å·²æ’¤å›æ¶ˆæ¯**ï¼šä¸ä¼šè¿”å›å·²æ’¤å›çš„æ¶ˆæ¯ï¼ˆ`is_recalled = true`ï¼‰
3. **åˆ†é¡µ**ï¼šä½¿ç”¨æ ‡å‡†åˆ†é¡µï¼Œpage ä» 1 å¼€å§‹
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨äº† `group_id + sent_time` å¤åˆç´¢å¼•

---

## 2. æœç´¢ç¾¤èŠæ¶ˆæ¯

### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`GET /api/group/{groupId}/messages/search`
- **åŠŸèƒ½è¯´æ˜**ï¼šåœ¨ç¾¤èŠæ¶ˆæ¯ä¸­æœç´¢å…³é”®è¯ï¼ˆä»…æœç´¢æ–‡æœ¬æ¶ˆæ¯ï¼‰
- **æƒé™è¦æ±‚**ï¼šéœ€è¦æ˜¯ç¾¤æˆå‘˜

### è¯·æ±‚å‚æ•°

#### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| groupId | Long | âœ… | ç¾¤ID |

#### æŸ¥è¯¢å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| userId | Long | âœ… | - | å½“å‰ç”¨æˆ·ID |
| keyword | String | âœ… | - | æœç´¢å…³é”®è¯ |
| page | Integer | âŒ | 1 | é¡µç ï¼ˆä»1å¼€å§‹ï¼‰ |
| size | Integer | âŒ | 20 | æ¯é¡µå¤§å° |

### è¯·æ±‚ç¤ºä¾‹

```http
GET /api/group/1/messages/search?userId=1&keyword=æŠ€æœ¯&page=1&size=20
Authorization: Bearer <your_token>
```

```javascript
// å‰ç«¯è°ƒç”¨ç¤ºä¾‹
const response = await axios.get('/api/group/1/messages/search', {
  params: {
    userId: 1,
    keyword: 'æŠ€æœ¯',
    page: 1,
    size: 20
  },
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### å“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº”

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "messageId": 1050,
      "senderId": 1,
      "groupId": 1,
      "messageType": "text",
      "content": "æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹æŠ€æœ¯é—®é¢˜",
      "mediaUrl": null,
      "sentTime": "2025-12-10 16:00:00",
      "isRead": false
    },
    {
      "messageId": 1020,
      "senderId": 2,
      "groupId": 1,
      "messageType": "text",
      "content": "è¿™ä¸ªæŠ€æœ¯å¾ˆæœ‰æ„æ€",
      "mediaUrl": null,
      "sentTime": "2025-12-10 15:45:00",
      "isRead": false
    }
  ]
}
```

#### å¤±è´¥å“åº”

```json
{
  "code": 500,
  "message": "æœç´¢å…³é”®è¯ä¸èƒ½ä¸ºç©º",
  "data": null
}
```

### æœç´¢è¯´æ˜

1. **æœç´¢èŒƒå›´**ï¼šä»…æœç´¢ `message_type = 'text'` çš„æ¶ˆæ¯
2. **æœç´¢æ–¹å¼**ï¼šä½¿ç”¨ LIKE æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚æœæ•°æ®åº“æ”¯æŒï¼Œå¯ä½¿ç”¨å…¨æ–‡ç´¢å¼•ï¼‰
3. **ä¸æœç´¢**ï¼šå·²æ’¤å›çš„æ¶ˆæ¯ä¸ä¼šå‡ºç°åœ¨æœç´¢ç»“æœä¸­
4. **ç»“æœæ’åº**ï¼šæŒ‰æ—¶é—´å€’åºæ’åˆ—

---

## 3. å‘é€ç¾¤æ¶ˆæ¯

### æ¥å£ä¿¡æ¯

- **æ¥å£åœ°å€**ï¼š`POST /api/group/{groupId}/send-message`
- **åŠŸèƒ½è¯´æ˜**ï¼šå‘é€ç¾¤æ¶ˆæ¯ï¼ˆå·²æ›´æ–°ï¼šç°åœ¨ä¼šä¿å­˜åˆ°æ•°æ®åº“ï¼‰
- **æƒé™è¦æ±‚**ï¼šéœ€è¦æ˜¯ç¾¤æˆå‘˜ï¼Œä¸”æœªè¢«ç¦è¨€

### è¯·æ±‚å‚æ•°

#### è·¯å¾„å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| groupId | Long | âœ… | ç¾¤ID |

#### è¯·æ±‚ä½“

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| senderId | Long | âœ… | å‘é€è€…ç”¨æˆ·ID |
| messageType | String | âœ… | æ¶ˆæ¯ç±»å‹ï¼štext/image/voice/video/file |
| content | String | âœ… | æ¶ˆæ¯å†…å®¹ |
| mediaUrl | String | âŒ | åª’ä½“æ–‡ä»¶URLï¼ˆå›¾ç‰‡ã€è¯­éŸ³ã€è§†é¢‘ã€æ–‡ä»¶ï¼‰ |
| fileName | String | âŒ | æ–‡ä»¶åï¼ˆæ–‡ä»¶ç±»å‹æ—¶ï¼‰ |
| fileSize | Long | âŒ | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```json
POST /api/group/1/send-message
Content-Type: application/json
Authorization: Bearer <your_token>

{
  "senderId": 1,
  "messageType": "text",
  "content": "å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æŠ€æœ¯äº¤æµç¾¤ï¼"
}
```

```javascript
// å‰ç«¯è°ƒç”¨ç¤ºä¾‹
const response = await axios.post('/api/group/1/send-message', {
  senderId: currentUserId,
  messageType: 'text',
  content: 'å¤§å®¶å¥½ï¼'
}, {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
```

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "ç¾¤æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "messageId": 1001,
    "senderId": 1,
    "groupId": 1,
    "messageType": "text",
    "content": "å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æŠ€æœ¯äº¤æµç¾¤ï¼",
    "mediaUrl": null,
    "sentTime": "2025-12-10 16:05:00",
    "isRead": false
  }
}
```

### æ›´æ–°è¯´æ˜

âœ… **å·²æ›´æ–°**ï¼šå‘é€çš„æ¶ˆæ¯ç°åœ¨ä¼šï¼š
1. ä¿å­˜åˆ° `group_messages` è¡¨
2. è¿”å›åŒ…å«çœŸå® `messageId` çš„å“åº”
3. é€šè¿‡ WebSocket æ¨é€ç»™å…¶ä»–ç¾¤æˆå‘˜
4. æ›´æ–°ç¾¤æˆå‘˜çš„æœªè¯»è®¡æ•°

---

## æ•°æ®ç»“æ„è¯´æ˜

### MessageDTO ç»“æ„

```typescript
interface MessageDTO {
  messageId: number;        // æ¶ˆæ¯ID
  senderId: number;         // å‘é€è€…ID
  senderName?: string;      // å‘é€è€…åç§°ï¼ˆå¯é€‰ï¼‰
  senderAvatar?: string;    // å‘é€è€…å¤´åƒï¼ˆå¯é€‰ï¼‰
  groupId?: number;         // ç¾¤IDï¼ˆç¾¤æ¶ˆæ¯æ—¶æœ‰å€¼ï¼‰
  messageType: string;      // æ¶ˆæ¯ç±»å‹
  content: string;          // æ¶ˆæ¯å†…å®¹
  mediaUrl?: string;        // åª’ä½“URL
  fileName?: string;        // æ–‡ä»¶å
  fileSize?: number;        // æ–‡ä»¶å¤§å°
  duration?: number;        // æ—¶é•¿ï¼ˆç§’ï¼‰
  sentTime: string;         // å‘é€æ—¶é—´
  isRead: boolean;          // æ˜¯å¦å·²è¯»
}
```

### æ¶ˆæ¯ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | contentå†…å®¹ | mediaUrl |
|------|------|-------------|----------|
| text | æ–‡æœ¬æ¶ˆæ¯ | æ–‡æœ¬å†…å®¹ | null |
| image | å›¾ç‰‡æ¶ˆæ¯ | "[å›¾ç‰‡]" | å›¾ç‰‡URL |
| voice | è¯­éŸ³æ¶ˆæ¯ | "[è¯­éŸ³]" | è¯­éŸ³URL |
| video | è§†é¢‘æ¶ˆæ¯ | "[è§†é¢‘]" | è§†é¢‘URL |
| file | æ–‡ä»¶æ¶ˆæ¯ | "[æ–‡ä»¶]" | æ–‡ä»¶URL |
| location | ä½ç½®æ¶ˆæ¯ | ä½ç½®æè¿° | null |
| link | é“¾æ¥æ¶ˆæ¯ | é“¾æ¥æ ‡é¢˜ | é“¾æ¥URL |
| system | ç³»ç»Ÿæ¶ˆæ¯ | ç³»ç»Ÿæç¤ºå†…å®¹ | null |

---

## å‰ç«¯é›†æˆç¤ºä¾‹

### React å®Œæ•´ç¤ºä¾‹

```javascript
import React, { useState, useEffect } from 'react';
import axios from 'axios';

const BASE_URL = 'http://localhost:8082/api/group';

function GroupChatMessages({ groupId, currentUserId }) {
  const [messages, setMessages] = useState([]);
  const [loading, setLoading] = useState(false);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);

  // è·å–æ¶ˆæ¯åˆ—è¡¨
  const fetchMessages = async (pageNum = 1) => {
    setLoading(true);
    try {
      const response = await axios.get(`${BASE_URL}/${groupId}/messages`, {
        params: {
          userId: currentUserId,
          page: pageNum,
          size: 20
        },
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      if (response.data.code === 200) {
        const newMessages = response.data.data;
        
        if (pageNum === 1) {
          setMessages(newMessages);
        } else {
          setMessages(prev => [...prev, ...newMessages]);
        }
        
        setHasMore(newMessages.length === 20);
      }
    } catch (error) {
      console.error('è·å–æ¶ˆæ¯å¤±è´¥:', error);
      alert('è·å–æ¶ˆæ¯å¤±è´¥: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  // æœç´¢æ¶ˆæ¯
  const searchMessages = async (keyword) => {
    if (!keyword.trim()) return;
    
    setLoading(true);
    try {
      const response = await axios.get(`${BASE_URL}/${groupId}/messages/search`, {
        params: {
          userId: currentUserId,
          keyword: keyword.trim(),
          page: 1,
          size: 20
        },
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        }
      });

      if (response.data.code === 200) {
        setMessages(response.data.data);
      }
    } catch (error) {
      console.error('æœç´¢æ¶ˆæ¯å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  // åŠ è½½æ›´å¤š
  const loadMore = () => {
    if (!loading && hasMore) {
      const nextPage = page + 1;
      setPage(nextPage);
      fetchMessages(nextPage);
    }
  };

  // åˆå§‹åŠ è½½
  useEffect(() => {
    fetchMessages(1);
  }, [groupId]);

  return (
    <div className="chat-messages">
      {/* æœç´¢æ¡† */}
      <div className="search-box">
        <input
          type="text"
          placeholder="æœç´¢æ¶ˆæ¯..."
          onKeyPress={(e) => {
            if (e.key === 'Enter') {
              searchMessages(e.target.value);
            }
          }}
        />
      </div>

      {/* æ¶ˆæ¯åˆ—è¡¨ */}
      <div className="messages-list">
        {messages.map(msg => (
          <div key={msg.messageId} className="message-item">
            <div className="sender">
              {msg.senderName || `ç”¨æˆ·${msg.senderId}`}
            </div>
            <div className="content">
              {msg.messageType === 'text' && msg.content}
              {msg.messageType === 'image' && (
                <img src={msg.mediaUrl} alt="å›¾ç‰‡" />
              )}
              {msg.messageType === 'file' && (
                <a href={msg.mediaUrl} download={msg.fileName}>
                  ğŸ“ {msg.fileName}
                </a>
              )}
            </div>
            <div className="time">{msg.sentTime}</div>
          </div>
        ))}
        
        {hasMore && (
          <button onClick={loadMore} disabled={loading}>
            {loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}
          </button>
        )}
      </div>
    </div>
  );
}

export default GroupChatMessages;
```

### Vue 3 ç¤ºä¾‹

```vue
<template>
  <div class="chat-messages">
    <!-- æœç´¢æ¡† -->
    <div class="search-box">
      <input
        v-model="searchKeyword"
        @keyup.enter="handleSearch"
        placeholder="æœç´¢æ¶ˆæ¯..."
      />
    </div>

    <!-- æ¶ˆæ¯åˆ—è¡¨ -->
    <div class="messages-list">
      <div
        v-for="msg in messages"
        :key="msg.messageId"
        class="message-item"
      >
        <div class="sender">{{ msg.senderName || `ç”¨æˆ·${msg.senderId}` }}</div>
        <div class="content">{{ msg.content }}</div>
        <div class="time">{{ msg.sentTime }}</div>
      </div>
      
      <button v-if="hasMore" @click="loadMore" :disabled="loading">
        {{ loading ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š' }}
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import axios from 'axios';

const props = defineProps({
  groupId: Number,
  currentUserId: Number
});

const messages = ref([]);
const loading = ref(false);
const page = ref(1);
const hasMore = ref(true);
const searchKeyword = ref('');

const BASE_URL = 'http://localhost:8082/api/group';

// è·å–æ¶ˆæ¯
const fetchMessages = async (pageNum = 1) => {
  loading.value = true;
  try {
    const response = await axios.get(`${BASE_URL}/${props.groupId}/messages`, {
      params: {
        userId: props.currentUserId,
        page: pageNum,
        size: 20
      }
    });

    if (response.data.code === 200) {
      const newMessages = response.data.data;
      if (pageNum === 1) {
        messages.value = newMessages;
      } else {
        messages.value.push(...newMessages);
      }
      hasMore.value = newMessages.length === 20;
    }
  } catch (error) {
    console.error('è·å–æ¶ˆæ¯å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

// æœç´¢æ¶ˆæ¯
const handleSearch = async () => {
  if (!searchKeyword.value.trim()) return;
  
  loading.value = true;
  try {
    const response = await axios.get(`${BASE_URL}/${props.groupId}/messages/search`, {
      params: {
        userId: props.currentUserId,
        keyword: searchKeyword.value.trim(),
        page: 1,
        size: 20
      }
    });

    if (response.data.code === 200) {
      messages.value = response.data.data;
    }
  } catch (error) {
    console.error('æœç´¢å¤±è´¥:', error);
  } finally {
    loading.value = false;
  }
};

// åŠ è½½æ›´å¤š
const loadMore = () => {
  if (!loading.value && hasMore.value) {
    page.value++;
    fetchMessages(page.value);
  }
};

onMounted(() => {
  fetchMessages(1);
});
</script>
```

---

## ä½¿ç”¨æ­¥éª¤

### 1. æ‰§è¡Œæ•°æ®åº“è„šæœ¬

```bash
mysql -u root -p gd_mcp < group_messages_table.sql
```

### 2. é‡å¯åç«¯æœåŠ¡

```bash
mvn spring-boot:run
```

### 3. å‰ç«¯è°ƒç”¨

æŒ‰ç…§ä¸Šé¢çš„ç¤ºä¾‹ä»£ç é›†æˆåˆ°å‰ç«¯é¡¹ç›®ã€‚

---

## å¸¸è§é—®é¢˜

### Q1: æ¶ˆæ¯é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ
**A**: é»˜è®¤æŒ‰å‘é€æ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°çš„æ¶ˆæ¯åœ¨æœ€å‰é¢ã€‚å¦‚æœéœ€è¦æ­£åºï¼ˆæ—§æ¶ˆæ¯åœ¨å‰ï¼‰ï¼Œå¯ä»¥åœ¨å‰ç«¯åè½¬æ•°ç»„ã€‚

### Q2: å¦‚ä½•å®ç°æ— é™æ»šåŠ¨åŠ è½½ï¼Ÿ
**A**: ä½¿ç”¨ `IntersectionObserver` API ç›‘å¬æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œç„¶åè°ƒç”¨ `loadMore()` åŠ è½½ä¸‹ä¸€é¡µã€‚

### Q3: æœç´¢æ”¯æŒä»€ä¹ˆè¯­æ³•ï¼Ÿ
**A**: å½“å‰ä½¿ç”¨ LIKE æ¨¡ç³ŠåŒ¹é…ï¼Œæ”¯æŒä¸­æ–‡å’Œè‹±æ–‡ã€‚å¦‚æœéœ€è¦æ›´å¼ºå¤§çš„æœç´¢ï¼Œå¯ä»¥ä½¿ç”¨ MySQL å…¨æ–‡ç´¢å¼•ã€‚

### Q4: å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆåç§°ã€å¤´åƒï¼‰ï¼Ÿ
**A**: å½“å‰æ¥å£åªè¿”å› `senderId`ï¼Œå‰ç«¯éœ€è¦ï¼š
1. è°ƒç”¨ç”¨æˆ·ä¿¡æ¯æ¥å£è·å–è¯¦æƒ…
2. æˆ–è€…åç«¯å¯ä»¥æ‰©å±•ï¼Œä½¿ç”¨ JOIN æŸ¥è¯¢åŒæ—¶è¿”å›ç”¨æˆ·ä¿¡æ¯

### Q5: å·²æ’¤å›çš„æ¶ˆæ¯å¦‚ä½•å¤„ç†ï¼Ÿ
**A**: å·²æ’¤å›çš„æ¶ˆæ¯ä¸ä¼šåœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºã€‚å¦‚æœéœ€è¦æ˜¾ç¤º"XXXæ’¤å›äº†ä¸€æ¡æ¶ˆæ¯"ï¼Œéœ€è¦ï¼š
1. å‘é€ç³»ç»Ÿæ¶ˆæ¯è®°å½•æ’¤å›åŠ¨ä½œ
2. æˆ–è€…å‰ç«¯ç¼“å­˜æ¶ˆæ¯ï¼ŒWebSocket æ”¶åˆ°æ’¤å›é€šçŸ¥åæ˜¾ç¤ºå ä½ç¬¦

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. åˆ†é¡µå¤§å°
- ç§»åŠ¨ç«¯ï¼šå»ºè®® `size=20`
- PCç«¯ï¼šå»ºè®® `size=50`
- ä¸è¦è¶…è¿‡ 100ï¼Œé¿å…ä¸€æ¬¡åŠ è½½è¿‡å¤šæ•°æ®

### 2. ç¼“å­˜ç­–ç•¥
```javascript
// ä½¿ç”¨ Map ç¼“å­˜å·²åŠ è½½çš„é¡µ
const messageCache = new Map();

const fetchMessages = async (page) => {
  if (messageCache.has(page)) {
    return messageCache.get(page);
  }
  
  const response = await axios.get(...);
  messageCache.set(page, response.data.data);
  return response.data.data;
};
```

### 3. è™šæ‹Ÿæ»šåŠ¨
å¯¹äºæ¶ˆæ¯é‡å¾ˆå¤§çš„ç¾¤ï¼Œå»ºè®®ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨åº“ï¼š
- React: `react-virtualized` æˆ– `react-window`
- Vue: `vue-virtual-scroller`

---

## æµ‹è¯•ç”¨ä¾‹

### Postman æµ‹è¯•

#### 1. è·å–æ¶ˆæ¯åˆ—è¡¨
```
GET http://localhost:8082/api/group/1/messages?userId=1&page=1&size=20
Headers:
  Authorization: Bearer <token>
```

#### 2. æœç´¢æ¶ˆæ¯
```
GET http://localhost:8082/api/group/1/messages/search?userId=1&keyword=æŠ€æœ¯&page=1&size=20
Headers:
  Authorization: Bearer <token>
```

---

## æ›´æ–°æ—¥å¿—

### v1.0 (2025-12-10)
- âœ… åˆ›å»º `group_messages` è¡¨
- âœ… å®ç°è·å–ç¾¤èŠæ¶ˆæ¯è®°å½•æ¥å£
- âœ… å®ç°æœç´¢ç¾¤èŠæ¶ˆæ¯æ¥å£
- âœ… æ›´æ–°å‘é€ç¾¤æ¶ˆæ¯æ¥å£ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰
- âœ… æ·»åŠ æ¶ˆæ¯åˆ†é¡µåŠŸèƒ½
- âœ… æ·»åŠ æ¶ˆæ¯æœç´¢åŠŸèƒ½

---

**æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´**ï¼š2025-12-10 16:00
