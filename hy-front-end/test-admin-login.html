<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>ç®¡ç†å‘˜ç™»å½•æµ‹è¯•å·¥å…·</h1>
    
    <div class="form-group">
        <label for="apiUrl">APIåœ°å€ï¼š</label>
        <input type="text" id="apiUrl" value="http://localhost:8081/api/auth/login" />
    </div>

    <div class="form-group">
        <label for="userType">ç”¨æˆ·ç±»å‹ï¼š</label>
        <select id="userType">
            <option value="user">æ™®é€šç”¨æˆ· (user)</option>
            <option value="admin" selected>ç®¡ç†å‘˜ (admin)</option>
        </select>
    </div>

    <div class="form-group">
        <label for="phone">æ‰‹æœºå·ï¼š</label>
        <input type="text" id="phone" value="18888888888" />
    </div>

    <div class="form-group">
        <label for="password">å¯†ç ï¼š</label>
        <input type="text" id="password" value="123123" />
    </div>

    <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
    <button onclick="testDirectQuery()">æµ‹è¯•æ•°æ®åº“æŸ¥è¯¢</button>

    <div id="result"></div>

    <script>
        async function testLogin() {
            const apiUrl = document.getElementById('apiUrl').value;
            const userType = document.getElementById('userType').value;
            const phone = document.getElementById('phone').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');

            const requestData = {
                phone: phone,
                password: password,
                userType: userType
            };

            resultDiv.innerHTML = '<div class="info">æ­£åœ¨æµ‹è¯•ç™»å½•...</div>';

            try {
                console.log('å‘é€è¯·æ±‚:', requestData);
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                console.log('å“åº”çŠ¶æ€:', response.status);
                
                const data = await response.json();
                console.log('å“åº”æ•°æ®:', data);

                let resultHtml = `
                    <div class="${data.code === 200 ? 'success' : 'error'}">
                        <h3>æµ‹è¯•ç»“æœ</h3>
                        <p><strong>HTTPçŠ¶æ€ç :</strong> ${response.status}</p>
                        <p><strong>å“åº”ç :</strong> ${data.code}</p>
                        <p><strong>æ¶ˆæ¯:</strong> ${data.message || data.msg}</p>
                        <p><strong>å®Œæ•´å“åº”:</strong></p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

                if (data.code === 200 && data.data && data.data.token) {
                    resultHtml += `
                        <div class="success" style="margin-top: 10px;">
                            <h4>âœ… ç™»å½•æˆåŠŸï¼</h4>
                            <p><strong>Token:</strong> ${data.data.token.substring(0, 50)}...</p>
                            <p><strong>æ‰‹æœºå·:</strong> ${data.data.phone}</p>
                            <p><strong>ç”¨æˆ·ç±»å‹:</strong> ${data.data.userType}</p>
                        </div>
                    `;
                }

                resultDiv.innerHTML = resultHtml;

            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p><strong>è¯´æ˜:</strong> å¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–åç«¯æœåŠ¡æœªå¯åŠ¨</p>
                    </div>
                `;
            }
        }

        async function testDirectQuery() {
            const resultDiv = document.getElementById('result');
            const phone = document.getElementById('phone').value;
            
            resultDiv.innerHTML = `
                <div class="info">
                    <h3>ğŸ“‹ æ•°æ®åº“ä¿¡æ¯æ£€æŸ¥</h3>
                    <p><strong>ç®¡ç†å‘˜è¡¨:</strong> administrator_info</p>
                    <p><strong>æŸ¥è¯¢æ¡ä»¶:</strong> phone = '${phone}'</p>
                    <p><strong>é¢„æœŸæ•°æ®:</strong></p>
                    <pre>
admin_name: 156156
phone: 18888888888
password: 123123 (æ˜æ–‡å­˜å‚¨)
                    </pre>
                    <h4>âš ï¸ å¯èƒ½çš„é—®é¢˜ï¼š</h4>
                    <ul>
                        <li>åç«¯å¯èƒ½å¯¹å¯†ç è¿›è¡Œäº†åŠ å¯†ï¼ˆBCryptã€MD5ç­‰ï¼‰</li>
                        <li>æ•°æ®åº“ä¸­çš„å¯†ç å¯èƒ½ä¸æ˜¯æ˜æ–‡</li>
                        <li>åç«¯éªŒè¯é€»è¾‘å¯èƒ½æœ‰é—®é¢˜</li>
                    </ul>
                    <h4>ğŸ” å»ºè®®æ£€æŸ¥ï¼š</h4>
                    <ol>
                        <li>æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œç¡®è®¤æ”¶åˆ°çš„è¯·æ±‚å‚æ•°</li>
                        <li>æ£€æŸ¥åç«¯ AuthController çš„ login æ–¹æ³•</li>
                        <li>ç¡®è®¤åç«¯ä½¿ç”¨çš„å¯†ç åŠ å¯†æ–¹å¼</li>
                        <li>å°è¯•ä½¿ç”¨åŠ å¯†åçš„å¯†ç </li>
                    </ol>
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºè¯´æ˜
        window.onload = function() {
            document.getElementById('result').innerHTML = `
                <div class="info">
                    <h3>ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
                    <ol>
                        <li>ç¡®è®¤åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆé»˜è®¤ç«¯å£ï¼š8081ï¼‰</li>
                        <li>å¡«å†™ç®¡ç†å‘˜è´¦å·ä¿¡æ¯ï¼ˆé»˜è®¤å·²å¡«å†™ï¼‰</li>
                        <li>ç‚¹å‡»"æµ‹è¯•ç™»å½•"æŸ¥çœ‹ç»“æœ</li>
                        <li>å¦‚æœå¤±è´¥ï¼ŒæŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</li>
                    </ol>
                    <h4>ğŸ’¡ æç¤º</h4>
                    <p>å¦‚æœç™»å½•å¤±è´¥æ˜¾ç¤º"æ‰‹æœºå·æˆ–å¯†ç é”™è¯¯"ï¼Œå¯èƒ½æ˜¯ï¼š</p>
                    <ul>
                        <li>âŒ å¯†ç åœ¨æ•°æ®åº“ä¸­æ˜¯åŠ å¯†å­˜å‚¨çš„ï¼Œä¸æ˜¯æ˜æ–‡ '123123'</li>
                        <li>âŒ åç«¯æ²¡æœ‰æ­£ç¡®å®ç°ç®¡ç†å‘˜ç™»å½•é€»è¾‘</li>
                        <li>âŒ admin_name å’Œ phone å­—æ®µåŒ¹é…é€»è¾‘æœ‰é—®é¢˜</li>
                    </ul>
                </div>
            `;
        };
    </script>
</body>
</html>

