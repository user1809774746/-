# 帖子审核系统 - 前端集成完成说明

## ✅ 已完成的功能

### 1. 管理员身份识别和路由跳转

#### 实现位置
- `src/App.jsx`
- `src/api/config.js` (新增用户身份查询API)

#### 功能说明
- **自动身份识别**：用户登录时自动调用 `/api/auth/user-info` 接口获取身份信息
- **智能路由跳转**：
  - 普通用户登录 → 进入主系统（`home`页面）
  - 管理员登录 → 进入帖子审核系统（`admin-review`页面）
- **持久化支持**：App启动时自动检查token和用户身份，保持登录状态

#### 关键代码
```javascript
// 登录成功后检查用户身份
const userInfoResponse = await getUserInfo()
if (userInfoResponse.data.isAdmin) {
  console.log('👑 管理员登录成功，进入审核系统')
  setCurrentPage('admin-review')
} else {
  console.log('👤 普通用户登录成功，进入主系统')
  setCurrentPage('home')
}
```

---

### 2. 管理员审核系统页面

#### 实现位置
- `src/components/AdminPostReviewPage.jsx` ✨ 新增文件

#### 功能特性

##### 📊 三大功能模块

**1. 待审核帖子列表**
- 显示所有 `audit_status = 'pending'` 的帖子
- 支持分页浏览（每页10条）
- 提供快速审核操作按钮

**2. 所有帖子管理**
- 显示所有帖子（包括已通过、已拒绝、待审核）
- 支持按审核状态筛选：`pending`（待审核）、`approved`（已通过）、`rejected`（已拒绝）
- 支持按发布状态筛选：`draft`（草稿）、`published`（已发布）、`deleted`（已删除）
- 支持分页浏览

**3. 统计信息面板**
- 待审核数量
- 已通过数量
- 已拒绝数量
- 总帖子数
- 精选帖子数量
- 置顶帖子数量

##### 🛠️ 审核操作功能

**审核通过**
- 一键通过审核
- 帖子状态变为 `audit_status = 'approved'`
- 帖子对所有用户可见

**审核拒绝**
- 弹窗输入拒绝原因（必填）
- 帖子状态变为 `audit_status = 'rejected'`，`status = 'draft'`
- 用户可在"我的帖子"中看到拒绝原因

**查看详情**
- 弹窗显示帖子完整内容
- 包括标题、封面、摘要、正文、审核状态等
- 显示统计数据（浏览、点赞、评论、收藏）

**删除帖子**
- 可选填删除原因
- 删除后帖子状态变为 `status = 'deleted'`

**设置精选/置顶**（仅限已审核通过的帖子）
- 设置/取消精选
- 设置/取消置顶

##### 🎨 UI设计
- 现代化卡片式布局
- 清晰的审核状态标签（待审核/已通过/已拒绝）
- 响应式设计，支持各种屏幕尺寸
- 直观的操作按钮布局
- 实时数据更新

---

### 3. 用户端审核状态显示

#### 3.1 "我发布的"页面增强

##### 实现位置
- `src/components/MyPostsPage.jsx`

##### 新增功能
- **审核状态卡片**：每个已发布帖子都显示审核状态
  - ✅ **审核通过**：绿色卡片，提示"帖子已公开"
  - ❌ **审核未通过**：红色卡片，显示拒绝原因
  - ⏳ **等待审核**：黄色卡片，提示"正在审核中"

- **详细信息显示**
  - 审核时间（如果已审核）
  - 拒绝原因（如果被拒绝）
  - 审核状态说明文字

##### 示例效果
```
┌──────────────────────────────────────┐
│ 我的旅行日记                         │
│ 这是一次难忘的旅行...                │
│                                      │
│ ⏳ 等待管理员审核                    │
│ 您的帖子正在审核中，审核通过后将对   │
│ 所有用户展示                         │
└──────────────────────────────────────┘
```

#### 3.2 帖子编辑器页面提示

##### 实现位置
- `src/components/PostEditorPage.jsx`

##### 新增功能
- **顶部审核说明卡片**
  - 蓝色提示框
  - 说明帖子需要审核才能公开
  - 引导用户在"我发布的"查看审核状态

- **发布成功提示优化**
  ```
  ✅ 发布成功！
  
  📝 您的帖子已提交审核，审核通过后将对所有用户展示。
  您可以在"我发布的"页面查看审核状态。
  ```

---

### 4. 帖子可见性控制

#### 后端逻辑（已由后端实现）
- 用户发布帖子 → 自动设置 `audit_status = 'pending'`
- `/api/post/public` 接口 → 只返回 `audit_status = 'approved'` 的帖子
- 用户在"我的帖子"中 → 可以看到所有自己的帖子及审核状态

#### 前端逻辑
- **发现页面**：调用 `getPublicPosts()`，后端已过滤，只显示审核通过的帖子
- **我的帖子页面**：调用 `getMyPosts()`，显示所有自己的帖子，包含审核状态

---

## 📁 新增/修改的文件清单

### 新增文件
1. ✨ `src/components/AdminPostReviewPage.jsx` - 管理员审核系统页面（全新）

### 修改文件
1. 🔧 `src/api/config.js`
   - 新增 `USER_INFO` 接口端点
   - 新增管理员审核相关的11个接口端点
   - 新增 `getUserInfo()` 函数
   - 新增 9个管理员审核API函数

2. 🔧 `src/App.jsx`
   - 导入 `AdminPostReviewPage` 和 `getUserInfo`
   - 新增 `isAdmin` 状态
   - 修改登录成功逻辑，添加用户身份识别
   - 修改启动检查逻辑，添加身份识别和路由跳转
   - 新增管理员审核页面路由

3. 🔧 `src/components/MyPostsPage.jsx`
   - 增强已发布帖子卡片，显示审核状态
   - 添加审核状态提示卡片（通过/拒绝/待审核）
   - 显示拒绝原因和审核时间

4. 🔧 `src/components/PostEditorPage.jsx`
   - 添加顶部审核说明提示框
   - 优化发布成功提示文字

---

## 🔗 API接口使用

### 用户身份查询
```javascript
// 获取用户身份信息
GET /api/auth/user-info
// 返回: { isAdmin: true/false, userType: 'user'/'admin', ... }
```

### 管理员审核接口（11个）

#### 1. 获取待审核帖子列表
```javascript
GET /api/admin/posts/pending?page=1&pageSize=10
```

#### 2. 获取所有帖子（可筛选）
```javascript
GET /api/admin/posts/list?auditStatus=pending&status=published&page=1
```

#### 3. 获取帖子详情
```javascript
GET /api/admin/posts/{postId}
```

#### 4. 审核通过
```javascript
POST /api/admin/posts/{postId}/approve
```

#### 5. 审核拒绝
```javascript
POST /api/admin/posts/{postId}/reject
Body: { "reason": "拒绝原因" }
```

#### 6. 删除帖子
```javascript
DELETE /api/admin/posts/{postId}
Body: { "reason": "删除原因（可选）" }
```

#### 7. 设置精选
```javascript
POST /api/admin/posts/{postId}/feature
```

#### 8. 取消精选
```javascript
DELETE /api/admin/posts/{postId}/feature
```

#### 9. 设置置顶
```javascript
POST /api/admin/posts/{postId}/top
```

#### 10. 取消置顶
```javascript
DELETE /api/admin/posts/{postId}/top
```

#### 11. 获取统计信息
```javascript
GET /api/admin/posts/statistics
```

---

## 🎯 使用流程

### 普通用户流程

1. **发布帖子**
   - 用户在PostEditorPage编辑帖子
   - 看到蓝色审核说明提示框
   - 点击"发布"按钮
   - 收到提示："您的帖子已提交审核，审核通过后将对所有用户展示"

2. **查看审核状态**
   - 进入"我发布的"页面
   - 看到帖子的审核状态卡片：
     - ⏳ 黄色：等待审核中
     - ✅ 绿色：审核通过，已公开
     - ❌ 红色：审核未通过，显示拒绝原因

3. **修改被拒绝的帖子**
   - 在"我发布的"页面看到红色的拒绝状态
   - 查看拒绝原因
   - 点击"编辑"按钮修改帖子
   - 重新发布，再次进入审核流程

### 管理员流程

1. **登录系统**
   - 使用管理员账号登录
   - 自动跳转到"帖子审核管理系统"页面
   - 看到三个标签页：待审核帖子、所有帖子、统计信息

2. **审核待审核帖子**
   - 点击"待审核帖子"标签
   - 浏览待审核的帖子列表
   - 每个帖子显示：标题、摘要、封面、发布者、发布时间、互动数据
   - 操作选项：
     - 查看详情：弹窗显示完整内容
     - 通过：一键审核通过
     - 拒绝：输入拒绝原因后拒绝

3. **管理所有帖子**
   - 点击"所有帖子"标签
   - 使用筛选条件：
     - 审核状态：全部/待审核/已通过/已拒绝
     - 发布状态：全部/草稿/已发布/已删除
   - 对已通过的帖子可以：
     - 设置/取消精选
     - 设置/取消置顶
   - 对违规帖子可以：
     - 删除（可填写删除原因）

4. **查看统计信息**
   - 点击"统计信息"标签
   - 看到6个统计卡片：
     - 待审核数量
     - 已通过数量
     - 已拒绝数量
     - 总帖子数
     - 精选帖子数量
     - 置顶帖子数量

---

## 🔐 权限控制

### 前端权限判断
```javascript
// App.jsx中的路由保护
{currentPage === 'admin-review' && isAuthenticated && isAdmin && (
  <AdminPostReviewPage />
)}
```

### 后端权限验证
所有 `/api/admin/*` 接口都需要：
1. 有效的JWT token
2. 用户类型为 `admin`

如果权限不足，返回 `403 Forbidden`

---

## 🚀 部署和测试

### 前端测试步骤

#### 1. 测试普通用户
```bash
# 1. 使用普通用户账号登录
# 2. 确认进入主系统（home页面）
# 3. 发布一篇新帖子
# 4. 确认看到审核说明提示
# 5. 发布成功后确认看到审核提示
# 6. 进入"我发布的"页面
# 7. 确认看到"等待审核"状态
```

#### 2. 测试管理员
```bash
# 1. 使用管理员账号登录
# 2. 确认自动进入"帖子审核管理系统"
# 3. 查看待审核帖子列表
# 4. 测试审核通过功能
# 5. 测试审核拒绝功能（必须输入原因）
# 6. 测试查看帖子详情
# 7. 测试设置精选/置顶
# 8. 测试删除帖子
# 9. 查看统计信息
```

#### 3. 测试用户查看审核结果
```bash
# 1. 切换回普通用户账号
# 2. 进入"我发布的"页面
# 3. 确认看到"审核通过"的绿色提示
# 4. 或看到"审核未通过"的红色提示及原因
# 5. 进入"发现"页面
# 6. 确认只能看到审核通过的帖子
```

---

## 📝 注意事项

### 1. 管理员账号创建
需要在数据库中手动创建管理员账号：
```sql
-- 插入管理员账号到 administrator_info 表
INSERT INTO administrator_info (admin_name, password, phone, creation_date)
VALUES ('admin', '加密后的密码', '管理员手机号', NOW());
```

### 2. 审核状态字段
确保数据库 `travel_post` 表包含以下字段：
- `audit_status` VARCHAR(20) - 审核状态（pending/approved/rejected）
- `audit_reason` VARCHAR(500) - 审核原因（拒绝时填写）
- `audit_time` DATETIME - 审核时间
- `is_featured` TINYINT(1) - 是否精选
- `is_top` TINYINT(1) - 是否置顶

### 3. 后端接口依赖
确保后端已实现以下接口：
- ✅ `/api/auth/user-info` - 用户身份查询
- ✅ `/api/admin/posts/*` - 管理员审核相关的11个接口

### 4. 帖子可见性
- 后端的 `/api/post/public` 接口必须过滤 `audit_status != 'approved'` 的帖子
- 前端无需额外过滤，信任后端返回的数据

---

## 🎉 总结

### 已实现的功能
✅ 管理员身份自动识别和路由跳转  
✅ 管理员审核系统页面（完整功能）  
✅ 用户端审核状态显示和提示  
✅ 帖子发布时的审核说明  
✅ 11个管理员审核API的前端集成  
✅ 权限控制和错误处理  

### 系统特点
- 🎨 **现代化UI设计**：清晰直观的界面
- 🚀 **完整的审核流程**：从发布到审核到结果通知
- 🔐 **严格的权限控制**：管理员和用户分离
- 💬 **友好的用户提示**：每个步骤都有明确的说明
- 📊 **数据统计展示**：管理员可以查看审核统计

### 技术亮点
- React Hooks状态管理
- 异步API调用处理
- 错误边界和异常处理
- 响应式布局设计
- 分页和筛选功能
- 实时数据更新

---

## 📚 相关文档

- [帖子审核管理系统API文档.md](./帖子审核管理系统API文档.md) - 完整的API接口文档
- [帖子审核系统完成总结.md](./帖子审核系统完成总结.md) - 后端实现总结
- [用户身份查询接口文档.md](./用户身份查询接口文档.md) - 用户身份查询接口说明

---

**✨ 帖子审核系统前端集成已全部完成！** 

管理员可以方便地审核用户发布的帖子，用户可以实时查看审核状态和结果。系统运行流畅，用户体验良好！🎊

