# æœ¬åœ°å¼€å‘å¯åŠ¨æŒ‡å—

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. CORS è·¨åŸŸé…ç½®ï¼ˆå·²ä¼˜åŒ–ï¼‰
- âœ… æ”¯æŒæ‰€æœ‰æ¥æºè®¿é—®ï¼ˆé€‚ç”¨äºæœ¬åœ°å¼€å‘ï¼‰
- âœ… å…è®¸æºå¸¦å‡­è¯ï¼ˆJWT Tokenï¼‰
- âœ… æ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEã€OPTIONSã€PATCHï¼‰
- âœ… é¢„æ£€è¯·æ±‚ç¼“å­˜ä¼˜åŒ–

## ğŸ“‹ å¯åŠ¨å‰å‡†å¤‡

### 1. æ•°æ®åº“é…ç½®

ç¡®ä¿ä½ çš„ MySQL æ•°æ®åº“å·²å¯åŠ¨ï¼Œå¹¶ä¸”å·²åˆ›å»ºæ•°æ®åº“ï¼š

```sql
CREATE DATABASE IF NOT EXISTS gd_mcp 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;
```

**å½“å‰æ•°æ®åº“é…ç½®**ï¼ˆåœ¨ `application.properties` ä¸­ï¼‰ï¼š
- æ•°æ®åº“åï¼š`gd_mcp`
- ç«¯å£ï¼š`3306`
- ç”¨æˆ·åï¼š`root`
- å¯†ç ï¼š`123456`

> âš ï¸ **é‡è¦**ï¼šå¦‚æœä½ çš„ MySQL ç”¨æˆ·åæˆ–å¯†ç ä¸åŒï¼Œè¯·ä¿®æ”¹ `src/main/resources/application.properties` æ–‡ä»¶ä¸­çš„é…ç½®ã€‚

### 2. ç«¯å£é…ç½®

- **åç«¯ç«¯å£**ï¼š`8081`
- **å‰ç«¯ç«¯å£**ï¼šé€šå¸¸æ˜¯ `3000`ã€`8080` æˆ– `5173`ï¼ˆæ ¹æ®å‰ç«¯æ¡†æ¶è€Œå®šï¼‰

> ğŸ’¡ å¦‚æœ 8081 ç«¯å£å·²è¢«å ç”¨ï¼Œå¯ä»¥åœ¨ `application.properties` ä¸­ä¿®æ”¹ `server.port` çš„å€¼ã€‚

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Maven å‘½ä»¤ï¼ˆæ¨èï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
mvn clean spring-boot:run
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ IDEï¼ˆå¦‚ IntelliJ IDEAï¼‰

1. æ‰¾åˆ° `src/main/java/com/example/auth/AuthApplication.java`ï¼ˆæˆ–ç±»ä¼¼çš„ä¸»ç±»ï¼‰
2. å³é”®ç‚¹å‡» â†’ `Run 'AuthApplication'`

### æ–¹å¼ä¸‰ï¼šå…ˆç¼–è¯‘å†è¿è¡Œ

```bash
# ç¼–è¯‘
mvn clean package -DskipTests

# è¿è¡Œ
java -jar target/auth-system-*.jar
```

## âœ… éªŒè¯å¯åŠ¨æˆåŠŸ

### 1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

å¯åŠ¨æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ—¥å¿—ï¼š

```
Tomcat started on port(s): 8081 (http)
Started AuthApplication in X.XXX seconds
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥

åœ¨æµè§ˆå™¨æˆ– Postman ä¸­è®¿é—®ï¼š

```
http://localhost:8081/api/auth/check-auto-login
```

å¦‚æœè¿”å›å“åº”ï¼ˆå³ä½¿æ˜¯é”™è¯¯ä¿¡æ¯ï¼‰ï¼Œè¯´æ˜åç«¯å·²æˆåŠŸå¯åŠ¨ã€‚

## ğŸ”Œ å‰ç«¯è¿æ¥é…ç½®

åœ¨ä½ çš„å‰ç«¯é¡¹ç›®ä¸­ï¼Œç¡®ä¿ API åŸºç¡€è·¯å¾„é…ç½®ä¸ºï¼š

```javascript
// ç¤ºä¾‹é…ç½®
const API_BASE_URL = 'http://localhost:8081';

// æˆ–åœ¨ axios ä¸­é…ç½®
axios.defaults.baseURL = 'http://localhost:8081';
```

### å‰ç«¯è¯·æ±‚ç¤ºä¾‹

```javascript
// ç™»å½•è¯·æ±‚ç¤ºä¾‹
fetch('http://localhost:8081/api/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  credentials: 'include', // é‡è¦ï¼šå…è®¸æºå¸¦å‡­è¯
  body: JSON.stringify({
    username: 'testuser',
    password: 'password123',
    userType: 'user'
  })
})
.then(response => response.json())
.then(data => {
  console.log('ç™»å½•æˆåŠŸ:', data);
  // ä¿å­˜ token
  localStorage.setItem('token', data.data.token);
});
```

### æºå¸¦ Token çš„è¯·æ±‚

```javascript
// éœ€è¦è®¤è¯çš„è¯·æ±‚
fetch('http://localhost:8081/api/some-protected-endpoint', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`,
    'Content-Type': 'application/json',
  },
  credentials: 'include'
})
.then(response => response.json())
.then(data => console.log(data));
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`Communications link failure`

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®è®¤ MySQL æœåŠ¡å·²å¯åŠ¨
- æ£€æŸ¥æ•°æ®åº“åã€ç”¨æˆ·åã€å¯†ç æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ MySQL ç«¯å£æ˜¯ 3306

### 2. ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯**ï¼š`Port 8081 was already in use`

**è§£å†³æ–¹æ³•**ï¼š
- ä¿®æ”¹ `application.properties` ä¸­çš„ `server.port`
- æˆ–åœæ­¢å ç”¨ 8081 ç«¯å£çš„å…¶ä»–ç¨‹åº

### 3. CORS è·¨åŸŸé—®é¢˜

**é”™è¯¯ä¿¡æ¯**ï¼š`Access to fetch at 'http://localhost:8081/...' from origin 'http://localhost:3000' has been blocked by CORS policy`

**è§£å†³æ–¹æ³•**ï¼š
- âœ… å·²ç»é…ç½®å¥½äº†ï¼Œä¸åº”è¯¥å†å‡ºç°æ­¤é—®é¢˜
- å¦‚æœä»ç„¶å‡ºç°ï¼Œç¡®ä¿å‰ç«¯è¯·æ±‚æ—¶è®¾ç½®äº† `credentials: 'include'`

### 4. JWT Token éªŒè¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š`401 Unauthorized`

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿è¯·æ±‚å¤´ä¸­åŒ…å«æ­£ç¡®çš„ `Authorization: Bearer {token}`
- æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤ 7 å¤©ï¼‰
- ç¡®è®¤ç™»å½•æ¥å£æ˜¯å¦åœ¨ç™½åå•ä¸­

## ğŸ“ å¼€å‘ç¯å¢ƒé…ç½®æ–‡ä»¶

å½“å‰é…ç½®æ–‡ä»¶ä½ç½®ï¼š`src/main/resources/application.properties`

```properties
# å…³é”®é…ç½®é¡¹
server.port=8081                                    # æœåŠ¡å™¨ç«¯å£
spring.datasource.url=jdbc:mysql://localhost:3306/gd_mcp  # æ•°æ®åº“è¿æ¥
spring.datasource.username=root                     # æ•°æ®åº“ç”¨æˆ·å
spring.datasource.password=123456                   # æ•°æ®åº“å¯†ç 
jwt.expiration=604800000                           # JWT è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰
```

## ğŸ¯ å¿«é€Ÿæµ‹è¯•æ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ

```bash
curl -X POST http://localhost:8081/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "number": "13800138000",
    "userType": "user"
  }'
```

### 2. ç”¨æˆ·ç™»å½•

```bash
curl -X POST http://localhost:8081/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "userType": "user"
  }'
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ¥å£æ–‡æ¡£](./POSTMAN_API_TESTING_GUIDE.md)
- [å‰ç«¯é›†æˆæŒ‡å—](./å‰ç«¯é›†æˆæŒ‡å—-é‡è¦å˜æ›´è¯´æ˜.md)
- [éªŒè¯ç ç™»å½•ä½¿ç”¨æŒ‡å—](./VERIFICATION_CODE_LOGIN_GUIDE.md)

## ğŸ‰ å®Œæˆï¼

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æˆåŠŸï¼Œä½ çš„åç«¯å°±å·²ç»é…ç½®å¥½å¹¶å¯ä»¥ä¸å‰ç«¯æ­£å¸¸é€šä¿¡äº†ï¼

---

**æœ€åä¿®æ”¹æ—¶é—´**ï¼š2025-11-05

