# å¥½å‹ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å®Œæ•´çš„å¥½å‹ç”³è¯·æµç¨‹ï¼š**æœç´¢ç”¨æˆ·** â†’ **å‘é€ç”³è¯·** â†’ **æ¥æ”¶ç”³è¯·** â†’ **å¤„ç†ç”³è¯·** â†’ **æˆä¸ºå¥½å‹**

## ğŸ“‹ APIæ¥å£åˆ—è¡¨

### 1. æœç´¢ç”¨æˆ·
```
GET /api/user-chat/users/search?keyword=æ‰‹æœºå·æˆ–ç”¨æˆ·å&userId=å½“å‰ç”¨æˆ·ID
```

### 2. å‘é€å¥½å‹ç”³è¯·
```
POST /api/user-chat/friends/add
{
  "userId": 1,           // å‘é€è€…IDï¼ˆæ•°å­—ç±»å‹ï¼‰
  "friendId": 2,         // æ¥æ”¶è€…ID
  "message": "ç”³è¯·æ¶ˆæ¯",
  "source": "search"
}
```

### 3. è·å–å¥½å‹ç”³è¯·åˆ—è¡¨ â­ **æ–°å¢**
```
GET /api/user-chat/friends/requests?userId=å½“å‰ç”¨æˆ·ID
```

### 4. å¤„ç†å¥½å‹ç”³è¯·
```
POST /api/user-chat/friends/handle
{
  "userId": 2,           // æ¥æ”¶è€…ID
  "friendId": 1,         // å‘é€è€…ID
  "action": "accept",    // accept æˆ– reject
  "rejectReason": ""     // æ‹’ç»åŸå› ï¼ˆå¯é€‰ï¼‰
}
```

### 5. è·å–å¥½å‹åˆ—è¡¨
```
GET /api/user-chat/friends/list?userId=å½“å‰ç”¨æˆ·ID
```

## ğŸ”„ å®Œæ•´ä½¿ç”¨æµç¨‹

### æ­¥éª¤1ï¼šç”¨æˆ·Aæœç´¢ç”¨æˆ·B
```javascript
// å‰ç«¯è°ƒç”¨
const users = await searchUsers("18831231517");
```

### æ­¥éª¤2ï¼šç”¨æˆ·Aå‘ç”¨æˆ·Bå‘é€å¥½å‹ç”³è¯·
```javascript
// å‰ç«¯è°ƒç”¨
await addFriend(2, "ä½ å¥½ï¼Œæˆ‘æƒ³åŠ ä½ ä¸ºå¥½å‹", "search");
```

### æ­¥éª¤3ï¼šç”¨æˆ·BæŸ¥çœ‹æ”¶åˆ°çš„å¥½å‹ç”³è¯·
```javascript
// å‰ç«¯è°ƒç”¨
const requests = await getFriendRequests(2);
// è¿”å›æ ¼å¼ï¼š
[{
  "requestId": 1,
  "fromUserId": 1,
  "fromUsername": "ç”¨æˆ·A",
  "requestMessage": "ä½ å¥½ï¼Œæˆ‘æƒ³åŠ ä½ ä¸ºå¥½å‹",
  "status": "pending",
  "requestTime": "2025-11-18 14:30:00"
}]
```

### æ­¥éª¤4ï¼šç”¨æˆ·Bå¤„ç†å¥½å‹ç”³è¯·
```javascript
// æ¥å—ç”³è¯·
await handleFriendRequest(1, "accept");

// æˆ–æ‹’ç»ç”³è¯·
await handleFriendRequest(1, "reject", "æš‚æ—¶ä¸åŠ å¥½å‹");
```

### æ­¥éª¤5ï¼šæŸ¥çœ‹å¥½å‹åˆ—è¡¨
```javascript
const friends = await getFriendsList(2);
```

## âš ï¸ é‡è¦è¯´æ˜

1. **ç”¨æˆ·IDç±»å‹**ï¼šå¿…é¡»ä½¿ç”¨æ•°å­—ç±»å‹çš„ç”¨æˆ·IDï¼Œä¸èƒ½ä½¿ç”¨æ‰‹æœºå·å­—ç¬¦ä¸²
2. **ç”³è¯·çŠ¶æ€**ï¼š`pending`ï¼ˆå¾…å¤„ç†ï¼‰ã€`accepted`ï¼ˆå·²æ¥å—ï¼‰ã€`rejected`ï¼ˆå·²æ‹’ç»ï¼‰
3. **åŒå‘å…³ç³»**ï¼šæ¥å—å¥½å‹ç”³è¯·åï¼ŒåŒæ–¹éƒ½ä¼šæˆä¸ºå¥½å‹
4. **é‡å¤ç”³è¯·**ï¼šå·²å‘é€ç”³è¯·æˆ–å·²æ˜¯å¥½å‹æ—¶ï¼Œä¼šè¿”å›ç›¸åº”æç¤º

## ğŸ› å¸¸è§é—®é¢˜

**Q: å‘é€å¥½å‹ç”³è¯·æ—¶å‡ºç°500é”™è¯¯ï¼Ÿ**
A: æ£€æŸ¥userIdæ˜¯å¦ä¸ºæ•°å­—ç±»å‹ï¼Œä¸èƒ½æ˜¯æ‰‹æœºå·å­—ç¬¦ä¸²

**Q: ç”¨æˆ·Bçœ‹ä¸åˆ°Aå‘é€çš„ç”³è¯·ï¼Ÿ**
A: è°ƒç”¨ `GET /api/user-chat/friends/requests` æ¥å£è·å–ç”³è¯·åˆ—è¡¨

**Q: å¤„ç†ç”³è¯·åæ²¡æœ‰æˆä¸ºå¥½å‹ï¼Ÿ**
A: æ£€æŸ¥actionå‚æ•°æ˜¯å¦ä¸º"accept"ï¼Œä¸”userId/friendIdæ˜¯å¦æ­£ç¡®

## ğŸ”§ å‰ç«¯é›†æˆç¤ºä¾‹

```javascript
// å®Œæ•´çš„å¥½å‹ç”³è¯·æµç¨‹ç¤ºä¾‹
async function friendRequestFlow() {
  // 1. æœç´¢ç”¨æˆ·
  const users = await searchUsers("ç›®æ ‡ç”¨æˆ·");
  const targetUser = users.data[0];
  
  // 2. å‘é€å¥½å‹ç”³è¯·
  await addFriend(targetUser.userId, "ä½ å¥½ï¼");
  
  // 3. ç›®æ ‡ç”¨æˆ·è·å–ç”³è¯·åˆ—è¡¨
  const requests = await getFriendRequests(targetUser.userId);
  
  // 4. å¤„ç†ç”³è¯·
  if (requests.data.length > 0) {
    const request = requests.data[0];
    await handleFriendRequest(request.fromUserId, "accept");
  }
  
  // 5. æŸ¥çœ‹å¥½å‹åˆ—è¡¨
  const friends = await getFriendsList(targetUser.userId);
  console.log("å¥½å‹åˆ—è¡¨:", friends.data);
}
```

## âœ… ä¿®å¤å®Œæˆ

- âœ… ä¿®å¤äº†userIdç±»å‹ä¸åŒ¹é…é—®é¢˜
- âœ… ä¿®å¤äº†æšä¸¾å€¼å¤§å°å†™é—®é¢˜  
- âœ… æ–°å¢äº†è·å–å¥½å‹ç”³è¯·åˆ—è¡¨æ¥å£
- âœ… å®Œå–„äº†å¥½å‹ç”³è¯·å¤„ç†æµç¨‹

ç°åœ¨å¯ä»¥å®Œæ•´ä½“éªŒä»å‘é€ç”³è¯·åˆ°æˆä¸ºå¥½å‹çš„å…¨æµç¨‹ï¼
