# ğŸ“Œ å¸–å­æ”¶è—åŠŸèƒ½ - å¿«é€Ÿä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3åˆ†é’Ÿä¸Šæ‰‹ï¼‰

### 1ï¸âƒ£ æ•°æ®åº“å‡†å¤‡

æ‰§è¡Œå»ºè¡¨è„šæœ¬ï¼š
```bash
mysql -u root -p gd_mcp < travel_post_favorite_table.sql
```

æˆ–æ‰‹åŠ¨æ‰§è¡Œ `travel_post_favorite_table.sql` æ–‡ä»¶ä¸­çš„ SQL è¯­å¥ã€‚

---

### 2ï¸âƒ£ API æ¥å£æ€»è§ˆ

| åŠŸèƒ½ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| æ·»åŠ æ”¶è— | POST | `/api/favorite/post/{postId}` | æ”¶è—å¸–å­ |
| å–æ¶ˆæ”¶è— | DELETE | `/api/favorite/post/{postId}` | å–æ¶ˆæ”¶è— |
| æ£€æŸ¥çŠ¶æ€ | GET | `/api/favorite/post/{postId}/status` | æ˜¯å¦å·²æ”¶è— |
| è·å–åˆ—è¡¨ | GET | `/api/favorite/posts` | æˆ‘çš„æ”¶è—åˆ—è¡¨ |

---

### 3ï¸âƒ£ å‰ç«¯è°ƒç”¨ç¤ºä¾‹

#### â‘  æ·»åŠ æ”¶è—ï¼ˆåŸºç¡€ç‰ˆï¼‰

```javascript
// ç®€å•æ”¶è—
const response = await fetch('/api/favorite/post/123', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();
```

#### â‘¡ æ·»åŠ æ”¶è—ï¼ˆå®Œæ•´ç‰ˆï¼‰

```javascript
// å¸¦åˆ†ç±»ã€æ ‡ç­¾ã€å¤‡æ³¨çš„æ”¶è—
const params = new URLSearchParams({
  favoriteCategory: 'planning',      // æ”¶è—åˆ†ç±»
  favoriteTags: 'ç¾é£Ÿ,æ‘„å½±',          // ä¸ªäººæ ‡ç­¾
  userNotes: 'ä¸‹æ¬¡å»åŒ—äº¬å‚è€ƒ',        // å¤‡æ³¨
  priorityLevel: 5                   // ä¼˜å…ˆçº§
});

const response = await fetch(`/api/favorite/post/123?${params}`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();
```

#### â‘¢ å–æ¶ˆæ”¶è—

```javascript
const response = await fetch('/api/favorite/post/123', {
  method: 'DELETE',
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();
```

#### â‘£ æ£€æŸ¥æ˜¯å¦å·²æ”¶è—

```javascript
const response = await fetch('/api/favorite/post/123/status', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();
console.log(result.data.isFavorited); // true æˆ– false
```

#### â‘¤ è·å–æ”¶è—åˆ—è¡¨

```javascript
// è·å–æ‰€æœ‰æ”¶è—
const response = await fetch('/api/favorite/posts', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();

// å¸¦ç­›é€‰æ¡ä»¶
const params = new URLSearchParams({
  postType: 'strategy',           // å¸–å­ç±»å‹ï¼šæ”»ç•¥
  favoriteCategory: 'planning',   // æ”¶è—åˆ†ç±»ï¼šè§„åˆ’å‚è€ƒ
  readStatus: 'unread',           // é˜…è¯»çŠ¶æ€ï¼šæœªè¯»
  destinationCity: 'åŒ—äº¬',         // ç›®çš„åœ°ï¼šåŒ—äº¬
  priorityLevel: 5                // ä¼˜å…ˆçº§ï¼š5
});

const response = await fetch(`/api/favorite/posts?${params}`, {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});
const result = await response.json();
```

---

### 4ï¸âƒ£ å­—æ®µè¯´æ˜

#### æ”¶è—åˆ†ç±» (favoriteCategory)
- `general` - é€šç”¨
- `inspiration` - çµæ„Ÿ
- `planning` - è§„åˆ’å‚è€ƒ
- `experience` - ç»éªŒåˆ†äº«

#### å¸–å­ç±»å‹ (postType)
- `travel_note` - æ¸¸è®°
- `strategy` - æ”»ç•¥
- `photo_share` - ç…§ç‰‡åˆ†äº«
- `video_share` - è§†é¢‘åˆ†äº«
- `qa` - é—®ç­”

#### é˜…è¯»çŠ¶æ€ (readStatus)
- `unread` - æœªè¯»
- `reading` - é˜…è¯»ä¸­
- `read` - å·²è¯»

#### ä¼˜å…ˆçº§ (priorityLevel)
- `1-5` - æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜

---

### 5ï¸âƒ£ React ç»„ä»¶ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';

function FavoriteButton({ postId }) {
  const [isFavorited, setIsFavorited] = useState(false);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    // æ£€æŸ¥æ”¶è—çŠ¶æ€
    fetch(`/api/favorite/post/${postId}/status`, {
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    })
    .then(res => res.json())
    .then(result => {
      if (result.code === 200) {
        setIsFavorited(result.data.isFavorited);
      }
    });
  }, [postId]);

  const toggleFavorite = async () => {
    setLoading(true);
    const method = isFavorited ? 'DELETE' : 'POST';
    
    try {
      const response = await fetch(`/api/favorite/post/${postId}`, {
        method,
        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
      });
      const result = await response.json();
      
      if (result.code === 200) {
        setIsFavorited(!isFavorited);
      } else {
        alert(result.message);
      }
    } catch (error) {
      alert('æ“ä½œå¤±è´¥');
    } finally {
      setLoading(false);
    }
  };

  return (
    <button onClick={toggleFavorite} disabled={loading}>
      {loading ? 'å¤„ç†ä¸­...' : (isFavorited ? 'â¤ï¸ å·²æ”¶è—' : 'ğŸ¤ æ”¶è—')}
    </button>
  );
}

export default FavoriteButton;
```

---

### 6ï¸âƒ£ å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "code": 200,
  "message": "success",
  "data": { /* æ•°æ®å†…å®¹ */ }
}
```

#### å¤±è´¥å“åº”
```json
{
  "code": 400,
  "message": "é”™è¯¯ä¿¡æ¯",
  "data": null
}
```

---

### 7ï¸âƒ£ å¸¸è§é—®é¢˜

**Q: é‡å¤æ”¶è—ä¼šæ€æ ·ï¼Ÿ**  
A: è¿”å›é”™è¯¯ `"æ‚¨å·²ç»æ”¶è—è¿‡è¿™ä¸ªå¸–å­äº†"`ï¼Œéœ€è¦å…ˆæ£€æŸ¥æ”¶è—çŠ¶æ€ã€‚

**Q: å–æ¶ˆæ”¶è—åæ•°æ®ä¼šåˆ é™¤å—ï¼Ÿ**  
A: ä¸ä¼šï¼Œé‡‡ç”¨è½¯åˆ é™¤ï¼Œæ•°æ®ä¼šä¿ç•™ã€‚

**Q: æ”¶è—åå¸–å­è¢«åˆ é™¤äº†æ€ä¹ˆåŠï¼Ÿ**  
A: æ”¶è—è®°å½•ä¸­ä¿ç•™äº†å¸–å­çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå†—ä½™å­˜å‚¨ï¼‰ï¼Œä»å¯æŸ¥çœ‹ã€‚

**Q: å¦‚ä½•å®ç°æ”¶è—æŒ‰é’®çš„çŠ¶æ€åˆ‡æ¢ï¼Ÿ**  
A: å…ˆè°ƒç”¨ `/status` æ¥å£æ£€æŸ¥æ˜¯å¦å·²æ”¶è—ï¼Œå†æ ¹æ®çŠ¶æ€å†³å®šæ˜¯æ·»åŠ è¿˜æ˜¯å–æ¶ˆã€‚

**Q: æ”¯æŒæ‰¹é‡æ“ä½œå—ï¼Ÿ**  
A: ç›®å‰ä¸æ”¯æŒï¼Œéœ€è¦é€ä¸ªè°ƒç”¨æ¥å£ã€‚

---

### 8ï¸âƒ£ å®Œæ•´çš„å‰ç«¯å°è£…ï¼ˆæ¨èï¼‰

```javascript
// favoriteAPI.js
const API_BASE = '/api/favorite';

export const favoriteAPI = {
  // æ·»åŠ æ”¶è—
  add: async (postId, options = {}) => {
    const params = new URLSearchParams(options);
    const url = `${API_BASE}/post/${postId}${params.toString() ? '?' + params : ''}`;
    const res = await fetch(url, {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });
    return res.json();
  },

  // å–æ¶ˆæ”¶è—
  remove: async (postId) => {
    const res = await fetch(`${API_BASE}/post/${postId}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });
    return res.json();
  },

  // æ£€æŸ¥çŠ¶æ€
  checkStatus: async (postId) => {
    const res = await fetch(`${API_BASE}/post/${postId}/status`, {
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });
    return res.json();
  },

  // è·å–åˆ—è¡¨
  getList: async (filters = {}) => {
    const params = new URLSearchParams(filters);
    const url = `${API_BASE}/posts${params.toString() ? '?' + params : ''}`;
    const res = await fetch(url, {
      headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
    });
    return res.json();
  }
};

// ä½¿ç”¨ç¤ºä¾‹
import { favoriteAPI } from './favoriteAPI';

// æ·»åŠ æ”¶è—
const result = await favoriteAPI.add(123, {
  favoriteCategory: 'planning',
  favoriteTags: 'ç¾é£Ÿ,æ‘„å½±',
  userNotes: 'ä¸‹æ¬¡å»åŒ—äº¬å‚è€ƒ',
  priorityLevel: 5
});

// å–æ¶ˆæ”¶è—
await favoriteAPI.remove(123);

// æ£€æŸ¥çŠ¶æ€
const status = await favoriteAPI.checkStatus(123);
console.log(status.data.isFavorited);

// è·å–åˆ—è¡¨
const favorites = await favoriteAPI.getList({ postType: 'strategy' });
console.log(favorites.data);
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´APIæ–‡æ¡£](./å¸–å­æ”¶è—åŠŸèƒ½APIæ–‡æ¡£.md) - è¯¦ç»†çš„æ¥å£è¯´æ˜
- [æ•°æ®åº“è¡¨ç»“æ„](./travel_post_favorite_table.sql) - å»ºè¡¨è„šæœ¬

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025-10-29

