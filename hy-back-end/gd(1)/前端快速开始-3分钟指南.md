# å‰ç«¯å¿«é€Ÿå¼€å§‹ - 3åˆ†é’ŸæŒ‡å—

## ğŸš€ åªéœ€3æ­¥ï¼Œå¿«é€Ÿé›†æˆæ–°åŠŸèƒ½

---

## ğŸ“ æ­¥éª¤1: ä¿®æ”¹ä¿å­˜è‰ç¨¿ä»£ç  (2åˆ†é’Ÿ)

### âš ï¸ æ‰¾åˆ°ä½ çš„ä¿å­˜è‰ç¨¿å‡½æ•°

é€šå¸¸åœ¨ `PostEditorPage.jsx` æˆ– `api/post.js` ä¸­

### âœ… ç¡®ä¿åŒ…å« `draftData` å­—æ®µ

```javascript
// åœ¨ä¿å­˜è‰ç¨¿çš„å‡½æ•°ä¸­ï¼Œæ·»åŠ  draftData å­—æ®µ
const saveDraft = async (formData) => {
  const response = await fetch('/api/post/draft/save', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      draftTitle: formData.title,
      draftContent: formData.content,
      
      // ğŸ”´ å…³é”®ï¼šæ·»åŠ è¿™ä¸ªå­—æ®µï¼ŒåŒ…å«æ‰€æœ‰è¡¨å•æ•°æ®
      draftData: formData,  // æˆ–è€… { ...formData }
      
      isAutoSave: false
    })
  });
  
  return await response.json();
};
```

**å°±è¿™ä¹ˆç®€å•ï¼** æŠŠä½ çš„è¡¨å•æ•°æ®åŸå°ä¸åŠ¨åœ°æ”¾åˆ° `draftData` å­—æ®µä¸­å³å¯ã€‚

---

## ğŸš€ æ­¥éª¤2: ä¿®æ”¹å‘å¸ƒè‰ç¨¿ä»£ç  (1åˆ†é’Ÿ)

### âš ï¸ æ‰¾åˆ°ä½ çš„å‘å¸ƒè‰ç¨¿å‡½æ•°

é€šå¸¸åœ¨è‰ç¨¿åˆ—è¡¨ç»„ä»¶ä¸­

### âœ… æ”¹ç”¨æ–°æ¥å£

```javascript
// æ—§ä»£ç ï¼ˆåˆ é™¤æˆ–æ³¨é‡Šæ‰ï¼‰
/*
const publishDraft = async (draftId) => {
  const draft = drafts.find(d => d.id === draftId);
  const createResponse = await createPost(draft.draftData);
  await publishPost(createResponse.data.id);
};
*/

// æ–°ä»£ç ï¼ˆæ›¿æ¢ä¸ºè¿™ä¸ªï¼‰
const publishDraft = async (draftId) => {
  const response = await fetch(`/api/post/draft/${draftId}/convert-and-publish`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  
  if (result.code === 200) {
    alert('å‘å¸ƒæˆåŠŸï¼');
    loadDrafts();  // åˆ·æ–°è‰ç¨¿åˆ—è¡¨
    loadPublishedPosts();  // åˆ·æ–°å·²å‘å¸ƒåˆ—è¡¨
    setActiveTab('published');  // åˆ‡æ¢åˆ°å·²å‘å¸ƒæ ‡ç­¾é¡µ
  }
};
```

**å°±è¿™ä¹ˆç®€å•ï¼** ä¸€ä¸ªæ¥å£è°ƒç”¨æå®šå‘å¸ƒã€‚

---

## ğŸ—‘ï¸ æ­¥éª¤3: æ·»åŠ åˆ é™¤è‰ç¨¿åŠŸèƒ½ (30ç§’)

### âœ… æ·»åŠ åˆ é™¤å‡½æ•°

```javascript
const deleteDraft = async (draftId) => {
  if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè‰ç¨¿å—ï¼Ÿ')) {
    const response = await fetch(`/api/post/draft/${draftId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      alert('åˆ é™¤æˆåŠŸ');
      loadDrafts();  // åˆ·æ–°è‰ç¨¿åˆ—è¡¨
    }
  }
};
```

### âœ… åœ¨UIä¸­æ·»åŠ åˆ é™¤æŒ‰é’®

```jsx
<button onClick={() => deleteDraft(draft.id)}>
  åˆ é™¤
</button>
```

---

## âœ… å®Œæˆï¼

ç°åœ¨é‡å¯å‰ç«¯åº”ç”¨ï¼Œæµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

1. âœ… ä¿å­˜è‰ç¨¿
2. âœ… å‘å¸ƒè‰ç¨¿
3. âœ… åˆ é™¤è‰ç¨¿

---

## ğŸ” é‡åˆ°é—®é¢˜ï¼Ÿ

### é—®é¢˜1: å‘å¸ƒåæ•°æ®ä¸¢å¤±

**æ£€æŸ¥**: ä¿å­˜è‰ç¨¿æ—¶æ˜¯å¦åŒ…å«äº† `draftData` å­—æ®µï¼Ÿ

```javascript
// âŒ é”™è¯¯
body: JSON.stringify({
  draftTitle: title,
  draftContent: content
})

// âœ… æ­£ç¡®
body: JSON.stringify({
  draftTitle: title,
  draftContent: content,
  draftData: formData  // ğŸ”´ å¿…é¡»æœ‰è¿™ä¸ª
})
```

### é—®é¢˜2: æ¥å£è°ƒç”¨å¤±è´¥

**æ£€æŸ¥**: æ¥å£åœ°å€æ˜¯å¦æ­£ç¡®ï¼Ÿ

```javascript
// âœ… æ­£ç¡®
POST /api/post/draft/{draftId}/convert-and-publish

// âŒ é”™è¯¯
POST /api/post/{draftId}/publish
```

### é—®é¢˜3: åˆ—è¡¨ä¸æ›´æ–°

**æ£€æŸ¥**: æ˜¯å¦åœ¨æ“ä½œååˆ·æ–°äº†åˆ—è¡¨ï¼Ÿ

```javascript
// å‘å¸ƒå
await publishDraft(draftId);
await loadDrafts();  // ğŸ”´ è®°å¾—åˆ·æ–°
await loadPublishedPosts();  // ğŸ”´ è®°å¾—åˆ·æ–°
```

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹ä»£ç 

### å®Œæ•´çš„ API è°ƒç”¨ç¤ºä¾‹ (å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨)

```javascript
// ========== è‰ç¨¿ç›¸å…³ API ==========

// 1. ä¿å­˜è‰ç¨¿
export const saveDraft = async (formData) => {
  const response = await fetch('/api/post/draft/save', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      draftTitle: formData.title,
      draftContent: formData.content,
      draftData: formData,
      isAutoSave: false
    })
  });
  return await response.json();
};

// 2. è·å–è‰ç¨¿åˆ—è¡¨
export const getDrafts = async () => {
  const response = await fetch('/api/post/draft/my', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  return await response.json();
};

// 3. å‘å¸ƒè‰ç¨¿
export const publishDraft = async (draftId) => {
  const response = await fetch(`/api/post/draft/${draftId}/convert-and-publish`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  return await response.json();
};

// 4. åˆ é™¤è‰ç¨¿
export const deleteDraft = async (draftId) => {
  const response = await fetch(`/api/post/draft/${draftId}`, {
    method: 'DELETE',
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  return await response.json();
};
```

### React ç»„ä»¶ç¤ºä¾‹

```jsx
import React, { useState, useEffect } from 'react';
import { saveDraft, getDrafts, publishDraft, deleteDraft } from './api/post';

const DraftManager = () => {
  const [drafts, setDrafts] = useState([]);
  
  // åŠ è½½è‰ç¨¿åˆ—è¡¨
  const loadDrafts = async () => {
    const result = await getDrafts();
    if (result.code === 200) {
      setDrafts(result.data.list);
    }
  };
  
  useEffect(() => {
    loadDrafts();
  }, []);
  
  // ä¿å­˜è‰ç¨¿
  const handleSave = async (formData) => {
    const result = await saveDraft(formData);
    if (result.code === 200) {
      alert('ä¿å­˜æˆåŠŸ');
      loadDrafts();
    }
  };
  
  // å‘å¸ƒè‰ç¨¿
  const handlePublish = async (draftId) => {
    const result = await publishDraft(draftId);
    if (result.code === 200) {
      alert('å‘å¸ƒæˆåŠŸï¼');
      loadDrafts();
    }
  };
  
  // åˆ é™¤è‰ç¨¿
  const handleDelete = async (draftId) => {
    if (confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
      const result = await deleteDraft(draftId);
      if (result.code === 200) {
        alert('åˆ é™¤æˆåŠŸ');
        loadDrafts();
      }
    }
  };
  
  return (
    <div>
      <h2>æˆ‘çš„è‰ç¨¿</h2>
      {drafts.map(draft => (
        <div key={draft.id}>
          <h3>{draft.title}</h3>
          <button onClick={() => handlePublish(draft.id)}>å‘å¸ƒ</button>
          <button onClick={() => handleDelete(draft.id)}>åˆ é™¤</button>
        </div>
      ))}
    </div>
  );
};
```

---

## ğŸ¯ è®°ä½è¿™3ç‚¹

1. ğŸ’¾ **ä¿å­˜è‰ç¨¿æ—¶åŒ…å« `draftData`**
2. ğŸš€ **å‘å¸ƒè‰ç¨¿ç”¨æ–°æ¥å£ `convert-and-publish`**
3. ğŸ”„ **æ“ä½œåè®°å¾—åˆ·æ–°åˆ—è¡¨**

---

**å°±è¿™ä¹ˆç®€å•ï¼3åˆ†é’Ÿæå®šï¼** ğŸ‰

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`å‰ç«¯é›†æˆæŒ‡å—-é‡è¦å˜æ›´è¯´æ˜.md`

