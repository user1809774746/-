# Postman WebSocket è°ƒè¯•æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

- Postman ç‰ˆæœ¬ â‰¥ 10.0ï¼ˆæ”¯æŒWebSocketåŠŸèƒ½ï¼‰
- åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆæœåŠ¡å™¨åœ°å€ï¼š192.168.1.132:8082ï¼‰

## ğŸ”Œ WebSocket è¿æ¥é…ç½®

### 1. åˆ›å»º WebSocket è¯·æ±‚

åœ¨ Postman ä¸­ï¼š
1. ç‚¹å‡» **New** â†’ é€‰æ‹© **WebSocket Request**
2. æˆ–ç›´æ¥åœ¨åœ°å€æ é€‰æ‹© **WebSocket** ç±»å‹

### 2. è¿æ¥åœ°å€é…ç½®

#### æ–¹å¼ä¸€ï¼šåŸç”ŸWebSocketè¿æ¥ï¼ˆæ¨èï¼‰
```
ws://192.168.1.132:8082/ws/chat/native?userId=1
```

#### æ–¹å¼äºŒï¼šSockJSè¿æ¥
```
ws://192.168.1.132:8082/ws/chat?userId=1
```

**å‚æ•°è¯´æ˜**ï¼š
- `userId`: å½“å‰ç™»å½•ç”¨æˆ·çš„IDï¼ˆå¿…é¡»ï¼Œæ•°å­—ç±»å‹ï¼‰
- ç¤ºä¾‹ï¼šuserId=1, userId=123, userId=456

### 3. å»ºç«‹è¿æ¥

1. è¾“å…¥WebSocketåœ°å€
2. ç‚¹å‡» **Connect** æŒ‰é’®
3. è¿æ¥æˆåŠŸåï¼ŒçŠ¶æ€æ˜¾ç¤ºä¸º **Connected**ï¼ˆç»¿è‰²ï¼‰

## ğŸ“¤ å‘é€æ¶ˆæ¯æµ‹è¯•

### æ¶ˆæ¯æ ¼å¼è¯´æ˜

æ‰€æœ‰æ¶ˆæ¯å¿…é¡»æ˜¯JSONæ ¼å¼ï¼š
```json
{
    "type": "æ¶ˆæ¯ç±»å‹",
    "data": { 
        // æ¶ˆæ¯æ•°æ®
    },
    "timestamp": 1700000000000
}
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•1ï¼šå¿ƒè·³æ¶ˆæ¯

**ç›®çš„**ï¼šæµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œä¿æŒè¿æ¥æ´»è·ƒ

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "heartbeat",
    "timestamp": 1700000000000
}
```

**é¢„æœŸå“åº”**ï¼š
```json
{
    "type": "heartbeat_response",
    "success": true,
    "timestamp": 1700000000123
}
```

**æ“ä½œæ­¥éª¤**ï¼š
1. åœ¨ **Message** è¾“å…¥æ¡†ç²˜è´´å¿ƒè·³æ¶ˆæ¯JSON
2. ç‚¹å‡» **Send** æŒ‰é’®
3. æŸ¥çœ‹ **Messages** é¢æ¿çš„å“åº”

---

### æµ‹è¯•2ï¼šå‘é€ç§èŠæ¶ˆæ¯

**ç›®çš„**ï¼šæµ‹è¯•å‘æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯

**å‰ç½®æ¡ä»¶**ï¼š
- å‘é€è€…userId=1ï¼ˆè¿æ¥æ—¶æŒ‡å®šï¼‰
- æ¥æ”¶è€…userId=2ï¼ˆéœ€è¦å­˜åœ¨çš„ç”¨æˆ·ï¼‰

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "send_message",
    "data": {
        "receiverId": 2,
        "content": "ä½ å¥½ï¼Œè¿™æ˜¯æµ‹è¯•æ¶ˆæ¯ï¼",
        "messageType": "text"
    },
    "timestamp": 1700000000000
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `receiverId`: æ¥æ”¶è€…ç”¨æˆ·IDï¼ˆå¿…é¡»ï¼‰
- `content`: æ¶ˆæ¯å†…å®¹ï¼ˆå¿…é¡»ï¼‰
- `messageType`: æ¶ˆæ¯ç±»å‹ï¼Œå¯é€‰å€¼ï¼š
  - `text` - æ–‡æœ¬æ¶ˆæ¯
  - `image` - å›¾ç‰‡æ¶ˆæ¯
  - `voice` - è¯­éŸ³æ¶ˆæ¯
  - `video` - è§†é¢‘æ¶ˆæ¯
  - `file` - æ–‡ä»¶æ¶ˆæ¯

**é¢„æœŸå“åº”**ï¼š
```json
{
    "type": "success",
    "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
    "success": true,
    "timestamp": 1700000000123
}
```

---

### æµ‹è¯•3ï¼šå‘é€ç¾¤èŠæ¶ˆæ¯

**ç›®çš„**ï¼šæµ‹è¯•å‘ç¾¤ç»„å‘é€æ¶ˆæ¯

**å‰ç½®æ¡ä»¶**ï¼š
- ç¾¤ç»„ID=10ï¼ˆéœ€è¦å­˜åœ¨çš„ç¾¤ç»„ï¼‰
- ç”¨æˆ·å¿…é¡»æ˜¯ç¾¤æˆå‘˜

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "send_message",
    "data": {
        "groupId": 10,
        "content": "å¤§å®¶å¥½ï¼Œè¿™æ˜¯ç¾¤æ¶ˆæ¯æµ‹è¯•ï¼",
        "messageType": "text"
    },
    "timestamp": 1700000000000
}
```

**é¢„æœŸå“åº”**ï¼š
```json
{
    "type": "success",
    "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
    "success": true,
    "timestamp": 1700000000123
}
```

---

### æµ‹è¯•4ï¼šè¾“å…¥çŠ¶æ€æç¤º

**ç›®çš„**ï¼šæµ‹è¯•"æ­£åœ¨è¾“å…¥..."çŠ¶æ€é€šçŸ¥

**åœºæ™¯**ï¼šç”¨æˆ·1æ­£åœ¨ç»™ç”¨æˆ·2è¾“å…¥æ¶ˆæ¯

**å‘é€æ¶ˆæ¯ï¼ˆå¼€å§‹è¾“å…¥ï¼‰**ï¼š
```json
{
    "type": "typing",
    "data": {
        "targetId": 2,
        "targetType": "user",
        "isTyping": true
    },
    "timestamp": 1700000000000
}
```

**å‘é€æ¶ˆæ¯ï¼ˆåœæ­¢è¾“å…¥ï¼‰**ï¼š
```json
{
    "type": "typing",
    "data": {
        "targetId": 2,
        "targetType": "user",
        "isTyping": false
    },
    "timestamp": 1700000000000
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `targetId`: ç›®æ ‡ç”¨æˆ·æˆ–ç¾¤ç»„ID
- `targetType`: ç±»å‹ï¼Œ`user`ï¼ˆç§èŠï¼‰æˆ– `group`ï¼ˆç¾¤èŠï¼‰
- `isTyping`: true=æ­£åœ¨è¾“å…¥ï¼Œfalse=åœæ­¢è¾“å…¥

---

### æµ‹è¯•5ï¼šæ ‡è®°æ¶ˆæ¯å·²è¯»

**ç›®çš„**ï¼šæ ‡è®°æŸæ¡æ¶ˆæ¯ä¸ºå·²è¯»çŠ¶æ€

**å‰ç½®æ¡ä»¶**ï¼š
- messageId=100ï¼ˆå·²å­˜åœ¨çš„æ¶ˆæ¯IDï¼‰
- conversationId=50ï¼ˆä¼šè¯IDï¼‰

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "read_message",
    "data": {
        "messageId": 100,
        "conversationId": 50
    },
    "timestamp": 1700000000000
}
```

**é¢„æœŸå“åº”**ï¼š
```json
{
    "type": "success",
    "message": "æ¶ˆæ¯å·²è¯»çŠ¶æ€æ›´æ–°æˆåŠŸ",
    "success": true,
    "timestamp": 1700000000123
}
```

---

### æµ‹è¯•6ï¼šåŠ å…¥ç¾¤ç»„

**ç›®çš„**ï¼šç”¨æˆ·åŠ å…¥æŒ‡å®šç¾¤ç»„

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "join_group",
    "data": {
        "groupId": 10
    },
    "timestamp": 1700000000000
}
```

---

### æµ‹è¯•7ï¼šç¦»å¼€ç¾¤ç»„

**ç›®çš„**ï¼šç”¨æˆ·ç¦»å¼€æŒ‡å®šç¾¤ç»„

**å‘é€æ¶ˆæ¯**ï¼š
```json
{
    "type": "leave_group",
    "data": {
        "groupId": 10
    },
    "timestamp": 1700000000000
}
```

---

## ğŸ“¥ æ¥æ”¶æ¶ˆæ¯ç±»å‹

### 1. æ–°æ¶ˆæ¯é€šçŸ¥

**ç±»å‹**ï¼š`new_message`ï¼ˆç§èŠï¼‰æˆ– `new_group_message`ï¼ˆç¾¤èŠï¼‰

**ç¤ºä¾‹**ï¼š
```json
{
    "type": "new_message",
    "data": {
        "id": 123,
        "senderId": 2,
        "receiverId": 1,
        "content": "æ”¶åˆ°äº†å—ï¼Ÿ",
        "messageType": "text",
        "createTime": "2025-11-19T14:30:00"
    },
    "success": true,
    "timestamp": 1700000000123
}
```

### 2. å¥½å‹åœ¨çº¿çŠ¶æ€

**ç±»å‹**ï¼š`friend_online_status`

**ç¤ºä¾‹**ï¼š
```json
{
    "type": "friend_online_status",
    "data": {
        "userId": 2,
        "isOnline": true,
        "timestamp": 1700000000123
    },
    "success": true,
    "timestamp": 1700000000123
}
```

### 3. è¾“å…¥çŠ¶æ€

**ç±»å‹**ï¼š`typing_status`

**ç¤ºä¾‹**ï¼š
```json
{
    "type": "typing_status",
    "data": {
        "userId": 2,
        "isTyping": true,
        "targetType": "user"
    },
    "success": true,
    "timestamp": 1700000000123
}
```

### 4. é”™è¯¯æ¶ˆæ¯

**ç±»å‹**ï¼š`error`

**ç¤ºä¾‹**ï¼š
```json
{
    "type": "error",
    "message": "ç”¨æˆ·æœªè®¤è¯",
    "success": false,
    "timestamp": 1700000000123
}
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¿æ¥æ—¥å¿—

åœ¨ Postman çš„ **Messages** é¢æ¿ä¸­ï¼š
- **â†‘** ç»¿è‰²ç®­å¤´ï¼šå·²å‘é€çš„æ¶ˆæ¯
- **â†“** è“è‰²ç®­å¤´ï¼šæ¥æ”¶åˆ°çš„æ¶ˆæ¯
- æ—¶é—´æˆ³æ˜¾ç¤ºæ¯æ¡æ¶ˆæ¯çš„å‘é€/æ¥æ”¶æ—¶é—´

### 2. ä¿å­˜æµ‹è¯•ç”¨ä¾‹

1. ç‚¹å‡» **Save** ä¿å­˜WebSocketè¯·æ±‚
2. åœ¨ **Message** ä¸­å¯ä»¥ä¿å­˜å¤šä¸ªæ¶ˆæ¯æ¨¡æ¿
3. å¿«é€Ÿåˆ‡æ¢ä¸åŒçš„æµ‹è¯•æ¶ˆæ¯

### 3. ä½¿ç”¨é›†åˆï¼ˆCollectionï¼‰

åˆ›å»ºæµ‹è¯•é›†åˆï¼š
```
WebSocket Tests
â”œâ”€â”€ è¿æ¥æµ‹è¯•
â”œâ”€â”€ å¿ƒè·³æµ‹è¯•
â”œâ”€â”€ ç§èŠæ¶ˆæ¯æµ‹è¯•
â”œâ”€â”€ ç¾¤èŠæ¶ˆæ¯æµ‹è¯•
â”œâ”€â”€ è¾“å…¥çŠ¶æ€æµ‹è¯•
â””â”€â”€ å·²è¯»çŠ¶æ€æµ‹è¯•
```

### 4. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Postman ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

**å˜é‡å** | **å€¼** | **è¯´æ˜**
---|---|---
`ws_host` | `192.168.1.132:8082` | WebSocketæœåŠ¡å™¨åœ°å€
`user_id` | `1` | å½“å‰ç”¨æˆ·ID
`target_user_id` | `2` | ç›®æ ‡ç”¨æˆ·ID
`group_id` | `10` | ç¾¤ç»„ID

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```
ws://{{ws_host}}/ws/chat/native?userId={{user_id}}
```

æ¶ˆæ¯ä½“ä¸­ä½¿ç”¨ï¼š
```json
{
    "type": "send_message",
    "data": {
        "receiverId": {{target_user_id}},
        "content": "æµ‹è¯•æ¶ˆæ¯",
        "messageType": "text"
    },
    "timestamp": {{$timestamp}}
}
```

### 5. åŠ¨æ€å˜é‡

Postman æ”¯æŒçš„åŠ¨æ€å˜é‡ï¼š
- `{{$timestamp}}` - å½“å‰æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `{{$randomInt}}` - éšæœºæ•´æ•°
- `{{$guid}}` - éšæœºGUID

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### åœºæ™¯ï¼šä¸¤ä¸ªç”¨æˆ·äº’å‘æ¶ˆæ¯

#### Step 1ï¼šç”¨æˆ·1è¿æ¥ï¼ˆPostmançª—å£1ï¼‰
```
ws://192.168.1.132:8082/ws/chat/native?userId=1
```
ç‚¹å‡» **Connect**

#### Step 2ï¼šç”¨æˆ·2è¿æ¥ï¼ˆPostmançª—å£2ï¼‰
```
ws://192.168.1.132:8082/ws/chat/native?userId=2
```
ç‚¹å‡» **Connect**

#### Step 3ï¼šç”¨æˆ·1å‘é€å¿ƒè·³
```json
{
    "type": "heartbeat",
    "timestamp": 1700000000000
}
```

#### Step 4ï¼šç”¨æˆ·1ç»™ç”¨æˆ·2å‘æ¶ˆæ¯
```json
{
    "type": "send_message",
    "data": {
        "receiverId": 2,
        "content": "ä½ å¥½ï¼Œç”¨æˆ·2ï¼",
        "messageType": "text"
    },
    "timestamp": 1700000000000
}
```

#### Step 5ï¼šåœ¨ç”¨æˆ·2çš„çª—å£æŸ¥çœ‹
åº”è¯¥æ”¶åˆ° `new_message` ç±»å‹çš„æ¨é€æ¶ˆæ¯

#### Step 6ï¼šç”¨æˆ·2æ ‡è®°æ¶ˆæ¯å·²è¯»
```json
{
    "type": "read_message",
    "data": {
        "messageId": 123,
        "conversationId": 50
    },
    "timestamp": 1700000000000
}
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šè¿æ¥å¤±è´¥

**é”™è¯¯**ï¼šConnection failed

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆ192.168.1.132:8082ï¼‰
2. ç¡®è®¤WebSocketåœ°å€æ­£ç¡®
3. æ£€æŸ¥userIdå‚æ•°æ˜¯å¦ä¼ é€’

### é—®é¢˜2ï¼šå‘é€æ¶ˆæ¯æ— å“åº”

**åŸå› **ï¼šJSONæ ¼å¼é”™è¯¯æˆ–å­—æ®µç¼ºå¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. éªŒè¯JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤å¿…å¡«å­—æ®µéƒ½å·²å¡«å†™
3. æ£€æŸ¥åç«¯æ—¥å¿—æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### é—®é¢˜3ï¼šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ "ç”¨æˆ·æœªè®¤è¯"

**åŸå› **ï¼šuserIdæœªæ­£ç¡®ä¼ é€’æˆ–æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤URLä¸­åŒ…å« `?userId=æ•°å­—`
2. æ£€æŸ¥userIdæ˜¯å¦ä¸ºæœ‰æ•ˆæ•°å­—
3. é‡æ–°å»ºç«‹è¿æ¥

### é—®é¢˜4ï¼šæ¶ˆæ¯å‘é€æˆåŠŸä½†æ¥æ”¶æ–¹æ”¶ä¸åˆ°

**åŸå› **ï¼šæ¥æ”¶æ–¹æœªè¿æ¥æˆ–userIdä¸å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤æ¥æ”¶æ–¹å·²å»ºç«‹WebSocketè¿æ¥
2. æ£€æŸ¥receiverIdæ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹åç«¯æ—¥å¿—ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æ¨é€

---

## ğŸ“Š ç›‘æ§é¢æ¿

### Postman Messages é¢æ¿è¯´æ˜

```
[â†‘] 14:30:15.123  å‘é€: {"type":"heartbeat",...}
[â†“] 14:30:15.145  æ¥æ”¶: {"type":"heartbeat_response",...}
[â†‘] 14:30:20.456  å‘é€: {"type":"send_message",...}
[â†“] 14:30:20.478  æ¥æ”¶: {"type":"success",...}
[â†“] 14:30:21.001  æ¥æ”¶: {"type":"new_message",...}
```

- **[â†‘]** - å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼ˆç»¿è‰²ï¼‰
- **[â†“]** - æœåŠ¡å™¨æ¨é€çš„æ¶ˆæ¯ï¼ˆè“è‰²ï¼‰
- æ—¶é—´æˆ³æ ¼å¼ï¼šæ—¶:åˆ†:ç§’.æ¯«ç§’

---

## ğŸ¯ æµ‹è¯•æ¸…å•

- [ ] è¿æ¥æˆåŠŸï¼ˆuserIdå‚æ•°æ­£ç¡®ï¼‰
- [ ] å¿ƒè·³æ¶ˆæ¯æ­£å¸¸å“åº”
- [ ] å‘é€ç§èŠæ¶ˆæ¯æˆåŠŸ
- [ ] å‘é€ç¾¤èŠæ¶ˆæ¯æˆåŠŸ
- [ ] è¾“å…¥çŠ¶æ€é€šçŸ¥æ­£å¸¸
- [ ] æ¶ˆæ¯å·²è¯»çŠ¶æ€æ›´æ–°
- [ ] åŠ å…¥/ç¦»å¼€ç¾¤ç»„åŠŸèƒ½
- [ ] æ–­å¼€è¿æ¥åçŠ¶æ€æ›´æ–°
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸

---

## ğŸ’¡ é«˜çº§æŠ€å·§

### 1. ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–æµ‹è¯•

åœ¨ Postman çš„ **Scripts** æ ‡ç­¾ä¸­æ·»åŠ ï¼š

```javascript
// è¿æ¥åè‡ªåŠ¨å‘é€å¿ƒè·³
ws.on('open', () => {
    console.log('WebSocketå·²è¿æ¥');
    
    // æ¯30ç§’å‘é€ä¸€æ¬¡å¿ƒè·³
    setInterval(() => {
        ws.send(JSON.stringify({
            type: 'heartbeat',
            timestamp: Date.now()
        }));
    }, 30000);
});

// æ¥æ”¶æ¶ˆæ¯å¤„ç†
ws.on('message', (data) => {
    const response = JSON.parse(data);
    console.log('æ”¶åˆ°æ¶ˆæ¯:', response);
    
    // è‡ªåŠ¨å“åº”æ–°æ¶ˆæ¯
    if (response.type === 'new_message') {
        console.log('æ”¶åˆ°æ–°æ¶ˆæ¯:', response.data.content);
    }
});
```

### 2. æ‰¹é‡æµ‹è¯•

åˆ›å»ºå¤šä¸ªè¯·æ±‚ï¼Œä½¿ç”¨ **Collection Runner** æ‰¹é‡æ‰§è¡Œ

### 3. å¯¼å‡º/å¯¼å…¥æµ‹è¯•ç”¨ä¾‹

1. å¯¼å‡ºï¼šå³é”®Collection â†’ **Export**
2. å¯¼å…¥ï¼š**Import** â†’ é€‰æ‹©å¯¼å‡ºçš„JSONæ–‡ä»¶
3. åˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. åç«¯æ§åˆ¶å°æ—¥å¿—
2. Postman Console æ—¥å¿—ï¼ˆView â†’ Show Postman Consoleï¼‰
3. ç½‘ç»œè¿æ¥çŠ¶æ€

**åç«¯æ—¥å¿—å…³é”®å­—**ï¼š
- `WebSocketè¿æ¥å»ºç«‹`
- `ç”¨æˆ· X è¿æ¥æˆåŠŸ`
- `æ”¶åˆ°WebSocketæ¶ˆæ¯`
- `WebSocketè¿æ¥å…³é—­`
