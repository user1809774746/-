# å¸–å­å®¡æ ¸ç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

ç”¨æˆ·å‘å¸ƒçš„å¸–å­éœ€è¦ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡åæ‰èƒ½å¯¹å¤–å±•ç¤ºã€‚

### æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·å‘å¸ƒå¸–å­ â†’ å¾…å®¡æ ¸ â†’ ç®¡ç†å‘˜å®¡æ ¸ â†’ é€šè¿‡/æ‹’ç»
```

---

## ğŸš€ åç«¯æ¥å£åˆ—è¡¨

### ç”¨æˆ·ç«¯æ¥å£ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| åˆ›å»ºå¸–å­ | POST | `/api/post/create` | åˆ›å»ºè‰ç¨¿ |
| å‘å¸ƒå¸–å­ | POST | `/api/post/{postId}/publish` | æäº¤å®¡æ ¸ |
| æˆ‘çš„å¸–å­ | GET | `/api/post/my-posts` | æŸ¥çœ‹å®¡æ ¸çŠ¶æ€ |

### ç®¡ç†å‘˜ç«¯æ¥å£ï¼ˆæ–°å¢ï¼‰

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å¾…å®¡æ ¸åˆ—è¡¨ | GET | `/api/admin/posts/pending` | è·å–å¾…å®¡æ ¸å¸–å­ |
| æ‰€æœ‰å¸–å­ | GET | `/api/admin/posts/list` | è·å–æ‰€æœ‰å¸–å­ï¼ˆå¯ç­›é€‰ï¼‰ |
| å¸–å­è¯¦æƒ… | GET | `/api/admin/posts/{postId}` | æŸ¥çœ‹è¯¦æƒ… |
| **å®¡æ ¸é€šè¿‡** | POST | `/api/admin/posts/{postId}/approve` | **å®¡æ ¸é€šè¿‡** |
| **å®¡æ ¸æ‹’ç»** | POST | `/api/admin/posts/{postId}/reject` | **å®¡æ ¸æ‹’ç»** |
| åˆ é™¤å¸–å­ | DELETE | `/api/admin/posts/{postId}` | åˆ é™¤è¿è§„å¸–å­ |
| è®¾ç½®ç²¾é€‰ | POST | `/api/admin/posts/{postId}/feature` | è®¾ç½®ç²¾é€‰ |
| å–æ¶ˆç²¾é€‰ | DELETE | `/api/admin/posts/{postId}/feature` | å–æ¶ˆç²¾é€‰ |
| è®¾ç½®ç½®é¡¶ | POST | `/api/admin/posts/{postId}/top` | è®¾ç½®ç½®é¡¶ |
| å–æ¶ˆç½®é¡¶ | DELETE | `/api/admin/posts/{postId}/top` | å–æ¶ˆç½®é¡¶ |
| ç»Ÿè®¡ä¿¡æ¯ | GET | `/api/admin/posts/statistics` | è·å–ç»Ÿè®¡æ•°æ® |

---

## ğŸ’» å‰ç«¯é›†æˆ

### 1. ç”¨æˆ·ç«¯ - å‘å¸ƒå¸–å­

```javascript
// å‘å¸ƒå¸–å­åæç¤ºç”¨æˆ·
async function publishPost(postId) {
    const token = localStorage.getItem('token');
    
    const response = await fetch(`/api/post/${postId}/publish`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` }
    });
    
    const data = await response.json();
    
    if (data.code === 200) {
        // âš ï¸ é‡è¦ï¼šæç¤ºç”¨æˆ·éœ€è¦ç­‰å¾…å®¡æ ¸
        alert('æ‚¨çš„å¸–å­å·²æäº¤å®¡æ ¸ï¼Œå®¡æ ¸é€šè¿‡åå°†å¯¹å¤–å±•ç¤º');
    }
}
```

### 2. ç”¨æˆ·ç«¯ - æ˜¾ç¤ºå®¡æ ¸çŠ¶æ€

```html
<!-- åœ¨"æˆ‘çš„å¸–å­"é¡µé¢æ˜¾ç¤ºå®¡æ ¸çŠ¶æ€ -->
<div class="post-card" v-for="post in myPosts" :key="post.id">
    <h3>{{ post.title }}</h3>
    
    <!-- å®¡æ ¸çŠ¶æ€æ ‡ç­¾ -->
    <span v-if="post.auditStatus === 'pending'" class="badge badge-warning">
        â° å¾…å®¡æ ¸
    </span>
    <span v-else-if="post.auditStatus === 'approved'" class="badge badge-success">
        âœ… å®¡æ ¸é€šè¿‡
    </span>
    <span v-else-if="post.auditStatus === 'rejected'" class="badge badge-danger">
        âŒ å®¡æ ¸æ‹’ç»
    </span>
    
    <!-- æ‹’ç»åŸå›  -->
    <div v-if="post.auditStatus === 'rejected'" class="alert alert-danger">
        <p>æ‹’ç»åŸå› ï¼š{{ post.auditReason }}</p>
        <button @click="editPost(post.id)">ä¿®æ”¹å¹¶é‡æ–°æäº¤</button>
    </div>
</div>
```

### 3. ç®¡ç†å‘˜ç«¯ - å®¡æ ¸é¡µé¢

```javascript
// è·å–å¾…å®¡æ ¸å¸–å­
async function getPendingPosts() {
    const token = localStorage.getItem('token');
    
    const response = await fetch('/api/admin/posts/pending', {
        headers: { 'Authorization': `Bearer ${token}` }
    });
    
    const data = await response.json();
    
    if (data.code === 403) {
        alert('éœ€è¦ç®¡ç†å‘˜æƒé™');
        return;
    }
    
    if (data.code === 200) {
        return data.data.posts;
    }
}

// å®¡æ ¸é€šè¿‡
async function approvePost(postId) {
    const token = localStorage.getItem('token');
    
    const response = await fetch(`/api/admin/posts/${postId}/approve`, {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` }
    });
    
    const data = await response.json();
    
    if (data.code === 200) {
        alert('å®¡æ ¸é€šè¿‡');
        // åˆ·æ–°åˆ—è¡¨
        location.reload();
    }
}

// å®¡æ ¸æ‹’ç»
async function rejectPost(postId) {
    const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
    
    if (!reason) return;
    
    const token = localStorage.getItem('token');
    
    const response = await fetch(`/api/admin/posts/${postId}/reject`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ reason: reason })
    });
    
    const data = await response.json();
    
    if (data.code === 200) {
        alert('å®¡æ ¸æ‹’ç»');
        // åˆ·æ–°åˆ—è¡¨
        location.reload();
    }
}
```

### 4. ç®¡ç†å‘˜ç«¯ - å®Œæ•´é¡µé¢ç¤ºä¾‹

```html
<!DOCTYPE html>
<html>
<head>
    <title>å¸–å­å®¡æ ¸ç®¡ç†</title>
</head>
<body>
    <h1>å¸–å­å®¡æ ¸ç®¡ç†</h1>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div id="statistics">
        <p>å¾…å®¡æ ¸ï¼š<span id="pendingCount">0</span></p>
        <p>å·²é€šè¿‡ï¼š<span id="approvedCount">0</span></p>
        <p>å·²æ‹’ç»ï¼š<span id="rejectedCount">0</span></p>
    </div>
    
    <!-- å¾…å®¡æ ¸å¸–å­åˆ—è¡¨ -->
    <div id="postList"></div>
    
    <script>
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        window.onload = async function() {
            await loadStatistics();
            await loadPendingPosts();
        };
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStatistics() {
            const token = localStorage.getItem('token');
            
            const response = await fetch('/api/admin/posts/statistics', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await response.json();
            
            if (data.code === 200) {
                const stats = data.data;
                document.getElementById('pendingCount').textContent = stats.pendingCount;
                document.getElementById('approvedCount').textContent = stats.approvedCount;
                document.getElementById('rejectedCount').textContent = stats.rejectedCount;
            }
        }
        
        // åŠ è½½å¾…å®¡æ ¸å¸–å­
        async function loadPendingPosts() {
            const token = localStorage.getItem('token');
            
            const response = await fetch('/api/admin/posts/pending', {
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await response.json();
            
            if (data.code === 200) {
                const posts = data.data.posts;
                const listHtml = posts.map(post => `
                    <div class="post-item">
                        <h3>${post.title}</h3>
                        <p>å‘å¸ƒè€…ï¼š${post.publisherPhone}</p>
                        <p>å‘å¸ƒæ—¶é—´ï¼š${new Date(post.publishedTime).toLocaleString()}</p>
                        <button onclick="viewDetail(${post.id})">æŸ¥çœ‹è¯¦æƒ…</button>
                        <button onclick="approvePost(${post.id})">é€šè¿‡</button>
                        <button onclick="rejectPost(${post.id})">æ‹’ç»</button>
                    </div>
                `).join('');
                
                document.getElementById('postList').innerHTML = listHtml;
            }
        }
        
        // æŸ¥çœ‹è¯¦æƒ…
        function viewDetail(postId) {
            window.location.href = `/admin/post-detail.html?id=${postId}`;
        }
        
        // å®¡æ ¸é€šè¿‡
        async function approvePost(postId) {
            if (!confirm('ç¡®è®¤é€šè¿‡æ­¤å¸–å­ï¼Ÿ')) return;
            
            const token = localStorage.getItem('token');
            
            const response = await fetch(`/api/admin/posts/${postId}/approve`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            });
            
            const data = await response.json();
            
            if (data.code === 200) {
                alert('å®¡æ ¸é€šè¿‡');
                location.reload();
            } else {
                alert(data.data);
            }
        }
        
        // å®¡æ ¸æ‹’ç»
        async function rejectPost(postId) {
            const reason = prompt('è¯·è¾“å…¥æ‹’ç»åŸå› ï¼š');
            if (!reason || !reason.trim()) {
                alert('è¯·è¾“å…¥æ‹’ç»åŸå› ');
                return;
            }
            
            const token = localStorage.getItem('token');
            
            const response = await fetch(`/api/admin/posts/${postId}/reject`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ reason: reason })
            });
            
            const data = await response.json();
            
            if (data.code === 200) {
                alert('å®¡æ ¸æ‹’ç»');
                location.reload();
            } else {
                alert(data.data);
            }
        }
    </script>
</body>
</html>
```

---

## ğŸ¯ å…³é”®å­—æ®µ

### audit_status (å®¡æ ¸çŠ¶æ€)

| å€¼ | è¯´æ˜ | ç”¨æˆ·å¯è§ | å…¶ä»–ç”¨æˆ·å¯è§ |
|----|------|----------|--------------|
| `pending` | å¾…å®¡æ ¸ | âœ… | âŒ |
| `approved` | å®¡æ ¸é€šè¿‡ | âœ… | âœ… |
| `rejected` | å®¡æ ¸æ‹’ç» | âœ… | âŒ |

### status (å‘å¸ƒçŠ¶æ€)

| å€¼ | è¯´æ˜ |
|----|------|
| `draft` | è‰ç¨¿ |
| `published` | å·²å‘å¸ƒ |
| `deleted` | å·²åˆ é™¤ |

---

## âš ï¸ é‡è¦æç¤º

1. **ç”¨æˆ·å‘å¸ƒåä¸å¯è§**ï¼šç”¨æˆ·å‘å¸ƒå¸–å­åï¼Œå…¶ä»–ç”¨æˆ·æš‚æ—¶çœ‹ä¸åˆ°ï¼Œéœ€è¦ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡
2. **å®¡æ ¸æ‹’ç»åŸå› å¿…å¡«**ï¼šç®¡ç†å‘˜æ‹’ç»å¸–å­æ—¶å¿…é¡»æä¾›åŸå› 
3. **ç®¡ç†å‘˜æƒé™**ï¼šæ‰€æœ‰ `/api/admin/posts/*` æ¥å£éƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
4. **ç²¾é€‰å’Œç½®é¡¶**ï¼šåªæœ‰å®¡æ ¸é€šè¿‡çš„å¸–å­æ‰èƒ½è®¾ç½®ä¸ºç²¾é€‰æˆ–ç½®é¡¶

---

## ğŸ“ å¸¸è§é—®é¢˜

**Q: å¦‚ä½•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜ï¼Ÿ**  
A: è°ƒç”¨ `GET /api/auth/user-info`ï¼Œæ£€æŸ¥ `isAdmin` å­—æ®µ

**Q: å®¡æ ¸æ‹’ç»åç”¨æˆ·èƒ½çœ‹åˆ°åŸå› å—ï¼Ÿ**  
A: èƒ½ã€‚ç”¨æˆ·åœ¨"æˆ‘çš„å¸–å­"ä¸­å¯ä»¥çœ‹åˆ° `auditReason` å­—æ®µ

**Q: ç”¨æˆ·èƒ½é‡æ–°æäº¤è¢«æ‹’ç»çš„å¸–å­å—ï¼Ÿ**  
A: èƒ½ã€‚ä¿®æ”¹åè°ƒç”¨ `POST /api/post/{postId}/publish` é‡æ–°æäº¤

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] åç«¯ä»£ç å·²éƒ¨ç½²
- [ ] æ•°æ®åº“ `audit_status` å­—æ®µå­˜åœ¨
- [ ] ç®¡ç†å‘˜è´¦å·å·²åˆ›å»º
- [ ] å‰ç«¯å·²æ·»åŠ å®¡æ ¸çŠ¶æ€æ˜¾ç¤º
- [ ] ç®¡ç†å‘˜å®¡æ ¸é¡µé¢å·²åˆ›å»º
- [ ] æµ‹è¯•é€šè¿‡/æ‹’ç»åŠŸèƒ½

---

**ç³»ç»Ÿå·²å®Œæˆï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼** ğŸ‰

