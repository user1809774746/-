# å‰ç«¯é›†æˆæŒ‡å— - é‡è¦å˜æ›´è¯´æ˜

## ğŸš¨ é‡è¦æç¤º

æœ¬æ–‡æ¡£åˆ—å‡ºäº†åç«¯æœ€æ–°ä¿®æ”¹ï¼Œ**è¯·å‰ç«¯å¼€å‘è€…åŠ¡å¿…ä»”ç»†é˜…è¯»å¹¶æŒ‰ç…§è¯´æ˜ä¿®æ”¹å‰ç«¯ä»£ç **ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´åŠŸèƒ½å¼‚å¸¸ã€‚

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“è¡¨ç»“æ„å˜æ›´](#1-æ•°æ®åº“è¡¨ç»“æ„å˜æ›´)
2. [æ–°å¢æ¥å£](#2-æ–°å¢æ¥å£)
3. [ä¿®æ”¹åçš„è°ƒç”¨æ–¹å¼](#3-ä¿®æ”¹åçš„è°ƒç”¨æ–¹å¼)
4. [å‰ç«¯ä»£ç ä¿®æ”¹æ¸…å•](#4-å‰ç«¯ä»£ç ä¿®æ”¹æ¸…å•)
5. [æµ‹è¯•æ£€æŸ¥æ¸…å•](#5-æµ‹è¯•æ£€æŸ¥æ¸…å•)

---

## 1. æ•°æ®åº“è¡¨ç»“æ„å˜æ›´

### âš ï¸ å…³é”®å˜æ›´

**æ•°æ®åº“è¡¨ç»“æ„å·²å®Œå…¨é‡å»º**ï¼Œé‡‡ç”¨åŒè¡¨æ¶æ„ï¼š

| è¡¨å | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| `travel_post` | å¸–å­ä¸»è¡¨ | å­˜å‚¨å¸–å­çš„æ‰€æœ‰å†…å®¹ï¼ˆæ ‡é¢˜ã€å†…å®¹ã€å›¾ç‰‡ç­‰ï¼‰ |
| `user_travel_post` | ç”¨æˆ·å…³è”è¡¨ | å­˜å‚¨ç”¨æˆ·ä¸å¸–å­çš„å…³è”å…³ç³» |

### ğŸ”´ å‰ç«¯æ— éœ€å…³å¿ƒçš„å˜åŒ–

è™½ç„¶æ•°æ®åº“è¡¨ç»“æ„å˜æ›´ï¼Œä½†**å‰ç«¯è°ƒç”¨çš„ API æ¥å£ä¿æŒä¸å˜**ï¼Œè¿”å›çš„æ•°æ®ç»“æ„ä¹Ÿä¿æŒä¸å˜ã€‚

**ç»“è®º**: âœ… åŸæœ‰çš„å¸–å­åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ¥å£**æ— éœ€ä¿®æ”¹å‰ç«¯ä»£ç **ã€‚

---

## 2. æ–°å¢æ¥å£

### ğŸ†• æ¥å£1: è‰ç¨¿è½¬æ¢å¹¶å‘å¸ƒ

**ä¹‹å‰**: æ²¡æœ‰ç›´æ¥å‘å¸ƒè‰ç¨¿çš„æ¥å£

**ç°åœ¨**: æ–°å¢äº†ä¸€æ­¥å®Œæˆå‘å¸ƒçš„æ¥å£

```javascript
// æ–°å¢æ¥å£
POST /api/post/draft/{draftId}/convert-and-publish
```

### ğŸ†• æ¥å£2: åˆ é™¤è‰ç¨¿

**ä¹‹å‰**: æ²¡æœ‰åˆ é™¤è‰ç¨¿çš„æ¥å£

**ç°åœ¨**: æ–°å¢äº†åˆ é™¤è‰ç¨¿çš„æ¥å£

```javascript
// æ–°å¢æ¥å£
DELETE /api/post/draft/{draftId}
```

---

## 3. ä¿®æ”¹åçš„è°ƒç”¨æ–¹å¼

### ğŸ“ åœºæ™¯1: ä¿å­˜è‰ç¨¿ (æ— å˜æ›´)

ä¿å­˜è‰ç¨¿çš„æ¥å£**ä¿æŒä¸å˜**ï¼Œä½†è¯·æ³¨æ„ä»¥ä¸‹è¦ç‚¹ï¼š

#### âœ… æ­£ç¡®çš„è°ƒç”¨æ–¹å¼

```javascript
// ä¿å­˜è‰ç¨¿æ—¶ï¼ŒåŠ¡å¿…å°†å®Œæ•´çš„å¸–å­æ•°æ®å­˜å…¥ draftData å­—æ®µ
const saveDraft = async (formData) => {
  const response = await fetch('/api/post/draft/save', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      draftId: existingDraftId,  // å¯é€‰ï¼Œæ›´æ–°è‰ç¨¿æ—¶æä¾›
      draftTitle: formData.title,
      draftContent: formData.content,
      
      // ğŸ”´ é‡è¦ï¼šå®Œæ•´çš„å¸–å­æ•°æ®
      draftData: {
        title: formData.title,
        summary: formData.summary,
        content: formData.content,
        contentType: formData.contentType || 'richtext',
        postType: formData.postType || 'travel_note',
        category: formData.category,
        coverImage: formData.coverImage,
        images: formData.images || [],
        videos: formData.videos || [],
        attachments: formData.attachments || [],
        destinationName: formData.destinationName,
        destinationCity: formData.destinationCity,
        destinationProvince: formData.destinationProvince,
        destinationCountry: formData.destinationCountry || 'China',
        locations: formData.locations || [],
        travelStartDate: formData.travelStartDate,
        travelEndDate: formData.travelEndDate,
        travelDays: formData.travelDays,
        travelBudget: formData.travelBudget,
        actualCost: formData.actualCost,
        travelSeason: formData.travelSeason,
        travelStyle: formData.travelStyle,
        companionType: formData.companionType,
        tags: formData.tags,
        keywords: formData.keywords,
        isOriginal: formData.isOriginal !== false
      },
      
      isAutoSave: false
    })
  });
  
  const result = await response.json();
  return result;
};
```

#### âŒ é”™è¯¯çš„è°ƒç”¨æ–¹å¼

```javascript
// âŒ é”™è¯¯ï¼šåªä¿å­˜åŸºæœ¬ä¿¡æ¯ï¼Œæ²¡æœ‰ draftData
const saveDraft = async (formData) => {
  const response = await fetch('/api/post/draft/save', {
    method: 'POST',
    body: JSON.stringify({
      draftTitle: formData.title,
      draftContent: formData.content
      // ç¼ºå°‘ draftDataï¼å‘å¸ƒæ—¶ä¼šä¸¢å¤±å¾ˆå¤šä¿¡æ¯ï¼
    })
  });
};
```

---

### ğŸš€ åœºæ™¯2: å‘å¸ƒè‰ç¨¿ (æ–°å¢)

#### â­ æ¨èæ–¹å¼ï¼šä½¿ç”¨æ–°æ¥å£ä¸€æ­¥å‘å¸ƒ

```javascript
/**
 * å‘å¸ƒè‰ç¨¿ï¼ˆæ¨èæ–¹å¼ï¼‰
 * @param {number} draftId - è‰ç¨¿ID
 */
const publishDraft = async (draftId) => {
  try {
    const response = await fetch(`/api/post/draft/${draftId}/convert-and-publish`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      // å‘å¸ƒæˆåŠŸ
      console.log('å‘å¸ƒæˆåŠŸï¼Œå¸–å­ID:', result.data.id);
      
      // 1. åˆ·æ–°å·²å‘å¸ƒåˆ—è¡¨
      await loadPublishedPosts();
      
      // 2. åˆ·æ–°è‰ç¨¿åˆ—è¡¨ï¼ˆè¯¥è‰ç¨¿å·²è‡ªåŠ¨åˆ é™¤ï¼‰
      await loadDrafts();
      
      // 3. åˆ‡æ¢åˆ°å·²å‘å¸ƒæ ‡ç­¾é¡µ
      setActiveTab('published');
      
      // 4. æç¤ºç”¨æˆ·
      alert('å‘å¸ƒæˆåŠŸï¼');
      
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('å‘å¸ƒå¤±è´¥:', error);
    alert('å‘å¸ƒå¤±è´¥ï¼š' + error.message);
    throw error;
  }
};
```

#### ğŸ”„ æ—§æ–¹å¼ï¼ˆä»ç„¶æ”¯æŒï¼Œä½†ä¸æ¨èï¼‰

å¦‚æœå‰ç«¯å·²ç»å®ç°äº†ä»¥ä¸‹é€»è¾‘ï¼Œä»ç„¶å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼š

```javascript
// æ—§æ–¹å¼ï¼šåˆ›å»ºå¸–å­ â†’ å‘å¸ƒå¸–å­
const publishDraftOldWay = async (draftId) => {
  // 1. è·å–è‰ç¨¿æ•°æ®
  const draft = draftPosts.list.find(d => d.id === draftId);
  
  // 2. åˆ›å»ºå¸–å­
  const createResponse = await createPost(draft.draftData);
  
  // 3. å‘å¸ƒå¸–å­
  const publishResponse = await publishPost(createResponse.data.id);
  
  // 4. æ‰‹åŠ¨åˆ é™¤è‰ç¨¿
  await deleteDraft(draftId);
};
```

**å»ºè®®**: ä½¿ç”¨æ–°æ¥å£ `convert-and-publish`ï¼Œæ›´ç®€å•å¯é ã€‚

---

### ğŸ—‘ï¸ åœºæ™¯3: åˆ é™¤è‰ç¨¿ (æ–°å¢)

```javascript
/**
 * åˆ é™¤è‰ç¨¿
 * @param {number} draftId - è‰ç¨¿ID
 */
const deleteDraft = async (draftId) => {
  try {
    const response = await fetch(`/api/post/draft/${draftId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      console.log('è‰ç¨¿åˆ é™¤æˆåŠŸ');
      
      // åˆ·æ–°è‰ç¨¿åˆ—è¡¨
      await loadDrafts();
      
      return true;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('åˆ é™¤å¤±è´¥:', error);
    alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
    throw error;
  }
};
```

---

### ğŸ“– åœºæ™¯4: è·å–è‰ç¨¿åˆ—è¡¨ (æ— å˜æ›´)

è·å–è‰ç¨¿åˆ—è¡¨çš„æ¥å£**ä¿æŒä¸å˜**ï¼š

```javascript
/**
 * è·å–æˆ‘çš„è‰ç¨¿åˆ—è¡¨
 */
const loadDrafts = async () => {
  try {
    const response = await fetch('/api/post/draft/my', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      console.log('è‰ç¨¿åˆ—è¡¨:', result.data.list);
      // æ¯ä¸ªè‰ç¨¿åŒ…å«:
      // - id: è‰ç¨¿ID
      // - title: è‰ç¨¿æ ‡é¢˜
      // - content: è‰ç¨¿å†…å®¹
      // - updatedTime: æ›´æ–°æ—¶é—´
      // - draftData: å®Œæ•´çš„å¸–å­æ•°æ® (é‡è¦ï¼)
      
      return result.data.list;
    }
  } catch (error) {
    console.error('è·å–è‰ç¨¿åˆ—è¡¨å¤±è´¥:', error);
  }
};
```

---

## 4. å‰ç«¯ä»£ç ä¿®æ”¹æ¸…å•

### âœ… å¿…é¡»ä¿®æ”¹çš„åœ°æ–¹

#### 4.1 ä¿å­˜è‰ç¨¿åŠŸèƒ½

**æ–‡ä»¶**: `PostEditorPage.jsx` (æˆ–ç±»ä¼¼çš„ç¼–è¾‘å™¨ç»„ä»¶)

**ä¿®æ”¹å†…å®¹**: ç¡®ä¿ä¿å­˜è‰ç¨¿æ—¶åŒ…å«å®Œæ•´çš„ `draftData`

```javascript
// âŒ ä¿®æ”¹å‰ (é”™è¯¯)
const handleSaveDraft = async () => {
  await saveDraft({
    draftTitle: title,
    draftContent: content
  });
};

// âœ… ä¿®æ”¹å (æ­£ç¡®)
const handleSaveDraft = async () => {
  await saveDraft({
    draftTitle: title,
    draftContent: content,
    draftData: {
      title: title,
      summary: summary,
      content: content,
      contentType: contentType,
      postType: postType,
      category: category,
      coverImage: coverImage,
      images: images,
      videos: videos,
      // ... æ‰€æœ‰å…¶ä»–è¡¨å•å­—æ®µ
    }
  });
};
```

#### 4.2 å‘å¸ƒè‰ç¨¿åŠŸèƒ½

**æ–‡ä»¶**: `PostEditorPage.jsx` æˆ– `DraftList.jsx`

**ä¿®æ”¹å†…å®¹**: ä½¿ç”¨æ–°çš„å‘å¸ƒæ¥å£

```javascript
// âŒ ä¿®æ”¹å‰ (æ—§æ–¹å¼ï¼Œè™½ç„¶ä»å¯ç”¨ä½†ä¸æ¨è)
const handlePublishDraft = async (draftId) => {
  const draft = draftPosts.list.find(d => d.id === draftId);
  const createResponse = await createPost(draft.draftData);
  await publishPost(createResponse.data.id);
};

// âœ… ä¿®æ”¹å (æ–°æ–¹å¼ï¼Œæ¨è)
const handlePublishDraft = async (draftId) => {
  const response = await fetch(`/api/post/draft/${draftId}/convert-and-publish`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const result = await response.json();
  
  if (result.code === 200) {
    alert('å‘å¸ƒæˆåŠŸï¼');
    loadPublishedPosts();
    loadDrafts();
    setActiveTab('published');
  }
};
```

#### 4.3 åˆ é™¤è‰ç¨¿åŠŸèƒ½ (æ–°å¢)

**æ–‡ä»¶**: `DraftList.jsx` æˆ–ç±»ä¼¼ç»„ä»¶

**ä¿®æ”¹å†…å®¹**: æ·»åŠ åˆ é™¤è‰ç¨¿çš„åŠŸèƒ½

```javascript
// âœ… æ–°å¢åŠŸèƒ½
const handleDeleteDraft = async (draftId) => {
  if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè‰ç¨¿å—ï¼Ÿ')) {
    const response = await fetch(`/api/post/draft/${draftId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const result = await response.json();
    
    if (result.code === 200) {
      alert('åˆ é™¤æˆåŠŸ');
      loadDrafts();
    }
  }
};
```

---

### ğŸ” å¯é€‰ä¿®æ”¹çš„åœ°æ–¹

#### 4.4 è‰ç¨¿åˆ—è¡¨UIå¢å¼º

å»ºè®®åœ¨è‰ç¨¿åˆ—è¡¨ä¸­æ·»åŠ "å‘å¸ƒ"å’Œ"åˆ é™¤"æŒ‰é’®ï¼š

```jsx
// è‰ç¨¿åˆ—è¡¨ç»„ä»¶ç¤ºä¾‹
const DraftList = ({ drafts }) => {
  return (
    <div className="draft-list">
      {drafts.map(draft => (
        <div key={draft.id} className="draft-item">
          <h3>{draft.title}</h3>
          <p>{draft.content?.substring(0, 100)}...</p>
          <div className="draft-actions">
            {/* ç¼–è¾‘æŒ‰é’® */}
            <button onClick={() => editDraft(draft.id)}>
              ç¼–è¾‘
            </button>
            
            {/* å‘å¸ƒæŒ‰é’® */}
            <button 
              onClick={() => handlePublishDraft(draft.id)}
              className="publish-btn"
            >
              å‘å¸ƒ
            </button>
            
            {/* åˆ é™¤æŒ‰é’® */}
            <button 
              onClick={() => handleDeleteDraft(draft.id)}
              className="delete-btn"
            >
              åˆ é™¤
            </button>
          </div>
          <span className="draft-time">
            æ›´æ–°äº: {new Date(draft.updatedTime).toLocaleString()}
          </span>
        </div>
      ))}
    </div>
  );
};
```

---

## 5. æµ‹è¯•æ£€æŸ¥æ¸…å•

### ğŸ“ è‰ç¨¿åŠŸèƒ½æµ‹è¯•

- [ ] **æµ‹è¯•1: åˆ›å»ºè‰ç¨¿**
  - [ ] å¡«å†™å¸–å­è¡¨å•ï¼ˆåŒ…æ‹¬æ ‡é¢˜ã€å†…å®¹ã€å›¾ç‰‡ã€ç›®çš„åœ°ç­‰ï¼‰
  - [ ] ç‚¹å‡»"ä¿å­˜è‰ç¨¿"
  - [ ] æ£€æŸ¥ç½‘ç»œè¯·æ±‚ï¼Œç¡®è®¤ `draftData` å­—æ®µåŒ…å«å®Œæ•´æ•°æ®
  - [ ] æ£€æŸ¥è‰ç¨¿åˆ—è¡¨ï¼Œç¡®è®¤è‰ç¨¿å·²ä¿å­˜

- [ ] **æµ‹è¯•2: ç¼–è¾‘è‰ç¨¿**
  - [ ] ä»è‰ç¨¿åˆ—è¡¨ç‚¹å‡»"ç¼–è¾‘"
  - [ ] ä¿®æ”¹å†…å®¹
  - [ ] å†æ¬¡ä¿å­˜
  - [ ] ç¡®è®¤è‰ç¨¿å·²æ›´æ–°

- [ ] **æµ‹è¯•3: å‘å¸ƒè‰ç¨¿**
  - [ ] ä»è‰ç¨¿åˆ—è¡¨ç‚¹å‡»"å‘å¸ƒ"
  - [ ] æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦è°ƒç”¨ `/api/post/draft/{id}/convert-and-publish`
  - [ ] ç¡®è®¤å‘å¸ƒæˆåŠŸæç¤º
  - [ ] æ£€æŸ¥å·²å‘å¸ƒåˆ—è¡¨ï¼Œç¡®è®¤å¸–å­å‡ºç°
  - [ ] æ£€æŸ¥è‰ç¨¿åˆ—è¡¨ï¼Œç¡®è®¤è‰ç¨¿å·²æ¶ˆå¤±

- [ ] **æµ‹è¯•4: åˆ é™¤è‰ç¨¿**
  - [ ] åˆ›å»ºä¸€ä¸ªæµ‹è¯•è‰ç¨¿
  - [ ] ç‚¹å‡»"åˆ é™¤"æŒ‰é’®
  - [ ] ç¡®è®¤åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†
  - [ ] ç¡®è®¤è‰ç¨¿å·²ä»åˆ—è¡¨æ¶ˆå¤±

- [ ] **æµ‹è¯•5: æ•°æ®å®Œæ•´æ€§**
  - [ ] åˆ›å»ºåŒ…å«å¤šç§æ•°æ®çš„è‰ç¨¿ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€ç›®çš„åœ°ã€é¢„ç®—ç­‰ï¼‰
  - [ ] å‘å¸ƒè‰ç¨¿
  - [ ] æ£€æŸ¥å‘å¸ƒåçš„å¸–å­ï¼Œç¡®è®¤æ‰€æœ‰æ•°æ®éƒ½æ­£ç¡®æ˜¾ç¤º

### ğŸ”§ å¸–å­åŠŸèƒ½æµ‹è¯•

- [ ] **æµ‹è¯•6: ç›´æ¥åˆ›å»ºå¹¶å‘å¸ƒå¸–å­**
  - [ ] å¡«å†™è¡¨å•
  - [ ] ç‚¹å‡»"å‘å¸ƒ"ï¼ˆä¸ä¿å­˜è‰ç¨¿ï¼‰
  - [ ] ç¡®è®¤å¸–å­åˆ›å»ºæˆåŠŸ

- [ ] **æµ‹è¯•7: æŸ¥çœ‹å¸–å­åˆ—è¡¨**
  - [ ] åˆ‡æ¢åˆ°"å·²å‘å¸ƒ"æ ‡ç­¾é¡µ
  - [ ] ç¡®è®¤æ‰€æœ‰å·²å‘å¸ƒçš„å¸–å­éƒ½æ˜¾ç¤º
  - [ ] æ£€æŸ¥åˆ†é¡µåŠŸèƒ½

- [ ] **æµ‹è¯•8: ç¼–è¾‘å·²å‘å¸ƒçš„å¸–å­**
  - [ ] ç‚¹å‡»ç¼–è¾‘æŒ‰é’®
  - [ ] ä¿®æ”¹å†…å®¹
  - [ ] ä¿å­˜
  - [ ] ç¡®è®¤ä¿®æ”¹æˆåŠŸ

- [ ] **æµ‹è¯•9: åˆ é™¤å¸–å­**
  - [ ] åˆ é™¤ä¸€ä¸ªæµ‹è¯•å¸–å­
  - [ ] ç¡®è®¤åˆ é™¤æˆåŠŸ

---

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: å‘å¸ƒè‰ç¨¿åæ•°æ®ä¸¢å¤±

**ç°è±¡**: å‘å¸ƒè‰ç¨¿åï¼Œå¸–å­ä¸­åªæœ‰æ ‡é¢˜å’Œå†…å®¹ï¼Œå›¾ç‰‡ã€ç›®çš„åœ°ç­‰ä¿¡æ¯ä¸¢å¤±

**åŸå› **: ä¿å­˜è‰ç¨¿æ—¶æ²¡æœ‰åŒ…å«å®Œæ•´çš„ `draftData`

**è§£å†³æ–¹æ¡ˆ**: 
```javascript
// ç¡®ä¿ä¿å­˜è‰ç¨¿æ—¶åŒ…å«æ‰€æœ‰å­—æ®µ
const saveDraft = async (formData) => {
  await fetch('/api/post/draft/save', {
    body: JSON.stringify({
      draftTitle: formData.title,
      draftContent: formData.content,
      draftData: formData  // ğŸ”´ é‡è¦ï¼šåŒ…å«å®Œæ•´æ•°æ®
    })
  });
};
```

---

### é”™è¯¯2: è‰ç¨¿å‘å¸ƒå¤±è´¥

**ç°è±¡**: ç‚¹å‡»å‘å¸ƒæŒ‰é’®åï¼Œè¿”å› 400 é”™è¯¯

**å¯èƒ½åŸå› **:
1. è‰ç¨¿æ•°æ®ä¸å®Œæ•´ï¼ˆç¼ºå°‘ title æˆ– contentï¼‰
2. ä½¿ç”¨äº†é”™è¯¯çš„æ¥å£åœ°å€
3. token è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// 1. æ£€æŸ¥è‰ç¨¿æ•°æ®
console.log('è‰ç¨¿æ•°æ®:', draft.draftData);

// 2. ç¡®è®¤æ¥å£åœ°å€æ­£ç¡®
const url = `/api/post/draft/${draftId}/convert-and-publish`;  // æ­£ç¡®
// ä¸æ˜¯: `/api/post/${draftId}/publish`  // é”™è¯¯ï¼

// 3. æ£€æŸ¥ token
console.log('Token:', localStorage.getItem('token'));
```

---

### é”™è¯¯3: è‰ç¨¿åˆ—è¡¨ä¸åˆ·æ–°

**ç°è±¡**: å‘å¸ƒæˆ–åˆ é™¤è‰ç¨¿åï¼Œåˆ—è¡¨æ²¡æœ‰æ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:
```javascript
const handlePublishDraft = async (draftId) => {
  await publishDraftAPI(draftId);
  
  // ğŸ”´ é‡è¦ï¼šè®°å¾—åˆ·æ–°åˆ—è¡¨
  await loadDrafts();
  await loadPublishedPosts();
};
```

---

### é”™è¯¯4: ç½‘ç»œè¯·æ±‚æ ¼å¼é”™è¯¯

**ç°è±¡**: åç«¯è¿”å› 415 æˆ– 400 é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// âœ… æ­£ç¡®çš„è¯·æ±‚æ ¼å¼
const response = await fetch('/api/post/draft/save', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'  // ğŸ”´ é‡è¦
  },
  body: JSON.stringify(data)  // ğŸ”´ é‡è¦ï¼šåºåˆ—åŒ–ä¸º JSON
});
```

---

## ğŸ“Œ å¿«é€Ÿå‚è€ƒ

### API ç«¯ç‚¹æ€»è§ˆ

| åŠŸèƒ½ | æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|------|
| ä¿å­˜è‰ç¨¿ | POST | `/api/post/draft/save` | ä¿å­˜æˆ–æ›´æ–°è‰ç¨¿ |
| è·å–è‰ç¨¿åˆ—è¡¨ | GET | `/api/post/draft/my` | è·å–æˆ‘çš„è‰ç¨¿ |
| å‘å¸ƒè‰ç¨¿ ğŸ†• | POST | `/api/post/draft/{id}/convert-and-publish` | ä¸€æ­¥å‘å¸ƒ |
| åˆ é™¤è‰ç¨¿ ğŸ†• | DELETE | `/api/post/draft/{id}` | åˆ é™¤è‰ç¨¿ |
| åˆ›å»ºå¸–å­ | POST | `/api/post/create` | åˆ›å»ºå¸–å­ï¼ˆè‰ç¨¿çŠ¶æ€ï¼‰ |
| å‘å¸ƒå¸–å­ | POST | `/api/post/{id}/publish` | å‘å¸ƒå¸–å­ |
| è·å–å¸–å­åˆ—è¡¨ | GET | `/api/post/my?status=published` | è·å–æˆ‘çš„å¸–å­ |

### å…³é”®æ•°æ®ç»“æ„

```typescript
// è‰ç¨¿å¯¹è±¡
interface Draft {
  id: number;
  title: string;
  content: string;
  updatedTime: string;
  autoSaveTime?: string;
  draftData: {  // ğŸ”´ é‡è¦ï¼šå®Œæ•´çš„å¸–å­æ•°æ®
    title: string;
    content: string;
    contentType: string;
    postType: string;
    images: string[];
    videos: string[];
    // ... æ‰€æœ‰å…¶ä»–å­—æ®µ
  };
}

// å¸–å­å¯¹è±¡
interface Post {
  id: number;
  title: string;
  content: string;
  status: 'draft' | 'published';
  publisherId: number;
  publishedTime: string;
  createdTime: string;
  updatedTime: string;
  // ... å…¶ä»–å­—æ®µ
}
```

---

## âœ… æ€»ç»“

### å¿…é¡»ä¿®æ”¹çš„åœ°æ–¹

1. âœ… **ä¿å­˜è‰ç¨¿æ—¶åŒ…å«å®Œæ•´çš„ `draftData`**
2. âœ… **ä½¿ç”¨æ–°çš„ `/api/post/draft/{id}/convert-and-publish` æ¥å£å‘å¸ƒè‰ç¨¿**
3. âœ… **ä½¿ç”¨ `/api/post/draft/{id}` æ¥å£åˆ é™¤è‰ç¨¿**

### æ— éœ€ä¿®æ”¹çš„åœ°æ–¹

1. âœ… è·å–è‰ç¨¿åˆ—è¡¨æ¥å£ï¼ˆä¿æŒä¸å˜ï¼‰
2. âœ… åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤å¸–å­æ¥å£ï¼ˆä¿æŒä¸å˜ï¼‰
3. âœ… æ•°æ®è¿”å›æ ¼å¼ï¼ˆä¿æŒä¸å˜ï¼‰

### å…³é”®è¦ç‚¹

- ğŸ”‘ **`draftData` å­—æ®µæ˜¯å…³é”®**ï¼šå¿…é¡»åŒ…å«å®Œæ•´çš„å¸–å­æ•°æ®
- ğŸš€ **æ–°æ¥å£æ›´ç®€å•**ï¼šä¸€æ­¥å®Œæˆå‘å¸ƒï¼Œè‡ªåŠ¨åˆ é™¤è‰ç¨¿
- ğŸ”’ **å‘åå…¼å®¹**ï¼šæ—§çš„è°ƒç”¨æ–¹å¼ä»ç„¶æ”¯æŒï¼ˆä½†ä¸æ¨èï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-29  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**é‡è¦ç¨‹åº¦**: ğŸ”´ é«˜ï¼ˆå¿…è¯»ï¼‰

